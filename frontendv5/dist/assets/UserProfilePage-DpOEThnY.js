import{i as U,g as q,u as V,j as e,S as G,k as X,N as _,b as K,r as m,V as f,l as O,B as v,e as Q,M as Y,P as W,d as J,H as Z,m as ee,n as p}from"./index-CLUoxoAg.js";import{C as N,a as k}from"./circle-user-DoulofzZ.js";import{u as E}from"./userService-CSQF3Vcm.js";import{b as ae}from"./bloodTypeService-CHVPaQSk.js";import{I as j}from"./InputField-CdPCaxRY.js";import{D as z}from"./DatePicker-DXnV2bY9.js";import{P as se}from"./pen-line-CyduYMqh.js";import{C as w}from"./circle-check-big-DeP-VlS6.js";import{C as te}from"./circle-x-D2q5EULj.js";import{C as ne}from"./clock-DHp9DAYO.js";import{S as le}from"./save-Bf1JiKSE.js";import"./chevron-right-Dplm1_a-.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ie=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],oe=U("bell",ie);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],de=U("settings",re),ce=()=>{const b=q(),{user:x}=V(),u=[{path:"/profile",icon:N,label:"Thông tin cá nhân"},{path:"/profile/security",icon:G,label:"Bảo mật & Đăng nhập"},{path:"/profile/donation-schedule",icon:k,label:"Lịch hiến máu"},{path:"/profile/donation-history",icon:X,label:"Lịch sử hiến máu"},{path:"/profile/notifications",icon:oe,label:"Thông báo"},{path:"/profile/settings",icon:de,label:"Cài đặt tài khoản"}],s=c=>c==="/profile"?b.pathname==="/profile":b.pathname.startsWith(c);return e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6 pb-4 border-b border-gray-200",children:[e.jsx(N,{size:40,className:"text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:(x==null?void 0:x.fullName)||"Người dùng"}),e.jsx("p",{className:"text-sm text-gray-600",children:(x==null?void 0:x.email)||""})]})]}),e.jsx("nav",{children:e.jsx("ul",{className:"space-y-2",children:u.map(c=>e.jsx("li",{children:e.jsxs(_,{to:c.path,end:c.path==="/profile",className:({isActive:n})=>`flex items-center space-x-3 py-2.5 px-3 rounded-lg transition duration-200 ${n?"bg-red-50 text-red-700 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"}`,children:[e.jsx(c.icon,{size:18,className:s(c.path)?"text-red-600":"text-gray-500"}),e.jsx("span",{children:c.label})]})},c.path))})})]})},F=({mode:b="view"})=>{const{user:x}=V(),u=K(),[s,c]=m.useState(null),[n,S]=m.useState({fullName:"",phone:"",dateOfBirth:"",gender:"",address:"",emergencyContact:"",bloodTypeId:"",medicalConditions:"",lastDonationDate:"",isReadyToDonate:!0}),[I,H]=m.useState([]),[M,P]=m.useState(!0),[i,L]=m.useState(!1),[o,C]=m.useState({}),y=b==="edit",B=b==="view",D=m.useCallback(async(t=!1)=>{var d;P(!0);try{const[a,l]=await Promise.all([E.getProfile(t),ae.getAll()]);if(c(a),H(l||[]),y){const g={fullName:a.fullName||"",phone:a.phone||"",dateOfBirth:a.dateOfBirth||"",gender:a.gender||"",address:a.address||"",emergencyContact:a.emergencyContact||"",bloodTypeId:((d=a.bloodType)==null?void 0:d.id)||a.bloodTypeId||"",medicalConditions:a.medicalConditions||"",lastDonationDate:a.lastDonationDate||"",isReadyToDonate:a.isReadyToDonate!==null?a.isReadyToDonate:!0};S(g)}}catch(a){console.error("Error loading user data:",a),f.error(`Lỗi khi tải dữ liệu người dùng: ${a.message}`)}finally{P(!1)}},[y]);m.useEffect(()=>{D()},[D]);const h=m.useCallback(t=>{const{name:d,value:a,type:l,checked:g}=t.target;S(T=>({...T,[d]:l==="checkbox"?g:a})),o[d]&&C(T=>({...T,[d]:null}))},[o]),A=()=>{const t={};return n.fullName.trim()||(t.fullName="Họ tên không được để trống."),C(t),Object.keys(t).length===0},$=async t=>{if(t.preventDefault(),!A()){f.error("Vui lòng kiểm tra lại các trường thông tin.");return}L(!0);const d=f.loading("Đang cập nhật thông tin..."),a={...n,bloodTypeId:n.bloodTypeId?parseInt(n.bloodTypeId,10):null};a.phone===""&&(a.phone=null),a.gender===""&&(a.gender=null),a.address===""&&(a.address=null),a.emergencyContact===""&&(a.emergencyContact=null),a.medicalConditions===""&&(a.medicalConditions=null),a.dateOfBirth||(a.dateOfBirth=null),a.lastDonationDate||(a.lastDonationDate=null);try{const l=await E.updateProfile(a);f.success("Cập nhật thông tin thành công!",{id:d}),c(null),await D(!0),u("/profile")}catch(l){console.error("Update user error:",l),f.error(`Lỗi khi cập nhật: ${l.message||"Vui lòng thử lại."}`,{id:d}),l.response&&l.response.data&&typeof l.response.data=="object"&&C(g=>({...g,...l.response.data}))}finally{L(!1)}},r=({icon:t,label:d,value:a,highlight:l=!1})=>{const g=t;return e.jsxs("div",{className:"py-3 sm:grid sm:grid-cols-3 sm:gap-4",children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[e.jsx(g,{size:16,className:"mr-2 text-red-600"}),d]}),e.jsx("dd",{className:`mt-1 text-sm ${l?"font-semibold text-red-700":"text-gray-900"} sm:mt-0 sm:col-span-2`,children:a!=null&&a!==""?a:e.jsx("span",{className:"italic text-gray-400",children:"Chưa có thông tin"})})]})};if(M)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(O,{size:"12"})});if(!s)return e.jsx("div",{className:"text-center py-10",children:"Không thể tải thông tin người dùng."});const R=s.bloodTypeDescription||"Chưa cập nhật";return e.jsx("div",{className:"p-6 max-w-4xl mx-auto",children:e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-5 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[y?"Chỉnh sửa hồ sơ: ":"Hồ sơ cá nhân: ",s.fullName]}),e.jsx("p",{className:"text-sm text-gray-500",children:e.jsx("span",{className:"font-semibold",children:s.email})})]}),e.jsxs("div",{className:"flex space-x-2",children:[B&&e.jsxs(v,{onClick:()=>u("/profile/edit"),variant:"outline",children:[e.jsx(se,{size:16,className:"mr-2"})," Chỉnh sửa"]}),y&&e.jsxs(v,{onClick:()=>u("/profile"),variant:"secondary",children:[e.jsx(Q,{size:16,className:"mr-2"})," Xem hồ sơ"]})]})]})}),B&&e.jsx("div",{className:"px-6 py-5",children:e.jsxs("dl",{className:"divide-y divide-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 my-3",children:"Thông tin liên hệ"}),e.jsx(r,{icon:Y,label:"Email",value:s.email}),e.jsx(r,{icon:W,label:"Số điện thoại",value:s.phone}),e.jsx(r,{icon:J,label:"Địa chỉ",value:s.address}),e.jsx(r,{icon:N,label:"Liên hệ khẩn cấp",value:s.emergencyContact}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 pt-5 my-3",children:"Thông tin cá nhân & Y tế"}),e.jsx(r,{icon:k,label:"Ngày sinh",value:s.dateOfBirth?new Date(s.dateOfBirth).toLocaleDateString():null}),e.jsx(r,{icon:N,label:"Giới tính",value:s.gender}),e.jsx(r,{icon:Z,label:"Nhóm máu",value:R,highlight:R!=="Chưa cập nhật"}),e.jsx(r,{icon:N,label:"Tình trạng bệnh lý",value:s.medicalConditions}),e.jsx(r,{icon:k,label:"Lần hiến máu cuối",value:s.lastDonationDate?new Date(s.lastDonationDate).toLocaleDateString():null}),e.jsx(r,{icon:s.isReadyToDonate?w:te,label:"Sẵn sàng hiến máu",value:s.isReadyToDonate?"Có":"Không",highlight:s.isReadyToDonate===!0}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 pt-5 my-3",children:"Thông tin tài khoản"}),e.jsx(r,{icon:w,label:"Email đã xác thực",value:s.emailVerified?"Đã xác thực":"Chưa xác thực"}),e.jsx(r,{icon:w,label:"SĐT đã xác thực",value:s.phoneVerified?"Đã xác thực":"Chưa xác thực"}),e.jsx(r,{icon:ne,label:"Ngày tạo tài khoản",value:s.createdAt?new Date(s.createdAt).toLocaleString():null})]})}),y&&e.jsxs("form",{onSubmit:$,className:"p-6 space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 border-b pb-2 mb-4",children:"Thông tin cá nhân"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(j,{label:"Họ và tên đầy đủ",id:"fullName",name:"fullName",value:n.fullName,onChange:h,required:!0,error:o.fullName,disabled:i}),e.jsx(j,{label:"Số điện thoại",id:"phone",name:"phone",type:"tel",value:n.phone,onChange:h,error:o.phone,disabled:i})]}),"            ",e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(z,{label:"Ngày sinh",name:"dateOfBirth",value:n.dateOfBirth,onChange:h,maxDate:new Date().toISOString().split("T")[0],placeholder:"Chọn ngày sinh",disabled:i}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 mb-1",children:"Giới tính"}),e.jsxs("select",{id:"gender",name:"gender",value:n.gender,onChange:h,disabled:i,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${o.gender?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Chọn giới tính --"}),e.jsx("option",{value:"Male",children:"Nam"}),e.jsx("option",{value:"Female",children:"Nữ"}),e.jsx("option",{value:"Other",children:"Khác"})]}),o.gender&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:o.gender})]})]}),e.jsx(j,{label:"Địa chỉ",id:"address",name:"address",type:"textarea",value:n.address,onChange:h,error:o.address,disabled:i,rows:3}),e.jsx(j,{label:"Liên hệ khẩn cấp",id:"emergencyContact",name:"emergencyContact",value:n.emergencyContact,onChange:h,error:o.emergencyContact,disabled:i}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 border-b pb-2 mb-4 pt-4",children:"Thông tin Y tế & Hiến máu"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nhóm máu"}),e.jsxs("select",{id:"bloodTypeId",name:"bloodTypeId",value:n.bloodTypeId,onChange:h,disabled:i||I.length===0,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${o.bloodTypeId?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Chọn nhóm máu --"}),I.filter((t,d,a)=>d===a.findIndex(l=>l.bloodGroup===t.bloodGroup)).map(t=>e.jsx("option",{value:t.id,children:t.bloodGroup},t.id))]}),o.bloodTypeId&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:o.bloodTypeId})]}),e.jsx(j,{label:"Tình trạng bệnh lý (nếu có)",id:"medicalConditions",name:"medicalConditions",type:"textarea",value:n.medicalConditions,onChange:h,error:o.medicalConditions,disabled:i,rows:3}),"            ",e.jsx(z,{label:"Ngày hiến máu gần nhất",name:"lastDonationDate",value:n.lastDonationDate,onChange:h,maxDate:new Date().toISOString().split("T")[0],placeholder:"Chọn ngày hiến máu gần nhất",disabled:i}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"isReadyToDonate",name:"isReadyToDonate",type:"checkbox",checked:n.isReadyToDonate,onChange:h,disabled:i,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"isReadyToDonate",className:"ml-2 block text-sm text-gray-900",children:"Sẵn sàng hiến máu"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(v,{type:"button",variant:"secondary",disabled:i,onClick:()=>u("/profile"),children:"Hủy bỏ"}),e.jsxs(v,{type:"submit",variant:"primary",disabled:i,children:[i?e.jsx(O,{size:"5",color:"white",className:"mr-2"}):e.jsx(le,{size:18,className:"mr-2"}),i?"Đang lưu...":"Lưu thay đổi"]})]})]})]})})},he=()=>e.jsx(F,{mode:"view"}),me=()=>e.jsx(F,{mode:"edit"}),xe=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Bảo mật & Đăng nhập"}),e.jsx("p",{className:"text-gray-600",children:"Quản lý mật khẩu và cài đặt bảo mật tài khoản..."})]}),ge=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Lịch hiến máu"}),e.jsx("p",{className:"text-gray-600",children:"Xem và quản lý lịch hẹn hiến máu của bạn..."})]}),pe=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Lịch sử hiến máu"}),e.jsx("p",{className:"text-gray-600",children:"Xem lịch sử các lần hiến máu đã thực hiện..."})]}),ue=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Cài đặt thông báo"}),e.jsx("p",{className:"text-gray-600",children:"Quản lý các thông báo và cảnh báo..."})]}),be=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Cài đặt tài khoản"}),e.jsx("p",{className:"text-gray-600",children:"Cài đặt tổng quát cho tài khoản..."})]}),Pe=()=>e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(ce,{})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(ee,{children:[e.jsx(p,{path:"/",element:e.jsx(he,{})}),e.jsx(p,{path:"/edit",element:e.jsx(me,{})}),e.jsx(p,{path:"/security",element:e.jsx(xe,{})}),e.jsx(p,{path:"/schedule",element:e.jsx(ge,{})}),e.jsx(p,{path:"/history",element:e.jsx(pe,{})}),e.jsx(p,{path:"/notifications",element:e.jsx(ue,{})}),e.jsx(p,{path:"/settings",element:e.jsx(be,{})})]})})]})})});export{Pe as default};
