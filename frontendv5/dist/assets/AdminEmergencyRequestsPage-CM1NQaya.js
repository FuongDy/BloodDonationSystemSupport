import{r,V as i,j as e,d as w,t as L,B as c,v as R,x as E,y as A,w as S,P as D,l as B,I as o}from"./index---XYpbwv.js";import{b as m}from"./bloodRequestService-CVCsh7P-.js";import{b as U}from"./bloodTypeService-DVaU63AT.js";import{B as g}from"./Badge-oS4_q8it.js";import{P as G}from"./PageHeader-b2bgC0Rs.js";import{M}from"./Modal-CH3PBdLX.js";import{P as O}from"./plus-DIBgbZhv.js";import{C as F}from"./clock-DJtAe62-.js";import"./arrow-left-CYlgApu7.js";const X=()=>{const[y,j]=r.useState([]),[f,x]=r.useState(!0),[v,d]=r.useState(!1),[b,C]=r.useState([]),[n,p]=r.useState({bloodTypeId:"",quantityInUnits:"",urgency:"CRITICAL",reason:"",contactPhone:"",deliveryAddress:"",latitude:"",longitude:""});r.useEffect(()=>{h(),N()},[]);const h=async()=>{try{x(!0);const s=await m.searchActiveRequests({latitude:10.8231,longitude:106.6297,radius:50});j(s.data)}catch{i.error("Lỗi khi tải danh sách yêu cầu khẩn cấp")}finally{x(!1)}},N=async()=>{try{const s=await U.getAllBloodTypes();C(s.data)}catch{i.error("Không thể tải danh sách nhóm máu")}},l=s=>{const{name:a,value:t}=s.target;p({...n,[a]:t})},I=async s=>{s.preventDefault();try{await m.createBloodRequest(n),i.success("Tạo yêu cầu khẩn cấp thành công"),d(!1),h(),p({bloodTypeId:"",quantityInUnits:"",urgency:"CRITICAL",reason:"",contactPhone:"",deliveryAddress:"",latitude:"",longitude:""})}catch{i.error("Lỗi khi tạo yêu cầu khẩn cấp")}},u=async(s,a)=>{try{await m.updateRequestStatus(s,a),i.success("Cập nhật trạng thái thành công"),h()}catch{i.error("Lỗi khi cập nhật trạng thái")}},T=s=>{const t={CRITICAL:{variant:"error",label:"Cực kỳ khẩn cấp"},URGENCY:{variant:"warning",label:"Khẩn cấp"},NORMAL:{variant:"info",label:"Bình thường"}}[s]||{variant:"default",label:s};return e.jsx(g,{variant:t.variant,children:t.label})},k=s=>{const t={PENDING:{variant:"warning",label:"Chờ xử lý"},APPROVED:{variant:"info",label:"Đã duyệt"},FULFILLED:{variant:"success",label:"Đã hoàn thành"},REJECTED:{variant:"error",label:"Từ chối"},CANCELLED:{variant:"error",label:"Đã hủy"}}[s]||{variant:"default",label:s};return e.jsx(g,{variant:t.variant,children:t.label})};return f?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(w,{size:"12"})}):e.jsxs(L,{children:[e.jsx(G,{title:"Quản lý Yêu cầu Khẩn cấp",subtitle:"Theo dõi và xử lý các yêu cầu máu khẩn cấp",actions:e.jsxs(c,{onClick:()=>d(!0),children:[e.jsx(O,{className:"w-4 h-4 mr-2"}),"Tạo yêu cầu khẩn cấp"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:y.map(s=>{var a;return e.jsxs(R,{hover:!0,children:[e.jsx(E,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(A,{className:"text-lg",children:["Cần máu ",(a=s.bloodType)==null?void 0:a.bloodGroup]}),T(s.urgency)]})}),e.jsxs(S,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Số lượng:"}),e.jsxs("span",{className:"font-semibold",children:[s.quantityInUnits," đơn vị"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Trạng thái:"}),k(s.status)]}),s.contactPhone&&e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(D,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:s.contactPhone})]}),s.deliveryAddress&&e.jsxs("div",{className:"flex items-start space-x-2",children:[e.jsx(B,{className:"w-4 h-4 text-gray-500 mt-0.5"}),e.jsx("span",{className:"text-sm",children:s.deliveryAddress})]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(F,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:new Date(s.createdAt).toLocaleString("vi-VN")})]}),s.reason&&e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600 mb-1",children:"Lý do:"}),e.jsx("p",{className:"text-sm",children:s.reason})]}),s.status==="PENDING"&&e.jsxs("div",{className:"flex space-x-2 pt-2",children:[e.jsx(c,{size:"sm",className:"flex-1",onClick:()=>u(s.id,"APPROVED"),children:"Duyệt"}),e.jsx(c,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>u(s.id,"REJECTED"),children:"Từ chối"})]}),s.status==="APPROVED"&&e.jsx(c,{size:"sm",className:"w-full",onClick:()=>u(s.id,"FULFILLED"),children:"Đánh dấu hoàn thành"})]})]},s.id)})}),e.jsx(M,{isOpen:v,onClose:()=>d(!1),title:"Tạo yêu cầu khẩn cấp",size:"lg",children:e.jsxs("form",{onSubmit:I,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nhóm máu"}),e.jsxs("select",{id:"bloodTypeId",name:"bloodTypeId",value:n.bloodTypeId,onChange:l,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm",required:!0,children:[e.jsx("option",{value:"",children:"-- Chọn nhóm máu --"}),b.filter((s,a,t)=>a===t.findIndex(P=>P.bloodGroup===s.bloodGroup)).map(s=>e.jsx("option",{value:s.id,children:s.bloodGroup},s.id))]})]}),e.jsx(o,{label:"Số lượng (đơn vị)",name:"quantityInUnits",type:"number",value:n.quantityInUnits,onChange:l,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mức độ khẩn cấp"}),e.jsxs("select",{name:"urgency",value:n.urgency,onChange:l,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"CRITICAL",children:"Cực kỳ khẩn cấp"}),e.jsx("option",{value:"URGENCY",children:"Khẩn cấp"}),e.jsx("option",{value:"NORMAL",children:"Bình thường"})]})]}),e.jsx(o,{label:"Lý do",name:"reason",as:"textarea",rows:3,value:n.reason,onChange:l}),e.jsx(o,{label:"Số điện thoại liên hệ",name:"contactPhone",value:n.contactPhone,onChange:l}),e.jsx(o,{label:"Địa chỉ giao máu",name:"deliveryAddress",as:"textarea",rows:2,value:n.deliveryAddress,onChange:l}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(o,{label:"Vĩ độ",name:"latitude",type:"number",step:"any",value:n.latitude,onChange:l,required:!0}),e.jsx(o,{label:"Kinh độ",name:"longitude",type:"number",step:"any",value:n.longitude,onChange:l,required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:()=>d(!1),children:"Hủy"}),e.jsx(c,{type:"submit",children:"Tạo yêu cầu"})]})]})})]})};export{X as default};
