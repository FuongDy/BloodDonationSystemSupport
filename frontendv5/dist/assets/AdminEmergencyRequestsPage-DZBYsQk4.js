import{r,V as i,j as e,l as E,t as L,B as l,T as D,v as A,x as B,y as S,w as P}from"./index-CLUoxoAg.js";import{b as u}from"./bloodRequestService-C7vK5jM6.js";import{b as U}from"./bloodTypeService-CHVPaQSk.js";import{B as f}from"./Badge-CK4vI7BX.js";import{P as q}from"./PageHeader-HTJD6SXh.js";import{M as G}from"./Modal-DkkLN5ve.js";import{I as m}from"./InputField-CdPCaxRY.js";import{P as j}from"./plus-9LeHoxAA.js";import{C as O}from"./clock-DHp9DAYO.js";import"./arrow-left-EWlVf4Oe.js";const X=()=>{const[p,x]=r.useState([]),[b,g]=r.useState(!0),[N,c]=r.useState(!1),[v,C]=r.useState([]),[t,y]=r.useState({patientName:"",hospital:"",bloodTypeId:"",quantityInUnits:"",urgency:"CRITICAL"});r.useEffect(()=>{d(),I()},[]);const d=async()=>{try{g(!0);const s=await u.searchActiveRequests();console.log("Response:",s),x(s.data||s||[])}catch(s){console.error("Error fetching requests:",s),i.error("Lỗi khi tải danh sách yêu cầu khẩn cấp"),x([])}finally{g(!1)}},I=async()=>{try{const s=await U.getAll();C(s)}catch{i.error("Không thể tải danh sách nhóm máu")}},o=s=>{const{name:n,value:a}=s.target;y({...t,[n]:a})},T=async s=>{s.preventDefault();try{const n={patientName:t.patientName,hospital:t.hospital,bloodTypeId:parseInt(t.bloodTypeId),quantityInUnits:parseInt(t.quantityInUnits),urgency:t.urgency};await u.createBloodRequest(n),i.success("Tạo yêu cầu khẩn cấp thành công"),c(!1),d(),y({patientName:"",hospital:"",bloodTypeId:"",quantityInUnits:"",urgency:"CRITICAL"})}catch{i.error("Lỗi khi tạo yêu cầu khẩn cấp")}},h=async(s,n)=>{try{await u.updateRequestStatus(s,n),i.success("Cập nhật trạng thái thành công"),d()}catch{i.error("Lỗi khi cập nhật trạng thái")}},k=s=>{const a={CRITICAL:{variant:"error",label:"Cực kỳ khẩn cấp"},URGENCY:{variant:"warning",label:"Khẩn cấp"},NORMAL:{variant:"info",label:"Bình thường"}}[s]||{variant:"default",label:s};return e.jsx(f,{variant:a.variant,children:a.label})},R=s=>{const a={PENDING:{variant:"warning",label:"Chờ xử lý"},APPROVED:{variant:"info",label:"Đã duyệt"},FULFILLED:{variant:"success",label:"Đã hoàn thành"},REJECTED:{variant:"error",label:"Từ chối"},CANCELLED:{variant:"error",label:"Đã hủy"}}[s]||{variant:"default",label:s};return e.jsx(f,{variant:a.variant,children:a.label})};return b?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(E,{size:"12"})}):e.jsxs(L,{children:[e.jsx(q,{title:"Quản lý Yêu cầu Khẩn cấp",subtitle:"Theo dõi và xử lý các yêu cầu máu khẩn cấp",actions:e.jsxs(l,{onClick:()=>c(!0),children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Tạo yêu cầu khẩn cấp"]})}),e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:p.length===0?e.jsxs("div",{className:"col-span-full flex flex-col items-center justify-center py-12 text-center",children:[e.jsx(D,{className:"w-16 h-16 text-gray-400 mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Hiện tại chưa có yêu cầu khẩn cấp nào"}),e.jsx("p",{className:"text-gray-500 mb-6",children:"Chưa có yêu cầu máu khẩn cấp nào được tạo. Bạn có thể tạo yêu cầu mới bằng cách nhấn nút bên trên."}),e.jsxs(l,{onClick:()=>c(!0),children:[e.jsx(j,{className:"w-4 h-4 mr-2"}),"Tạo yêu cầu đầu tiên"]})]}):p.map(s=>{var n;return e.jsxs(A,{hover:!0,children:[e.jsx(B,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(S,{className:"text-lg",children:["Cần máu ",(n=s.bloodType)==null?void 0:n.bloodGroup]}),k(s.urgency)]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Bệnh nhân:"}),e.jsx("span",{className:"font-semibold",children:s.patientName})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Bệnh viện:"}),e.jsx("span",{className:"font-semibold",children:s.hospital})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Số lượng:"}),e.jsxs("span",{className:"font-semibold",children:[s.quantityInUnits," đơn vị"]})]}),e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx("span",{className:"text-sm text-gray-600",children:"Trạng thái:"}),R(s.status)]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(O,{className:"w-4 h-4 text-gray-500"}),e.jsx("span",{className:"text-sm",children:new Date(s.createdAt).toLocaleString("vi-VN")})]}),s.status==="PENDING"&&e.jsxs("div",{className:"flex space-x-2 pt-2",children:[e.jsx(l,{size:"sm",className:"flex-1",onClick:()=>h(s.id,"APPROVED"),children:"Duyệt"}),e.jsx(l,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>h(s.id,"REJECTED"),children:"Từ chối"})]}),s.status==="APPROVED"&&e.jsx(l,{size:"sm",className:"w-full",onClick:()=>h(s.id,"FULFILLED"),children:"Đánh dấu hoàn thành"})]})]},s.id)})}),e.jsx(G,{isOpen:N,onClose:()=>c(!1),title:"Tạo yêu cầu khẩn cấp",size:"lg",children:e.jsxs("form",{onSubmit:T,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(m,{label:"Tên bệnh nhân",name:"patientName",value:t.patientName,onChange:o,required:!0}),e.jsx(m,{label:"Bệnh viện",name:"hospital",value:t.hospital,onChange:o,required:!0})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nhóm máu"}),e.jsxs("select",{id:"bloodTypeId",name:"bloodTypeId",value:t.bloodTypeId,onChange:o,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm",required:!0,children:[e.jsx("option",{value:"",children:"-- Chọn nhóm máu --"}),v.filter((s,n,a)=>n===a.findIndex(w=>w.bloodGroup===s.bloodGroup)).map(s=>e.jsx("option",{value:s.id,children:s.bloodGroup},s.id))]})]}),e.jsx(m,{label:"Số lượng (đơn vị)",name:"quantityInUnits",type:"number",value:t.quantityInUnits,onChange:o,required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mức độ khẩn cấp"}),e.jsxs("select",{name:"urgency",value:t.urgency,onChange:o,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"CRITICAL",children:"Cực kỳ khẩn cấp"}),e.jsx("option",{value:"URGENCY",children:"Khẩn cấp"}),e.jsx("option",{value:"NORMAL",children:"Bình thường"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(l,{type:"button",variant:"outline",onClick:()=>c(!1),children:"Hủy"}),e.jsx(l,{type:"submit",children:"Tạo yêu cầu"})]})]})})]})};export{X as default};
