import{i as R,G as y,j as e,p as T,q as C,t as D,A as w,T as $,v as S,U as M,C as j,r as o,V as f,l as q,R as B}from"./index-0uBgUJAH.js";import{P}from"./PageHeader-DZCCvaaU.js";import{T as H}from"./TabNavigation-Cl-o_awq.js";import"./Badge-4CUZIaa-.js";import{S as V}from"./StatusBadge-BlA2KO3p.js";import{I as r}from"./InfoRow-DfUUDnyO.js";import{D as b}from"./DateTimeDisplay-C7GFcxup.js";import{T as A}from"./trending-up-DGlBaSl-.js";import{C as E}from"./clock-DvSylXuB.js";import{E as p}from"./EmptyState-SPacalkD.js";import"./constants-QRcisZg4.js";import"./circle-check-big-DH52TbDi.js";import"./plus-Byzx0bx3.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"M16 17h6v-6",key:"t6n2it"}],["path",{d:"m22 17-8.5-8.5-5 5L2 7",key:"x473p"}]],_=R("trending-down",G),v={getAllInventory:()=>y.get("/inventory").then(t=>t.data),getInventorySummary:()=>y.get("/inventory/summary").then(t=>t.data),getRecentAdditions:()=>y.get("/inventory/recent").then(t=>t.data)},N=({unit:t,className:c=""})=>{var i;if(!t)return console.error("BloodUnitCard: unit is null or undefined"),e.jsx("div",{children:"Unit data is missing"});const l=()=>{if(!t.expiryDate)return!1;const d=new Date,m=new Date(t.expiryDate);return Math.ceil((m-d)/(1e3*60*60*24))<=7},s=(()=>{if(!t.expiryDate)return null;const d=new Date,m=new Date(t.expiryDate);return Math.ceil((m-d)/(1e3*60*60*24))})(),a=l();return e.jsxs(T,{className:`${c} ${a?"border-orange-200 bg-orange-50":""}`,children:[e.jsx(C,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(D,{className:"text-lg flex items-center",children:[e.jsx(w,{className:"w-5 h-5 mr-2 text-red-500"}),t.id]}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(V,{status:t.status,type:"inventory"}),a&&e.jsxs("div",{className:"flex items-center text-orange-600 text-sm",children:[e.jsx($,{className:"w-4 h-4 mr-1"}),"Sắp hết hạn"]})]})]})}),e.jsxs(S,{className:"space-y-3",children:[e.jsx(r,{label:"Nhóm máu",value:((i=t.bloodType)==null?void 0:i.bloodGroup)||"N/A"}),e.jsx(r,{label:"Thể tích",value:`${t.volumeMl||"N/A"} ml`}),e.jsx(r,{label:"Người hiến",value:t.donorName||"N/A",icon:M}),e.jsx(r,{label:"Ngày thu thập",value:e.jsx(b,{date:t.collectionDate}),icon:j}),e.jsx(r,{label:"Hạn sử dụng",value:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(b,{date:t.expiryDate}),s!==null&&e.jsxs("span",{className:`text-sm ${s<=3?"text-red-600":s<=7?"text-orange-600":"text-gray-600"}`,children:["(",s>0?`còn ${s} ngày`:"đã hết hạn",")"]})]}),icon:j}),t.shelfLifeDays&&e.jsx(r,{label:"Thời hạn bảo quản",value:`${t.shelfLifeDays} ngày`}),t.storageLocation&&e.jsx(r,{label:"Vị trí lưu trữ",value:t.storageLocation})]})]})},z=({summary:t,className:c=""})=>{var s;const l=a=>a>0?e.jsx(A,{className:"w-5 h-5 text-green-500"}):a<0?e.jsx(_,{className:"w-5 h-5 text-red-500"}):e.jsx(E,{className:"w-5 h-5 text-gray-500"}),x=[{label:"Tổng số đơn vị",value:t.totalUnits,valueClassName:"text-xl font-bold text-gray-900"},{label:"Có sẵn",value:t.availableUnits,valueClassName:"text-lg font-semibold text-green-600"},{label:"Sắp hết hạn",value:t.expiringSoon||0,valueClassName:"text-lg font-semibold text-yellow-600"},{label:"Đã hết hạn",value:t.expiredUnits||0,valueClassName:"text-lg font-semibold text-red-600"}];return e.jsxs(T,{className:`${c}`,children:[e.jsx(C,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsx(D,{className:"text-lg text-gray-900",children:((s=t.bloodType)==null?void 0:s.name)||"N/A"}),l(t.trend)]})}),e.jsx(S,{className:"space-y-3",children:x.map((a,i)=>e.jsx(r,{label:a.label,value:a.value,valueClassName:a.valueClassName},i))})]})},re=()=>{const[t,c]=o.useState([]),[l,x]=o.useState([]),[s,a]=o.useState([]),[i,d]=o.useState("summary"),[m,h]=o.useState(!0),g=o.useCallback(async()=>{h(!0);try{const[n,u,K]=await Promise.all([v.getAllInventory(),v.getInventorySummary(),v.getRecentAdditions()]);c(n),x(u),a(K)}catch{f.error("Không thể tải dữ liệu kho máu.")}finally{h(!1)}},[]);o.useEffect(()=>{g()},[g]);const k=()=>{g(),f.success("Đã cập nhật dữ liệu!")},I=[{key:"summary",label:"Tổng quan",icon:A,count:l.length},{key:"inventory",label:"Kho máu",icon:w,count:t.length},{key:"recent",label:"Mới nhất",icon:E,count:s.length}],L=[{label:"Làm mới",icon:B,onClick:k,variant:"outline"}];if(m)return e.jsx("div",{className:"p-6",children:e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx(q,{size:"12"})})});const U=()=>{switch(i){case"summary":return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Tóm tắt tồn kho theo nhóm máu"}),l.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6",children:l.map((n,u)=>e.jsx(z,{summary:n},u))}):e.jsx(p,{type:"results",title:"Không có dữ liệu tóm tắt",description:"Chưa có dữ liệu tóm tắt tồn kho để hiển thị."})]});case"inventory":return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Danh sách đơn vị máu"}),t.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:t.map(n=>e.jsx(N,{unit:n},n.id))}):e.jsx(p,{type:"results",title:"Không có đơn vị máu nào",description:"Không có đơn vị máu nào trong kho hiện tại."})]});case"recent":return e.jsxs("div",{children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-6",children:"Đơn vị máu mới thêm gần đây"}),"            ",s.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(n=>e.jsx(N,{unit:n},n.id))}):e.jsx(p,{type:"results",title:"Không có đơn vị máu mới",description:"Không có đơn vị máu mới nào được thêm gần đây."})]});default:return null}};return e.jsxs("div",{className:"p-6",children:[e.jsx(P,{title:"Quản lý Kho Máu",description:"Theo dõi và quản lý tồn kho máu",actions:L}),e.jsx(H,{tabs:I,activeTab:i,onTabChange:d,className:"mb-8"}),U()]})};export{re as default};
