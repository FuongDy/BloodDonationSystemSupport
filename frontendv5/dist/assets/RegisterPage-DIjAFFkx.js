import{r as u,u as R,a as F,b as V,h as D,s as h,c as v,j as e,H as I,U as L,M as G,P as U,C as H,D as X,d as z,L as Q,E as $,e as B,f as k}from"./index-1dtSQISR.js";import{D as J}from"./DatePicker-CRDdO3ZR.js";import{b as K}from"./bloodTypeService-CnW7m_57.js";import{C as W}from"./circle-check-big-CJhYsvhV.js";import{A as Z}from"./arrow-left-C8dUBY5m.js";import"./chevron-right-B4c0w1B6.js";import"./chevron-left-ByYWtYPx.js";const ne=()=>{const[i,O]=u.useState({fullName:"",email:"",phone:"",address:"",dateOfBirth:"",password:"",confirmPassword:"",bloodTypeId:"",agreeTerms:!1}),[y,q]=u.useState(!1),[N,A]=u.useState(!1),[T,S]=u.useState([]),[c,C]=u.useState(!1),[r,d]=u.useState({}),{requestRegistration:M,isAuthenticated:E,loading:n}=R(),{setLoading:b}=F(),j=V(),P=u.useCallback(async()=>{C(!0);try{const a=await K.getAll();S(a||[])}catch(a){D(a,h),S([])}finally{C(!1)}},[h]);u.useEffect(()=>{E?j("/",{replace:!0}):P()},[E,j,P]);const x=u.useCallback(async a=>{const{name:s,value:t,type:l,checked:p}=a.target,f=l==="checkbox"?p:t;O(m=>{const o={...m,[s]:f};return setTimeout(async()=>{try{await v.validateAt(s,o),d(g=>({...g,[s]:""}))}catch(g){d(w=>({...w,[s]:g.message}))}if(s==="confirmPassword"||s==="password")try{await v.validateAt("confirmPassword",o),d(g=>({...g,confirmPassword:""}))}catch(g){d(w=>({...w,confirmPassword:g.message}))}},0),o}),r[s]&&d(m=>({...m,[s]:""}))},[r]),Y=async a=>{a.preventDefault();try{if(!i.bloodTypeId){d(t=>({...t,bloodTypeId:"Nhóm máu là bắt buộc"})),h("Vui lòng chọn nhóm máu","error");return}await v.validate(i,{abortEarly:!1}),d({}),b(!0);const s={...i,bloodTypeId:parseInt(i.bloodTypeId,10)};if(!s.dateOfBirth.match(/^\d{2}-\d{2}-\d{4}$/)){d(t=>({...t,dateOfBirth:"Định dạng ngày sinh không hợp lệ (DD-MM-YYYY)"})),h("Định dạng ngày sinh không hợp lệ","error"),b(!1);return}if(!s.bloodTypeId||isNaN(s.bloodTypeId)){d(t=>({...t,bloodTypeId:"Nhóm máu không hợp lệ"})),h("Vui lòng chọn nhóm máu hợp lệ","error"),b(!1);return}delete s.confirmPassword,delete s.agreeTerms,console.log("=== REGISTER REQUEST ==="),console.log("Registration Data:",s),console.log("=======================");try{await M(s),console.log("✅ Registration request successful, navigating to OTP page..."),h("Mã OTP đã được gửi! Vui lòng kiểm tra email.","success"),j("/verify-otp",{state:{registrationData:s}}),console.log("✅ Navigation completed")}catch(t){throw console.error("❌ Request registration error:",t),t}}catch(s){if(s.name==="ValidationError"){const t={};s.inner.forEach(l=>{t[l.path]=l.message}),d(t),h("Vui lòng kiểm tra lại thông tin đăng ký.","error")}else{if(console.error("Registration error details:",s),s.message&&s.message.includes("dateOfBirth")){d(t=>({...t,dateOfBirth:"Định dạng ngày sinh không đúng yêu cầu (phải là YYYY-MM-DD)"})),h("Định dạng ngày sinh không hợp lệ","error");return}if(s.response&&s.response.data){const t=s.response.data;if(t.errors){const l={};if(Object.entries(t.errors).forEach(([p,f])=>{const m=p.toLowerCase(),o=Array.isArray(f)?f[0]:f;m.includes("email")?l.email=o:m.includes("phone")?l.phone=o:m.includes("bloodtype")?l.bloodTypeId=o:m.includes("password")?l.password=o:m.includes("fullname")?l.fullName=o:m.includes("dateofbirth")?l.dateOfBirth=o:m.includes("address")?l.address=o:console.warn(`Unmapped field error: ${p} - ${o}`)}),Object.keys(l).length>0){d(p=>({...p,...l})),h("Dữ liệu không hợp lệ. Vui lòng kiểm tra lại thông tin.","error");return}}if(t.message){h(t.message,"error");return}}D(s,h)}}finally{b(!1)}};return e.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-white to-pink-50",children:[e.jsxs("div",{className:"absolute inset-0 overflow-hidden",children:[e.jsx("div",{className:"absolute -top-40 -right-32 w-80 h-80 bg-red-100 rounded-full opacity-30 blur-3xl"}),e.jsx("div",{className:"absolute -bottom-40 -left-32 w-80 h-80 bg-pink-100 rounded-full opacity-30 blur-3xl"})]}),e.jsxs("div",{className:"relative min-h-screen flex",children:[e.jsx("div",{className:"hidden lg:flex lg:w-2/5 flex-col justify-center items-center bg-gradient-to-br from-red-600 to-pink-600 text-white p-8",children:e.jsxs("div",{className:"max-w-sm text-center",children:[e.jsx("div",{className:"flex items-center justify-center mb-6",children:e.jsx("div",{className:"w-20 h-20 bg-white/20 rounded-full flex items-center justify-center backdrop-blur-sm",children:e.jsx(I,{className:"w-10 h-10 text-white"})})}),e.jsx("h1",{className:"text-3xl font-bold mb-4",children:"Tham gia cộng đồng"}),e.jsx("p",{className:"text-lg text-red-100 mb-6 font-light",children:"Trở thành người hùng cứu người với những giọt máu quý giá"}),e.jsxs("div",{className:"space-y-3 text-left",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold",children:"1"})}),e.jsx("span",{className:"text-red-100",children:"Đăng ký tài khoản"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold",children:"2"})}),e.jsx("span",{className:"text-red-100",children:"Xác thực thông tin"})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx("div",{className:"w-8 h-8 bg-white/20 rounded-full flex items-center justify-center",children:e.jsx("span",{className:"text-sm font-bold",children:"3"})}),e.jsx("span",{className:"text-red-100",children:"Bắt đầu hiến máu"})]})]})]})}),e.jsx("div",{className:"w-full lg:w-3/5 flex items-center justify-center p-4 lg:p-8",children:e.jsxs("div",{className:"max-w-2xl w-full",children:[e.jsxs("div",{className:"lg:hidden text-center mb-6",children:[e.jsx("div",{className:"inline-flex items-center justify-center w-16 h-16 bg-red-100 rounded-full mb-4",children:e.jsx(I,{className:"w-8 h-8 text-red-600"})}),e.jsx("h1",{className:"text-2xl font-bold text-gray-900 mb-2",children:"Đăng ký tài khoản"}),e.jsx("p",{className:"text-gray-600",children:"Tham gia cộng đồng hiến máu nhân đạo"})]}),e.jsxs("div",{className:"hidden lg:block text-center mb-6",children:[e.jsx("h2",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Tạo tài khoản mới"}),e.jsx("p",{className:"text-gray-600",children:"Điền thông tin để tham gia cộng đồng"})]}),e.jsx("div",{className:"bg-white rounded-2xl shadow-xl p-6 lg:p-8 border border-gray-100",children:e.jsxs("form",{onSubmit:Y,className:"space-y-6",children:[e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center border-b pb-2",children:[e.jsx(L,{className:"w-5 h-5 mr-2 text-red-600"}),"Thông tin cá nhân"]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Họ và tên đầy đủ *"}),e.jsx("input",{id:"fullName",name:"fullName",type:"text",value:i.fullName,onChange:x,placeholder:"Ví dụ: Nguyễn Văn An",required:!0,disabled:n||c,className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors ${r.fullName?"border-red-300 bg-red-50":"border-gray-300 bg-white"}`}),r.fullName&&e.jsx("p",{className:"text-xs text-red-600",children:r.fullName})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center",children:[e.jsx(G,{className:"w-4 h-4 mr-1 text-gray-500"}),"Email *"]}),e.jsx("input",{id:"email",name:"email",type:"email",value:i.email,onChange:x,placeholder:"your.email@example.com",required:!0,disabled:n||c,className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors ${r.email?"border-red-300 bg-red-50":"border-gray-300 bg-white"}`}),r.email&&e.jsx("p",{className:"text-xs text-red-600",children:r.email})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center",children:[e.jsx(U,{className:"w-4 h-4 mr-1 text-gray-500"}),"Số điện thoại *"]}),e.jsx("input",{id:"phone",name:"phone",type:"tel",value:i.phone,onChange:x,placeholder:"0987654321",required:!0,disabled:n||c,className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors ${r.phone?"border-red-300 bg-red-50":"border-gray-300 bg-white"}`}),r.phone&&e.jsx("p",{className:"text-xs text-red-600",children:r.phone})]})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:["                    ",e.jsxs("div",{className:"space-y-2",children:["                      ",e.jsx(J,{label:e.jsxs("div",{className:"flex items-center text-sm font-medium text-gray-700",children:[e.jsx(H,{className:"w-4 h-4 mr-1 text-gray-500"}),"Ngày sinh *"]}),name:"dateOfBirth",value:i.dateOfBirth,onChange:x,required:!0,maxDate:(()=>{const a=new Date,s=String(a.getDate()).padStart(2,"0"),t=String(a.getMonth()+1).padStart(2,"0"),l=a.getFullYear();return`${s}-${t}-${l}`})(),minDate:(()=>{const a=new Date;a.setFullYear(a.getFullYear()-100);const s=String(a.getDate()).padStart(2,"0"),t=String(a.getMonth()+1).padStart(2,"0"),l=a.getFullYear();return`${s}-${t}-${l}`})(),placeholder:"Tối thiểu 16 tuổi",disabled:n||c,error:r.dateOfBirth}),r.dateOfBirth&&e.jsx("p",{className:"text-xs text-red-600",children:r.dateOfBirth})]}),"                    ",e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center",children:[e.jsx(X,{className:"w-4 h-4 mr-1 text-gray-500"}),"Nhóm máu *"]}),c?e.jsxs("div",{className:"w-full px-4 py-3 border rounded-lg bg-gray-50 flex items-center justify-center",children:[e.jsx("div",{className:"w-4 h-4 border-2 border-gray-400 border-t-transparent rounded-full animate-spin mr-2"}),e.jsx("span",{className:"text-sm text-gray-600",children:"Đang tải..."})]}):e.jsxs("select",{id:"bloodTypeId",name:"bloodTypeId",value:i.bloodTypeId,onChange:x,disabled:n||c||T.length===0,className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors ${r.bloodTypeId?"border-red-300 bg-red-50":"border-gray-300 bg-white"}`,children:[e.jsx("option",{value:"",children:"-- Chọn nhóm máu --"}),T.filter((a,s,t)=>s===t.findIndex(l=>l.bloodGroup===a.bloodGroup)).map(a=>e.jsx("option",{value:a.id,children:a.bloodGroup},a.id))]}),r.bloodTypeId&&e.jsx("p",{className:"text-xs text-red-600",children:r.bloodTypeId})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("label",{className:"text-sm font-medium text-gray-700 flex items-center",children:[e.jsx(z,{className:"w-4 h-4 mr-1 text-gray-500"}),"Địa chỉ *"]}),e.jsx("textarea",{id:"address",name:"address",value:i.address,onChange:x,placeholder:"Số nhà, đường, phường/xã, quận/huyện, tỉnh/thành phố",required:!0,disabled:n||c,rows:2,className:`w-full px-4 py-3 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors resize-none ${r.address?"border-red-300 bg-red-50":"border-gray-300 bg-white"}`}),r.address&&e.jsx("p",{className:"text-xs text-red-600",children:r.address})]})]}),e.jsxs("div",{className:"space-y-4",children:[e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 flex items-center border-b pb-2",children:[e.jsx(Q,{className:"w-5 h-5 mr-2 text-red-600"}),"Thông tin bảo mật"]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Mật khẩu *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"password",name:"password",type:y?"text":"password",value:i.password,onChange:x,placeholder:"Ít nhất 6 ký tự",required:!0,disabled:n||c,className:`w-full px-4 py-3 pr-12 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors ${r.password?"border-red-300 bg-red-50":"border-gray-300 bg-white"}`}),e.jsx("button",{type:"button",onClick:()=>q(!y),disabled:n,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",children:y?e.jsx($,{className:"w-5 h-5"}):e.jsx(B,{className:"w-5 h-5"})})]}),r.password&&e.jsx("p",{className:"text-xs text-red-600",children:r.password})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("label",{className:"text-sm font-medium text-gray-700",children:"Xác nhận mật khẩu *"}),e.jsxs("div",{className:"relative",children:[e.jsx("input",{id:"confirmPassword",name:"confirmPassword",type:N?"text":"password",value:i.confirmPassword,onChange:x,placeholder:"Nhập lại mật khẩu",required:!0,disabled:n||c,className:`w-full px-4 py-3 pr-12 border rounded-lg focus:outline-none focus:ring-2 focus:ring-red-500 focus:border-red-500 transition-colors ${r.confirmPassword?"border-red-300 bg-red-50":"border-gray-300 bg-white"}`}),e.jsx("button",{type:"button",onClick:()=>A(!N),disabled:n,className:"absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 transition-colors",children:N?e.jsx($,{className:"w-5 h-5"}):e.jsx(B,{className:"w-5 h-5"})})]}),r.confirmPassword&&e.jsx("p",{className:"text-xs text-red-600",children:r.confirmPassword})]})]})]}),e.jsxs("div",{className:"bg-gray-50 rounded-lg p-4",children:[e.jsxs("div",{className:"flex items-start",children:[e.jsx("input",{id:"agreeTerms",name:"agreeTerms",type:"checkbox",checked:i.agreeTerms,onChange:x,disabled:n||c,required:!0,className:`w-4 h-4 text-red-600 border-gray-300 rounded focus:ring-red-500 mt-1 ${r.agreeTerms?"border-red-500":""}`}),e.jsxs("label",{htmlFor:"agreeTerms",className:"ml-2 block text-sm text-gray-700",children:["Tôi đã đọc và đồng ý với"," ",e.jsx(k,{to:"/terms",className:"font-medium text-red-600 hover:text-red-500 hover:underline",children:"Điều khoản sử dụng"})," ","và"," ",e.jsx(k,{to:"/privacy",className:"font-medium text-red-600 hover:text-red-500 hover:underline",children:"Chính sách bảo mật"})," ","của hệ thống."]})]}),r.agreeTerms&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:r.agreeTerms})]}),e.jsx("button",{type:"submit",disabled:n||c||Object.keys(r).some(a=>r[a]),className:`w-full bg-gradient-to-r from-red-600 to-pink-600 text-white font-semibold py-3 px-6 rounded-lg shadow-lg hover:shadow-xl transform hover:scale-105 transition-all duration-200 disabled:opacity-50 disabled:cursor-not-allowed disabled:transform-none ${n?"cursor-wait":""}`,children:e.jsxs("div",{className:"flex items-center justify-center",children:[n?e.jsx("div",{className:"w-5 h-5 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}):e.jsx(W,{className:"w-5 h-5 mr-2"}),n?"Đang tạo tài khoản...":"Tạo tài khoản"]})}),e.jsx("div",{className:"text-center pt-4 border-t",children:e.jsxs("p",{className:"text-sm text-gray-600",children:["Đã có tài khoản?"," ",e.jsxs(k,{to:"/login",className:"font-medium text-red-600 hover:text-red-500 inline-flex items-center group",children:[e.jsx(Z,{className:"w-4 h-4 mr-1 group-hover:-translate-x-1 transition-transform"}),"Đăng nhập ngay"]})]})})]})}),e.jsx("div",{className:"mt-6 text-center",children:e.jsx("p",{className:"text-xs text-gray-500",children:"Sau khi đăng ký, bạn sẽ nhận được email xác thực để kích hoạt tài khoản"})})]})})]})]})};export{ne as default};
