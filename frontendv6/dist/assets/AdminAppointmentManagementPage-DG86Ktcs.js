import{b as O,r as n,V as r,j as e,C as y,T as C,B as o,U as K,M as Q,P as V,d as Y}from"./index-0uBgUJAH.js";import{A as $}from"./AdminPageLayout-DdqsJ0r9.js";import{A as G}from"./AdminContentWrapper-D75idiX7.js";import{D as W}from"./DataTable-CPsaHdkQ.js";import{M as w}from"./Modal-DyBqspH3.js";import{I as p}from"./InputField-Yb_kCCm4.js";import{S as X}from"./StatusBadge-BlA2KO3p.js";import{f as S}from"./formatters-VVyg-bDD.js";import{a as E}from"./appointmentService-D8iw8kRf.js";import{d as J}from"./donationService-DtMzIi16.js";import{D as c}from"./constants-QRcisZg4.js";import{P as Z}from"./plus-Byzx0bx3.js";import{C as A}from"./clock-DvSylXuB.js";import{C as P}from"./circle-check-big-DH52TbDi.js";import{P as ee}from"./pen-line-Ca_-Skb_.js";import"./PageHeader-DZCCvaaU.js";import"./Pagination-CR7EbBZ1.js";import"./chevron-left-xbWY0yrx.js";import"./chevron-right-C8WomcHX.js";import"./EmptyState-SPacalkD.js";import"./Badge-4CUZIaa-.js";const ve=()=>{const I=O(),[m,k]=n.useState([]),[T,H]=n.useState([]),[b,D]=n.useState(!0),[d,M]=n.useState(null),[z,x]=n.useState(!1),[L,u]=n.useState(!1),[te,se]=n.useState(!1),[a,l]=n.useState({processId:"",appointmentDateTime:"",location:"Bệnh viện Huyết học - FPT",notes:"",staffId:null}),[g,j]=n.useState({reason:"",suggestedDateTime:""});n.useEffect(()=>{f()},[]);const f=async()=>{D(!0);try{const s=(await J.getAllDonationRequests()).data||[],i=s.filter(h=>h.appointment);k(i);const v=s.filter(h=>h.status===c.APPOINTMENT_PENDING||h.status===c.RESCHEDULE_REQUESTED);H(v)}catch(t){console.error("Error fetching data:",t),r.error("Không thể tải dữ liệu lịch hẹn")}finally{D(!1)}},R=async()=>{if(!a.processId||!a.appointmentDateTime){r.error("Vui lòng điền đầy đủ thông tin");return}try{await E.createAppointment(a),r.success("Tạo lịch hẹn thành công"),x(!1),l({processId:"",appointmentDateTime:"",location:"Bệnh viện Huyết học - FPT",notes:"",staffId:null}),f()}catch(t){console.error("Error creating appointment:",t),r.error("Không thể tạo lịch hẹn")}},_=async()=>{if(!g.reason){r.error("Vui lòng nhập lý do đổi lịch");return}try{await E.requestReschedule(d.appointment.id,g),r.success("Yêu cầu đổi lịch thành công"),u(!1),j({reason:"",suggestedDateTime:""}),f()}catch(t){console.error("Error requesting reschedule:",t),r.error("Không thể yêu cầu đổi lịch")}},q=t=>{switch(t){case c.APPOINTMENT_SCHEDULED:return"info";case c.RESCHEDULE_REQUESTED:return"warning";case c.HEALTH_CHECK_PASSED:return"success";case c.HEALTH_CHECK_FAILED:return"error";default:return"info"}},N=t=>new Date(t)>new Date,F=t=>new Date(t)<new Date,U=[{key:"id",title:"ID",sortable:!0,render:t=>`#${t}`},{key:"donor",title:"Người hiến",render:t=>e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(K,{size:16,className:"text-gray-400"}),e.jsxs("div",{children:[e.jsx("div",{className:"font-medium",children:(t==null?void 0:t.fullName)||"N/A"}),e.jsxs("div",{className:"text-sm text-gray-500 flex items-center space-x-1",children:[e.jsx(Q,{size:12}),e.jsx("span",{children:t==null?void 0:t.email})]}),(t==null?void 0:t.phoneNumber)&&e.jsxs("div",{className:"text-sm text-gray-500 flex items-center space-x-1",children:[e.jsx(V,{size:12}),e.jsx("span",{children:t.phoneNumber})]})]})]})},{key:"appointment",title:"Thông tin lịch hẹn",render:(t,s)=>t?e.jsxs("div",{className:"space-y-1",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(y,{size:14,className:N(t.appointmentDateTime)?"text-blue-500":"text-gray-400"}),e.jsx("span",{className:`text-sm ${N(t.appointmentDateTime)?"font-medium":"text-gray-500"}`,children:S(t.appointmentDateTime)})]}),e.jsxs("div",{className:"flex items-center space-x-1 text-gray-500",children:[e.jsx(Y,{size:12}),e.jsx("span",{className:"text-xs",children:t.location})]}),t.notes&&e.jsx("div",{className:"text-xs text-gray-400 italic",children:t.notes})]}):e.jsx("span",{className:"text-gray-400",children:"Chưa có lịch hẹn"})},{key:"status",title:"Trạng thái",render:t=>e.jsx(X,{status:t,variant:q(t)})},{key:"appointmentStatus",title:"Tình trạng",render:(t,s)=>{const i=s.appointment;return i?new Date(i.appointmentDateTime)>new Date?e.jsxs("div",{className:"flex items-center space-x-1 text-green-600",children:[e.jsx(A,{size:14}),e.jsx("span",{className:"text-sm",children:"Sắp tới"})]}):e.jsxs("div",{className:"flex items-center space-x-1 text-gray-500",children:[e.jsx(P,{size:14}),e.jsx("span",{className:"text-sm",children:"Đã qua"})]}):e.jsx("span",{className:"text-gray-400",children:"-"})}},{key:"actions",title:"Hành động",render:(t,s)=>e.jsxs("div",{className:"flex space-x-2",children:[s.appointment&&N(s.appointment.appointmentDateTime)&&e.jsxs(o,{size:"sm",variant:"outline",onClick:()=>{M(s),j({reason:"",suggestedDateTime:""}),u(!0)},children:[e.jsx(ee,{size:14,className:"mr-1"}),"Đổi lịch"]}),e.jsx(o,{size:"sm",variant:"outline",onClick:()=>I(`/admin/donation-process/${s.id}`),children:"Xem chi tiết"})]})}],B=[{label:"Tạo lịch hẹn",icon:Z,variant:"primary",onClick:()=>{l({processId:"",appointmentDateTime:"",location:"Bệnh viện Huyết học - FPT",notes:"",staffId:null}),x(!0)}},{label:"Làm mới",icon:y,variant:"outline",onClick:f}];return e.jsx($,{title:"Quản lý Lịch hẹn",description:"Quản lý lịch hẹn hiến máu và theo dõi tình hình thực hiện",headerActions:B,children:e.jsxs("div",{className:"p-6 space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[e.jsx("div",{className:"bg-blue-50 p-4 rounded-lg border border-blue-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-blue-600",children:"Tổng lịch hẹn"}),e.jsx("p",{className:"text-2xl font-bold text-blue-700",children:m.length})]}),e.jsx(y,{className:"text-blue-500",size:24})]})}),e.jsx("div",{className:"bg-green-50 p-4 rounded-lg border border-green-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-green-600",children:"Sắp tới"}),e.jsx("p",{className:"text-2xl font-bold text-green-700",children:m.filter(t=>t.appointment&&N(t.appointment.appointmentDateTime)).length})]}),e.jsx(A,{className:"text-green-500",size:24})]})}),e.jsx("div",{className:"bg-yellow-50 p-4 rounded-lg border border-yellow-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-yellow-600",children:"Cần tạo lịch"}),e.jsx("p",{className:"text-2xl font-bold text-yellow-700",children:T.length})]}),e.jsx(C,{className:"text-yellow-500",size:24})]})}),e.jsx("div",{className:"bg-gray-50 p-4 rounded-lg border border-gray-200",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("p",{className:"text-sm text-gray-600",children:"Đã hoàn thành"}),e.jsx("p",{className:"text-2xl font-bold text-gray-700",children:m.filter(t=>t.appointment&&F(t.appointment.appointmentDateTime)).length})]}),e.jsx(P,{className:"text-gray-500",size:24})]})})]}),e.jsx(G,{isLoading:b,hasData:m.length>0,loadingMessage:"Đang tải danh sách lịch hẹn...",emptyMessage:"Chưa có lịch hẹn nào",children:e.jsx(W,{data:m,columns:U,loading:b})}),e.jsx(w,{isOpen:z,onClose:()=>x(!1),title:"Tạo lịch hẹn mới",children:e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Chọn quy trình hiến máu"}),e.jsxs("select",{value:a.processId,onChange:t=>l(s=>({...s,processId:t.target.value})),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-red-500",children:[e.jsx("option",{value:"",children:"Chọn quy trình"}),T.map(t=>{var s,i;return e.jsxs("option",{value:t.id,children:["#",t.id," - ",(s=t.donor)==null?void 0:s.fullName," (",(i=t.donor)==null?void 0:i.email,")"]},t.id)})]})]}),e.jsx(p,{label:"Ngày giờ hẹn",type:"datetime-local",value:a.appointmentDateTime,onChange:t=>l(s=>({...s,appointmentDateTime:t.target.value})),required:!0}),e.jsx(p,{label:"Địa điểm",value:a.location,onChange:t=>l(s=>({...s,location:t.target.value})),placeholder:"Bệnh viện Huyết học - FPT",required:!0}),e.jsx(p,{label:"Ghi chú",value:a.notes,onChange:t=>l(s=>({...s,notes:t.target.value})),placeholder:"Nhập ghi chú (tùy chọn)..."}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(o,{variant:"outline",onClick:()=>x(!1),children:"Hủy"}),e.jsx(o,{onClick:R,children:"Tạo lịch hẹn"})]})]})}),e.jsx(w,{isOpen:L,onClose:()=>u(!1),title:"Yêu cầu đổi lịch hẹn",children:e.jsxs("div",{className:"space-y-4",children:[e.jsx("div",{className:"bg-yellow-50 p-3 rounded-lg border border-yellow-200",children:e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(C,{size:16,className:"text-yellow-600"}),"                ",e.jsxs("span",{className:"text-sm text-yellow-700",children:["Lịch hẹn hiện tại: ",(d==null?void 0:d.appointment)&&S(d.appointment.appointmentDateTime)]})]})}),e.jsx(p,{label:"Lý do đổi lịch",value:g.reason,onChange:t=>j(s=>({...s,reason:t.target.value})),placeholder:"Nhập lý do cần đổi lịch...",required:!0}),e.jsx(p,{label:"Đề xuất thời gian mới (tùy chọn)",type:"datetime-local",value:g.suggestedDateTime,onChange:t=>j(s=>({...s,suggestedDateTime:t.target.value}))}),e.jsxs("div",{className:"flex justify-end space-x-2 pt-4",children:[e.jsx(o,{variant:"outline",onClick:()=>u(!1),children:"Hủy"}),e.jsx(o,{variant:"warning",onClick:_,children:"Yêu cầu đổi lịch"})]})]})})]})})};export{ve as default};
