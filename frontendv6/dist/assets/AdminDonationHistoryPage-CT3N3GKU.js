import{j as s,p as E,q as y,t as T,U as S,v as g,C as A,r as m,V as N,B as n}from"./index-0uBgUJAH.js";import{d as D}from"./donationService-DtMzIi16.js";import{S as L}from"./StatusBadge-BlA2KO3p.js";import{I as j}from"./InfoRow-DfUUDnyO.js";import{A as v}from"./ActionButtonGroup-I2VNa9sb.js";import{D as C}from"./DateTimeDisplay-C7GFcxup.js";import{C as I}from"./clock-DvSylXuB.js";import{C as f}from"./circle-check-big-DH52TbDi.js";import{C as _}from"./circle-x-Ynt68wb8.js";import{A as O}from"./AdminPageLayout-DdqsJ0r9.js";import{A as k,a as w}from"./AdminContentWrapper-D75idiX7.js";import{H}from"./constants-QRcisZg4.js";import"./Badge-4CUZIaa-.js";import"./PageHeader-DZCCvaaU.js";import"./Pagination-CR7EbBZ1.js";import"./chevron-left-xbWY0yrx.js";import"./chevron-right-C8WomcHX.js";const b=({donation:t,onViewDetails:c,onStatusUpdate:l,showActions:o=!0,className:e=""})=>{var r,i;const h=d=>({PENDING_APPROVAL:[{label:"Duyệt",variant:"outline",onClick:()=>l(t.id,"APPOINTMENT_PENDING"),icon:f},{label:"Từ chối",variant:"outline",onClick:()=>l(t.id,"REJECTED"),icon:_}],APPOINTMENT_PENDING:[{label:"Lên lịch",onClick:()=>l(t.id,"APPOINTMENT_SCHEDULED"),icon:A}],BLOOD_COLLECTED:[{label:"Xét nghiệm đạt",onClick:()=>l(t.id,"TESTING_PASSED"),icon:f}]}[d]||[]).map(a=>{const p=a.icon;return{...a,label:s.jsxs(s.Fragment,{children:[p&&s.jsx(IconComponentComponent,{className:"w-4 h-4 mr-1"}),a.label]})}});return s.jsxs(E,{hover:!0,className:`cursor-pointer ${e}`,onClick:()=>c&&c(t),children:["      ",s.jsx(y,{className:"pb-3",children:s.jsxs("div",{className:"flex items-center justify-between",children:[s.jsxs(T,{className:"text-lg",children:[s.jsx(S,{className:"w-5 h-5 inline mr-2"}),((r=t.donor)==null?void 0:r.fullName)||"N/A"]}),s.jsx(L,{status:t.status,type:"donation"})]})}),s.jsxs(g,{className:"space-y-3",children:[s.jsx(j,{label:"Ngày yêu cầu",value:s.jsx(C,{date:t.createdAt,format:"date"})}),((i=t.appointment)==null?void 0:i.scheduledDate)&&s.jsx(j,{label:"Ngày hẹn",value:s.jsx(C,{date:t.appointment.scheduledDate,format:"date"})}),t.collectedVolumeMl&&s.jsx(j,{label:"Thể tích",value:`${t.collectedVolumeMl}ml`}),s.jsxs("div",{className:"flex items-center space-x-2 pt-2",children:[s.jsx(I,{className:"w-4 h-4 text-gray-500"}),s.jsxs("span",{className:"text-sm text-gray-500",children:["Cập nhật: ",s.jsx(C,{date:t.updatedAt,format:"date"})]})]}),o&&s.jsx(v,{actions:h(t.status),orientation:"horizontal"})]})]},t.id)},ss=()=>{var u,x;const[t,c]=m.useState([]),[l,o]=m.useState(!0),[e,h]=m.useState(null);m.useEffect(()=>{r()},[]);const r=async()=>{try{o(!0);const a=await D.getAllDonationRequests();c(a.data||[])}catch(a){console.error("Error fetching donations:",a),N.error("Lỗi khi tải đơn yêu cầu hiến máu"),c([])}finally{o(!1)}},i=async(a,p)=>{try{await D.updateDonationStatus(a,{newStatus:p}),N.success("Cập nhật trạng thái thành công"),r()}catch(P){console.error("Error updating status:",P),N.error("Lỗi khi cập nhật trạng thái")}},d=()=>s.jsx(w,{icon:A,title:"Chưa có đơn yêu cầu hiến máu nào",description:"Hiện tại chưa có ai đăng ký hiến máu trong hệ thống."});return s.jsx(O,{title:"Quản lý đơn yêu cầu hiến máu",description:"Theo dõi và quản lý tất cả các quy trình hiến máu",children:s.jsx(k,{isLoading:l,isEmpty:t.length===0,emptyStateComponent:d(),children:s.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[s.jsx("div",{className:"lg:col-span-2 space-y-4",children:t.map(a=>s.jsx(b,{donation:a,onViewDetails:h,onStatusUpdate:i,showActions:!0},a.id))}),s.jsx("div",{className:"lg:col-span-1",children:e?s.jsxs(E,{children:[s.jsx(y,{children:s.jsx(T,{children:"Chi tiết hiến máu"})}),s.jsxs(g,{className:"space-y-4",children:[s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium",children:"Người hiến máu"}),s.jsx("p",{className:"text-sm text-gray-600",children:(u=e.donor)==null?void 0:u.fullName}),s.jsx("p",{className:"text-sm text-gray-600",children:(x=e.donor)==null?void 0:x.email})]}),s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium",children:"Trạng thái"}),s.jsx(L,{status:e.status,type:"donation"})]}),e.appointment&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium",children:"Lịch hẹn"}),s.jsx("p",{className:"text-sm text-gray-600",children:new Date(e.appointment.appointmentDateTime).toLocaleString("vi-VN")}),s.jsx("p",{className:"text-sm text-gray-600",children:H.FULL_NAME})]}),e.note&&s.jsxs("div",{children:[s.jsx("h4",{className:"font-medium",children:"Ghi chú"}),s.jsx("p",{className:"text-sm text-gray-600",children:e.note})]}),s.jsxs("div",{className:"space-y-2",children:[s.jsx("h4",{className:"font-medium",children:"Cập nhật trạng thái"}),e.status==="PENDING_APPROVAL"&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(n,{size:"sm",className:"w-full",onClick:()=>i(e.id,"APPOINTMENT_PENDING"),children:"Duyệt đơn"}),s.jsx(n,{variant:"outline",size:"sm",className:"w-full",onClick:()=>i(e.id,"REJECTED"),children:"Từ chối"})]}),e.status==="APPOINTMENT_SCHEDULED"&&s.jsx(n,{size:"sm",className:"w-full",onClick:()=>i(e.id,"HEALTH_CHECK_PASSED"),children:"Khám sàng lọc đạt"}),e.status==="HEALTH_CHECK_PASSED"&&s.jsx(n,{size:"sm",className:"w-full",onClick:()=>i(e.id,"BLOOD_COLLECTED"),children:"Đã lấy máu"}),e.status==="BLOOD_COLLECTED"&&s.jsxs("div",{className:"space-y-2",children:[s.jsx(n,{size:"sm",className:"w-full",onClick:()=>i(e.id,"TESTING_PASSED"),children:"Xét nghiệm đạt"}),s.jsx(n,{variant:"outline",size:"sm",className:"w-full",onClick:()=>i(e.id,"TESTING_FAILED"),children:"Xét nghiệm không đạt"})]}),e.status==="TESTING_PASSED"&&s.jsx(n,{size:"sm",className:"w-full",onClick:()=>i(e.id,"COMPLETED"),children:"Hoàn thành"})]})]})]}):s.jsx(E,{children:s.jsx(g,{className:"p-6 text-center text-gray-500",children:"Chọn một quy trình hiến máu để xem chi tiết"})})})]})})})};export{ss as default};
