import{i as I,b as V,r as m,j as e,l as b,f as y,B as j,V as h}from"./index-1dtSQISR.js";import{u as C}from"./userService-BowyxDMX.js";import{b as E}from"./bloodTypeService-CnW7m_57.js";import{I as c}from"./InputField-1_bs09Nb.js";import{A as B}from"./arrow-left-C8dUBY5m.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D=[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]],P=I("user-plus",D),L=()=>{const N=V(),[s,v]=m.useState({username:"",email:"",fullName:"",password:"",confirmPassword:"",roleName:"MEMBER",dateOfBirth:"",phone:"",address:"",bloodTypeId:"",status:"Active",emailVerified:!1,phoneVerified:!1}),[g,k]=m.useState([]),[f,w]=m.useState([]),[a,u]=m.useState(!1),[d,x]=m.useState({});m.useEffect(()=>{(async()=>{u(!0);try{k([{name:"ADMIN"},{name:"STAFF"},{name:"MEMBER"}]);const o=await E.getAll();w(o||[])}catch(t){console.error(t),h.error(`Không thể tải dữ liệu: ${t.message||"Không thể tải dữ liệu"}`),console.error("Data loading error:",t)}u(!1)})()},[]);const n=r=>{const{name:t,value:o,type:i,checked:p}=r.target;v(l=>({...l,[t]:i==="checkbox"?p:o})),d[t]&&x(l=>({...l,[t]:null}))},T=()=>{const r={};return s.username.trim()?s.username.length<3&&(r.username="Tên đăng nhập phải có ít nhất 3 ký tự."):r.username="Tên đăng nhập không được để trống.",s.email.trim()?/\S+@\S+\.\S+/.test(s.email)||(r.email="Email không hợp lệ."):r.email="Email không được để trống.",s.fullName.trim()||(r.fullName="Họ tên không được để trống."),s.password?s.password.length<6&&(r.password="Mật khẩu phải có ít nhất 6 ký tự."):r.password="Mật khẩu không được để trống.",s.password!==s.confirmPassword&&(r.confirmPassword="Mật khẩu xác nhận không khớp."),s.roleName||(r.roleName="Vai trò không được để trống."),s.dateOfBirth||(r.dateOfBirth="Ngày sinh không được để trống."),s.phone.trim()?(s.phone.length<9||s.phone.length>15)&&(r.phone="Số điện thoại phải có từ 9-15 ký tự."):r.phone="Số điện thoại không được để trống.",s.address.trim()?s.address.length<10&&(r.address="Địa chỉ phải có ít nhất 10 ký tự."):r.address="Địa chỉ không được để trống.",x(r),Object.keys(r).length===0},S=async r=>{if(r.preventDefault(),!T()){h.error("Vui lòng kiểm tra lại các trường thông tin.");return}u(!0);const t=h.loading("Đang tạo người dùng..."),o={...s,phone:s.phone.trim(),address:s.address.trim(),bloodTypeId:s.bloodTypeId?parseInt(s.bloodTypeId,10):null};delete o.confirmPassword;try{await C.createUserByAdmin(o),h.success("Tạo người dùng thành công!",{id:t}),N("/admin/users")}catch(i){if(console.error("User creation error:",i),h.error(`Tạo người dùng thất bại: ${i.message||"Vui lòng thử lại."}`,{id:t}),i.response&&i.response.data&&typeof i.response.data=="object"){const p={};for(const l in i.response.data)p[l]=i.response.data[l];x(l=>({...l,...p}))}}finally{u(!1)}};return a&&g.length===0?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(b,{size:"12"})}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs(y,{to:"/admin/users",className:"flex items-center text-red-600 hover:text-red-800 mb-4",children:[e.jsx(B,{size:20,className:"mr-2"}),"Quay lại danh sách"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Tạo Người dùng mới"}),e.jsxs("form",{onSubmit:S,className:"bg-white p-8 rounded-lg shadow-md space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Tên đăng nhập",id:"username",name:"username",value:s.username,onChange:n,required:!0,error:d.username,disabled:a}),e.jsx(c,{label:"Email",id:"email",name:"email",type:"email",value:s.email,onChange:n,required:!0,error:d.email,disabled:a})]}),e.jsx(c,{label:"Họ và tên đầy đủ",id:"fullName",name:"fullName",value:s.fullName,onChange:n,required:!0,error:d.fullName,disabled:a}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Mật khẩu",id:"password",name:"password",type:"password",value:s.password,onChange:n,required:!0,error:d.password,disabled:a}),e.jsx(c,{label:"Xác nhận mật khẩu",id:"confirmPassword",name:"confirmPassword",type:"password",value:s.confirmPassword,onChange:n,required:!0,error:d.confirmPassword,disabled:a})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Ngày sinh",id:"dateOfBirth",name:"dateOfBirth",type:"date",value:s.dateOfBirth,onChange:n,required:!0,error:d.dateOfBirth,disabled:a}),e.jsx(c,{label:"Số điện thoại",id:"phone",name:"phone",type:"tel",value:s.phone,onChange:n,required:!0,error:d.phone,disabled:a,placeholder:"VD: 0901234567"})]}),e.jsx(c,{label:"Địa chỉ",id:"address",name:"address",as:"textarea",rows:3,value:s.address,onChange:n,required:!0,error:d.address,disabled:a,placeholder:"Nhập địa chỉ đầy đủ (tối thiểu 10 ký tự)"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"roleName",className:"block text-sm font-medium text-gray-700 mb-1",children:["Vai trò ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"roleName",name:"roleName",value:s.roleName,onChange:n,disabled:a||g.length===0,required:!0,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${d.roleName?"border-red-500":"border-gray-300"}`,children:g.map(r=>e.jsxs("option",{value:r.name,children:[r.name," (",r.description,")"]},r.name))}),d.roleName&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:d.roleName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Trạng thái"}),e.jsxs("select",{id:"status",name:"status",value:s.status,onChange:n,disabled:a,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Suspended",children:"Suspended"}),e.jsx("option",{value:"Pending",children:"Pending"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nhóm máu (Tùy chọn)"}),e.jsxs("select",{id:"bloodTypeId",name:"bloodTypeId",value:s.bloodTypeId,onChange:n,disabled:a||f.length===0,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm",children:[e.jsx("option",{value:"",children:"-- Chọn nhóm máu --"}),f.filter((r,t,o)=>t===o.findIndex(i=>i.bloodGroup===r.bloodGroup)).map(r=>e.jsx("option",{value:r.id,children:r.bloodGroup},r.id))]})]}),e.jsxs("div",{className:"flex items-center space-x-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"emailVerified",name:"emailVerified",type:"checkbox",checked:s.emailVerified,onChange:n,disabled:a,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"emailVerified",className:"ml-2 block text-sm text-gray-900",children:"Email đã xác thực"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"phoneVerified",name:"phoneVerified",type:"checkbox",checked:s.phoneVerified,onChange:n,disabled:a,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"phoneVerified",className:"ml-2 block text-sm text-gray-900",children:"SĐT đã xác thực"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(y,{to:"/admin/users",children:e.jsx(j,{type:"button",variant:"secondary",disabled:a,children:"Hủy"})}),e.jsxs(j,{type:"submit",variant:"primary",disabled:a,children:[a?e.jsx(b,{size:"5",color:"white",className:"mr-2"}):e.jsx(P,{size:18,className:"mr-2"}),a?"Đang lưu...":"Tạo người dùng"]})]})]})]})};export{L as default};
