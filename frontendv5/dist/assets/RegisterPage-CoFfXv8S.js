import{r as n,u as L,a as z,b as D,h as I,j as e,L as b,I as i,E as C,c as S,d as R,B as G,e as E}from"./index---XYpbwv.js";import{b as H}from"./bloodTypeService-DVaU63AT.js";import{U as M}from"./user-plus-DD0rCE2h.js";const X=()=>{const[t,P]=n.useState({fullName:"",email:"",phone:"",address:"",dateOfBirth:"",password:"",confirmPassword:"",bloodTypeId:"",agreeTerms:!1}),[x,B]=n.useState(!1),[g,q]=n.useState(!1),[f,j]=n.useState([]),[o,v]=n.useState(!1),[a,u]=n.useState({}),{requestRegistration:A,isAuthenticated:w,loading:l}=L(),{showNotification:h,setLoading:N}=z(),y=D(),T=n.useCallback(async()=>{v(!0);try{const r=await H.getAll();j(r||[])}catch(r){I(r,h),j([])}finally{v(!1)}},[h]);n.useEffect(()=>{w?y("/",{replace:!0}):T()},[w,y,T]);const d=async r=>{const{name:s,value:c,type:m,checked:O}=r.target,k=m==="checkbox"?O:c;P(p=>({...p,[s]:k})),a[s]&&u(p=>({...p,[s]:""}));try{await E.validateAt(s,{...t,[s]:k})}catch(p){u(V=>({...V,[s]:p.message}))}},F=async r=>{r.preventDefault();try{await E.validate(t,{abortEarly:!1}),u({}),N(!0);const s={...t,bloodTypeId:t.bloodTypeId?parseInt(t.bloodTypeId,10):null};delete s.confirmPassword,delete s.agreeTerms,await A(s),h("Mã OTP đã được gửi! Vui lòng kiểm tra email.","success"),y("/verify-otp",{state:{registrationData:s}})}catch(s){if(s.name==="ValidationError"){const c={};s.inner.forEach(m=>{c[m.path]=m.message}),u(c),h("Vui lòng kiểm tra lại thông tin đăng ký.","error")}else I(s,h)}finally{N(!1)}};return e.jsx("div",{className:"max-h-screen bg-gray-50 flex flex-col",children:e.jsx("main",{className:"flex-grow flex items-center justify-center py-12 px-4 sm:px-6 lg:px-8 pt-20 sm:pt-24",children:e.jsxs("div",{className:"max-w-lg w-full space-y-8",children:[e.jsxs("div",{className:"text-center",children:[e.jsx(M,{className:"mx-auto h-12 w-auto text-red-600"}),e.jsx("h2",{className:"mt-6 text-3xl font-extrabold text-gray-900",children:"Tạo tài khoản mới"}),e.jsxs("p",{className:"mt-2 text-sm text-gray-600",children:["Hoặc"," ",e.jsx(b,{to:"/login",className:"font-medium text-red-600 hover:text-red-500",children:"đăng nhập nếu đã có tài khoản"})]})]}),e.jsx("div",{className:"bg-white py-8 px-6 shadow-xl rounded-xl sm:px-10",children:e.jsxs("form",{onSubmit:F,className:"space-y-5",children:[e.jsx(i,{label:"Họ và tên đầy đủ",id:"fullName",name:"fullName",type:"text",value:t.fullName,onChange:d,placeholder:"Ví dụ: Nguyễn Văn An",required:!0,disabled:l||o,error:a.fullName}),e.jsx(i,{label:"Địa chỉ Email",id:"email",name:"email",type:"email",value:t.email,onChange:d,placeholder:"you@example.com",required:!0,disabled:l||o,error:a.email}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-5 gap-y-5",children:[e.jsx(i,{label:"Ngày sinh",id:"dateOfBirth",name:"dateOfBirth",type:"date",value:t.dateOfBirth,onChange:d,required:!0,disabled:l||o,error:a.dateOfBirth}),e.jsx(i,{label:"Số điện thoại",id:"phone",name:"phone",type:"tel",value:t.phone,onChange:d,placeholder:"Ví dụ: 0987654321",required:!0,disabled:l||o,error:a.phone})]}),e.jsx(i,{label:"Địa chỉ",id:"address",name:"address",type:"text",value:t.address,onChange:d,placeholder:"Số nhà, đường, phường/xã, quận/huyện, tỉnh/thành phố",required:!0,disabled:l||o,error:a.address}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-x-5 gap-y-5",children:[e.jsx(i,{label:"Mật khẩu",id:"password",name:"password",type:x?"text":"password",value:t.password,onChange:d,placeholder:"Ít nhất 6 ký tự",required:!0,disabled:l||o,hasIcon:!0,icon:x?e.jsx(C,{size:20}):e.jsx(S,{size:20}),onIconClick:()=>B(!x),error:a.password}),e.jsx(i,{label:"Xác nhận mật khẩu",id:"confirmPassword",name:"confirmPassword",type:g?"text":"password",value:t.confirmPassword,onChange:d,placeholder:"Nhập lại mật khẩu",required:!0,disabled:l||o,hasIcon:!0,icon:g?e.jsx(C,{size:20}):e.jsx(S,{size:20}),onIconClick:()=>q(!g),error:a.confirmPassword})]}),e.jsxs("div",{className:"col-span-1 md:col-span-2",children:[e.jsx("label",{htmlFor:"bloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nhóm máu (Tùy chọn)"}),o?e.jsx("div",{className:"py-2",children:e.jsx(R,{size:"6"})}):e.jsxs("select",{id:"bloodTypeId",name:"bloodTypeId",value:t.bloodTypeId,onChange:d,disabled:l||o||f.length===0,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${a.bloodTypeId?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Chọn nhóm máu --"}),f.filter((r,s,c)=>s===c.findIndex(m=>m.bloodGroup===r.bloodGroup)).map(r=>e.jsx("option",{value:r.id,children:r.bloodGroup},r.id))]}),a.bloodTypeId&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:a.bloodTypeId}),f.length===0&&!o&&e.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Không tải được danh sách nhóm máu."})]}),e.jsxs("div",{className:"flex items-start pt-2",children:[e.jsx("input",{id:"agreeTerms",name:"agreeTerms",type:"checkbox",checked:t.agreeTerms,onChange:d,className:`h-4 w-4 text-red-600 focus:ring-red-500 rounded mt-1 ${a.agreeTerms?"border-red-500":"border-gray-300"}`,disabled:l||o,required:!0}),e.jsxs("label",{htmlFor:"agreeTerms",className:"ml-2 block text-sm text-gray-700",children:["Tôi đã đọc và đồng ý với"," ",e.jsx(b,{to:"/terms",className:"font-medium text-red-600 hover:text-red-500",children:"Điều khoản sử dụng"})," ","và"," ",e.jsx(b,{to:"/privacy",className:"font-medium text-red-600 hover:text-red-500",children:"Chính sách bảo mật"})," ","của LifeBlood."]})]}),a.agreeTerms&&e.jsx("p",{className:"text-xs text-red-600",children:a.agreeTerms}),e.jsx(G,{type:"submit",className:"w-full",disabled:l||o||Object.keys(a).some(r=>a[r]),isLoading:l,variant:"primary",size:"lg",children:"Đăng ký tài khoản"})]})})]})})})};export{X as default};
