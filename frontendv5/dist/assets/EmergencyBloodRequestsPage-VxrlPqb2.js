import{r as g,u as C,j as e,w,B as R,H as A,V as d,l as B,R as T,T as N,d as E,p as L,q as U,t as I,v as P}from"./index-1dtSQISR.js";import{b as v}from"./bloodRequestService-DoX1abWj.js";import{P as H}from"./PageHeader-W4hk3_1v.js";import{E as S}from"./EmptyState-CqnLvH6d.js";import{u as V}from"./useAuthRedirect-BvHGsnNW.js";import{B as D}from"./Badge-DVxHSo1W.js";import{D as M}from"./DateTimeDisplay-BybaiEr8.js";import{H as b}from"./constants-QRcisZg4.js";import{C as O}from"./clock-BK2pyYK-.js";import"./circle-check-big-CJhYsvhV.js";import"./plus-C4tZkhei.js";const K=({request:s,onPledgeSuccess:a})=>{var y,j;const[c,l]=g.useState(!1),{user:n,isAuthenticated:i}=C(),{requireAuth:m}=V(),t=(y=s.pledges)==null?void 0:y.some(f=>{var h;return((h=f.donor)==null?void 0:h.id)===(n==null?void 0:n.id)}),o=async()=>{var h;if(m(null,"Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒëƒÉng k√Ω hi·∫øn m√°u.")){if(t){d.error("B·∫°n ƒë√£ ƒëƒÉng k√Ω hi·∫øn m√°u cho y√™u c·∫ßu n√†y r·ªìi.");return}l(!0);try{await v.pledgeForRequest(s.id),d.success("ƒêƒÉng k√Ω hi·∫øn m√°u th√†nh c√¥ng! Vui l√≤ng ƒë·∫øn b·ªánh vi·ªán trong 24-48 gi·ªù ƒë·ªÉ ho√†n th√†nh hi·∫øn m√°u.",{duration:6e3}),a==null||a()}catch(k){((h=k.response)==null?void 0:h.status)===409?d.error("B·∫°n ƒë√£ ƒëƒÉng k√Ω hi·∫øn m√°u cho y√™u c·∫ßu n√†y r·ªìi."):d.error("Kh√¥ng th·ªÉ ƒëƒÉng k√Ω hi·∫øn m√°u. Vui l√≤ng th·ª≠ l·∫°i.")}finally{l(!1)}}},u=s.pledgeCount||((j=s.pledges)==null?void 0:j.length)||0,x=(s.quantityInUnits||s.quantityNeeded||1)+1,r=s.urgency==="URGENT",p=s.urgency==="CRITICAL";return e.jsxs("div",{className:"space-y-3",children:["      ",e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(w,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:[u,"/",x," ng∆∞·ªùi ƒë√£ ƒëƒÉng k√Ω hi·∫øn"]})]}),e.jsxs("div",{className:"text-gray-500",children:["C·∫ßn: ",s.quantityInUnits||s.quantityNeeded||1," ƒë∆°n v·ªã"]})]}),e.jsxs(R,{onClick:o,disabled:c||t||!i,variant:t?"outline":p?"danger":r?"warning":"primary",className:"w-full flex items-center justify-center",children:[e.jsx(A,{className:`w-4 h-4 mr-2 ${t?"fill-current":""}`}),c?"ƒêang x·ª≠ l√Ω...":t?"ƒê√£ ƒëƒÉng k√Ω hi·∫øn m√°u":"ƒêƒÉng k√Ω hi·∫øn m√°u"]}),!i&&e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Vui l√≤ng ƒëƒÉng nh·∫≠p ƒë·ªÉ ƒëƒÉng k√Ω hi·∫øn m√°u"}),t&&e.jsx("p",{className:"text-xs text-green-600 text-center",children:"‚úì C·∫£m ∆°n b·∫°n ƒë√£ ƒëƒÉng k√Ω hi·∫øn m√°u cho y√™u c·∫ßu n√†y"})]})},F=({urgency:s,className:a,...c})=>{const n=(i=>{switch(i){case"CRITICAL":return{variant:"error",label:"C·ª±c k·ª≥ kh·∫©n c·∫•p"};case"URGENT":return{variant:"warning",label:"Kh·∫©n c·∫•p"};case"NORMAL":return{variant:"info",label:"B√¨nh th∆∞·ªùng"};default:return{variant:"default",label:i}}})(s);return e.jsx(D,{variant:n.variant,className:a,...c,children:n.label})},se=()=>{const[s,a]=g.useState([]),[c,l]=g.useState(!0);g.useEffect(()=>{n()},[]);const n=async()=>{var t,o,u,x;try{l(!0);const r=await v.searchActiveRequests();a(r.data||r||[])}catch(r){if(console.error(r),((t=r.response)==null?void 0:t.status)===401)d.error("B·∫°n c·∫ßn ƒëƒÉng nh·∫≠p ƒë·ªÉ xem danh s√°ch y√™u c·∫ßu m√°u kh·∫©n c·∫•p");else if(((o=r.response)==null?void 0:o.status)===0||r.code==="ECONNABORTED")d.error("Kh√¥ng th·ªÉ k·∫øt n·ªëi ƒë·∫øn m√°y ch·ªß. Vui l√≤ng ki·ªÉm tra k·∫øt n·ªëi m·∫°ng.");else{const p=((x=(u=r.response)==null?void 0:u.data)==null?void 0:x.message)||"Kh√¥ng th·ªÉ t·∫£i danh s√°ch y√™u c·∫ßu m√°u kh·∫©n c·∫•p";d.error(p)}a([])}finally{l(!1)}},i=()=>{n(),d.success("C·∫£m ∆°n b·∫°n ƒë√£ cam k·∫øt hi·∫øn m√°u! Vui l√≤ng ƒë·∫øn b·ªánh vi·ªán theo th√¥ng tin ƒë∆∞·ª£c cung c·∫•p.")},m=[{label:"L√†m m·ªõi",icon:T,onClick:n,variant:"outline"}];return c?e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx(B,{size:"12"})})})}):e.jsx("div",{className:"min-h-screen bg-gray-50 py-8",children:e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:[e.jsx(H,{title:"Y√™u c·∫ßu m√°u kh·∫©n c·∫•p",description:"Nh·ªØng y√™u c·∫ßu c·∫ßn h·ªó tr·ª£ g·∫•p t·ª´ c√°c b·ªánh vi·ªán. H√£y cam k·∫øt hi·∫øn m√°u ƒë·ªÉ c·ª©u ng∆∞·ªùi!",icon:N,actions:m}),e.jsx("div",{className:"mb-8 bg-blue-50 border-l-4 border-blue-400 p-4 rounded-lg",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(E,{className:"w-5 h-5 text-blue-400 mr-2"}),e.jsxs("div",{children:[e.jsx("h3",{className:"text-lg font-medium text-blue-900",children:"ƒê·ªãa ƒëi·ªÉm hi·∫øn m√°u"}),e.jsx("p",{className:"text-blue-700 mt-1",children:b.FULL_ADDRESS}),e.jsxs("p",{className:"text-sm text-blue-600 mt-2",children:["üí° ",e.jsx("strong",{children:"L∆∞u √Ω:"})," Sau khi cam k·∫øt, vui l√≤ng ƒë·∫øn b·ªánh vi·ªán trong v√≤ng 24-48 gi·ªù ƒë·ªÉ ho√†n th√†nh qu√° tr√¨nh hi·∫øn m√°u."]})]})]})}),s.length>0?e.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:s.map(t=>e.jsx(G,{request:t,onPledgeSuccess:i},t.id))}):e.jsx(S,{type:"results",title:"Hi·ªán t·∫°i kh√¥ng c√≥ y√™u c·∫ßu m√°u kh·∫©n c·∫•p",description:"Tuy·ªát v·ªùi! Hi·ªán t·∫°i kh√¥ng c√≥ y√™u c·∫ßu m√°u kh·∫©n c·∫•p n√†o. H√£y quay l·∫°i sau ho·∫∑c ki·ªÉm tra c√°c y√™u c·∫ßu hi·∫øn m√°u th∆∞·ªùng xuy√™n kh√°c.",action:{label:"Xem t·∫•t c·∫£ y√™u c·∫ßu",href:"/blood-requests"}})]})})},G=({request:s,onPledgeSuccess:a})=>{var i,m;const c=s.pledgeCount||((i=s.pledges)==null?void 0:i.length)||0,l=(s.quantityInUnits||1)+1,n=Math.min(c/l*100,100);return e.jsxs(L,{className:"hover:shadow-lg transition-shadow border-l-4 border-l-red-500",children:[e.jsx(U,{className:"pb-3",children:e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs(I,{className:"text-lg text-red-600 flex items-center",children:[e.jsx(N,{className:"w-5 h-5 mr-2"}),"C·∫ßn m√°u ",(m=s.bloodType)==null?void 0:m.bloodGroup]}),e.jsx(F,{urgency:s.urgency})]})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"B·ªánh nh√¢n:"}),e.jsx("span",{className:"text-sm text-gray-900 font-medium",children:s.patientName})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"B·ªánh vi·ªán:"}),e.jsx("span",{className:"text-sm text-gray-900",children:s.hospital})]}),e.jsxs("div",{className:"flex justify-between",children:[e.jsx("span",{className:"text-sm font-medium text-gray-600",children:"S·ªë l∆∞·ª£ng:"}),"            ",e.jsxs("span",{className:"text-sm font-semibold text-red-600",children:[s.quantityInUnits," ƒë∆°n v·ªã"]})]})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsxs("div",{className:"flex justify-between text-sm",children:[e.jsx("span",{className:"text-gray-600",children:"Ti·∫øn ƒë·ªô cam k·∫øt:"}),e.jsxs("span",{className:"font-medium",children:[c,"/",l," ng∆∞·ªùi"]})]}),e.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:e.jsx("div",{className:"bg-red-500 h-2 rounded-full transition-all duration-300",style:{width:`${n}%`}})})]}),e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(O,{className:"w-4 h-4 mr-1"}),e.jsx("span",{children:"T·∫°o l√∫c: "}),e.jsx(M,{date:s.createdAt,format:"relative"})]}),e.jsx("div",{className:"pt-2",children:e.jsx(K,{request:s,onPledgeSuccess:a})}),e.jsx("div",{className:"mt-4 p-3 bg-blue-50 rounded-md",children:e.jsxs("p",{className:"text-xs text-blue-700",children:["üí° ",e.jsx("strong",{children:"Sau khi cam k·∫øt:"})," Vui l√≤ng ƒë·∫øn ",b.NAME," trong v√≤ng 24-48 gi·ªù ƒë·ªÉ ho√†n th√†nh hi·∫øn m√°u."]})})]})]})};export{se as default};
