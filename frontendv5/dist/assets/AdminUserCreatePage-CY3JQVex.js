import{b as I,r as m,j as e,d as y,L as j,I as c,B as N,V as h}from"./index---XYpbwv.js";import{u as f}from"./userService-BVSG9cXN.js";import{A as C}from"./arrow-left-CYlgApu7.js";import{U as P}from"./user-plus-DD0rCE2h.js";const q=()=>{const v=I(),[r,w]=m.useState({username:"",email:"",fullName:"",password:"",confirmPassword:"",roleName:"Member",bloodTypeId:"",phone:"",status:"Active",emailVerified:!1,phoneVerified:!1}),[g,k]=m.useState([]),[b,T]=m.useState([]),[a,u]=m.useState(!1),[l,x]=m.useState({});m.useEffect(()=>{(async()=>{u(!0);try{const n=await f.getRoles();k(n||[]);const i=await f.getBloodTypes();T(i||[])}catch(n){h.error("Lỗi khi tải dữ liệu Roles hoặc Blood Types: "+n.message)}u(!1)})()},[]);const t=s=>{const{name:n,value:i,type:o,checked:p}=s.target;w(d=>({...d,[n]:o==="checkbox"?p:i})),l[n]&&x(d=>({...d,[n]:null}))},S=()=>{const s={};return r.username.trim()?r.username.length<3&&(s.username="Tên đăng nhập phải có ít nhất 3 ký tự."):s.username="Tên đăng nhập không được để trống.",r.email.trim()?/\S+@\S+\.\S+/.test(r.email)||(s.email="Email không hợp lệ."):s.email="Email không được để trống.",r.fullName.trim()||(s.fullName="Họ tên không được để trống."),r.password?r.password.length<6&&(s.password="Mật khẩu phải có ít nhất 6 ký tự."):s.password="Mật khẩu không được để trống.",r.password!==r.confirmPassword&&(s.confirmPassword="Mật khẩu xác nhận không khớp."),r.roleName||(s.roleName="Vai trò không được để trống."),x(s),Object.keys(s).length===0},V=async s=>{if(s.preventDefault(),!S()){h.error("Vui lòng kiểm tra lại các trường thông tin.");return}u(!0);const n=h.loading("Đang tạo người dùng..."),i={...r,phone:r.phone.trim()||null,bloodTypeId:r.bloodTypeId?parseInt(r.bloodTypeId,10):null};delete i.confirmPassword;try{await f.createUserByAdmin(i),h.success("Tạo người dùng thành công!",{id:n}),v("/admin/users")}catch(o){if(h.error(`Lỗi khi tạo người dùng: ${o.message||"Vui lòng thử lại."}`,{id:n}),o.response&&o.response.data&&typeof o.response.data=="object"){const p={};for(const d in o.response.data)p[d]=o.response.data[d];x(d=>({...d,...p}))}}finally{u(!1)}};return a&&g.length===0?e.jsx("div",{className:"flex justify-center items-center h-64",children:e.jsx(y,{size:"12"})}):e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs(j,{to:"/admin/users",className:"flex items-center text-red-600 hover:text-red-800 mb-4",children:[e.jsx(C,{size:20,className:"mr-2"}),"Quay lại danh sách"]}),e.jsx("h1",{className:"text-2xl font-bold text-gray-800 mb-6",children:"Tạo Người dùng mới"}),e.jsxs("form",{onSubmit:V,className:"bg-white p-8 rounded-lg shadow-md space-y-6",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Tên đăng nhập",id:"username",name:"username",value:r.username,onChange:t,required:!0,error:l.username,disabled:a}),e.jsx(c,{label:"Email",id:"email",name:"email",type:"email",value:r.email,onChange:t,required:!0,error:l.email,disabled:a})]}),e.jsx(c,{label:"Họ và tên đầy đủ",id:"fullName",name:"fullName",value:r.fullName,onChange:t,required:!0,error:l.fullName,disabled:a}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Mật khẩu",id:"password",name:"password",type:"password",value:r.password,onChange:t,required:!0,error:l.password,disabled:a}),e.jsx(c,{label:"Xác nhận mật khẩu",id:"confirmPassword",name:"confirmPassword",type:"password",value:r.confirmPassword,onChange:t,required:!0,error:l.confirmPassword,disabled:a})]}),e.jsx(c,{label:"Số điện thoại (Tùy chọn)",id:"phone",name:"phone",type:"tel",value:r.phone,onChange:t,error:l.phone,disabled:a}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"roleName",className:"block text-sm font-medium text-gray-700 mb-1",children:["Vai trò ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsx("select",{id:"roleName",name:"roleName",value:r.roleName,onChange:t,disabled:a||g.length===0,required:!0,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${l.roleName?"border-red-500":"border-gray-300"}`,children:g.map(s=>e.jsxs("option",{value:s.name,children:[s.name," (",s.description,")"]},s.name))}),l.roleName&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:l.roleName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Trạng thái"}),e.jsxs("select",{id:"status",name:"status",value:r.status,onChange:t,disabled:a,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm",children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Suspended",children:"Suspended"}),e.jsx("option",{value:"Pending",children:"Pending"})]})]})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nhóm máu (Tùy chọn)"}),e.jsxs("select",{id:"bloodTypeId",name:"bloodTypeId",value:r.bloodTypeId,onChange:t,disabled:a||b.length===0,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm",children:[e.jsx("option",{value:"",children:"-- Chọn nhóm máu --"}),b.filter((s,n,i)=>n===i.findIndex(o=>o.bloodGroup===s.bloodGroup)).map(s=>e.jsx("option",{value:s.id,children:s.bloodGroup},s.id))]})]}),e.jsxs("div",{className:"flex items-center space-x-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"emailVerified",name:"emailVerified",type:"checkbox",checked:r.emailVerified,onChange:t,disabled:a,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"emailVerified",className:"ml-2 block text-sm text-gray-900",children:"Email đã xác thực"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"phoneVerified",name:"phoneVerified",type:"checkbox",checked:r.phoneVerified,onChange:t,disabled:a,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"phoneVerified",className:"ml-2 block text-sm text-gray-900",children:"SĐT đã xác thực"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3",children:[e.jsx(j,{to:"/admin/users",children:e.jsx(N,{type:"button",variant:"secondary",disabled:a,children:"Hủy"})}),e.jsxs(N,{type:"submit",variant:"primary",disabled:a,children:[a?e.jsx(y,{size:"5",color:"white",className:"mr-2"}):e.jsx(P,{size:18,className:"mr-2"}),a?"Đang lưu...":"Tạo người dùng"]})]})]})]})};export{q as default};
