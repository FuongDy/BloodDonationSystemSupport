import{i as K,b as ae,r as c,V as f,j as e,l as M,f as N,B as D,e as te,M as O,P as R,d as F,H as U,S as P}from"./index-0uBgUJAH.js";import{u as $}from"./userService-BNMUZcKQ.js";import{b as se}from"./bloodTypeService-DnR_6EM4.js";import{A as le}from"./arrow-left-B1x4Q8XC.js";import{P as ie}from"./pen-line-Ca_-Skb_.js";import{C as p,a as T}from"./circle-user-CY9jjH_T.js";import{C as u}from"./circle-check-big-DH52TbDi.js";import{C as x}from"./circle-x-Ynt68wb8.js";import{C}from"./clock-DvSylXuB.js";import{S as ne}from"./save-MirIYU5C.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const re=[["path",{d:"M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"jecpp"}],["rect",{width:"20",height:"14",x:"2",y:"6",rx:"2",key:"i6l2r4"}]],H=K("briefcase",re);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oe=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]],z=K("circle-help",oe),ye=({userId:b,mode:w="view"})=>{const A=ae(),[a,k]=c.useState(null),[d,I]=c.useState({fullName:"",phone:"",dateOfBirth:"",gender:"",address:"",emergencyContact:"",bloodTypeId:"",medicalConditions:"",lastDonationDate:"",isReadyToDonate:!0,roleName:"",status:"",emailVerified:!1,phoneVerified:!1}),[G,_]=c.useState([]),[Q,X]=c.useState([]),[Y,L]=c.useState(!0),[h,B]=c.useState(!1),[g,E]=c.useState({}),i=w==="edit",q=w==="view",S=c.useCallback(async(n=!1)=>{var o;L(!0);try{const l=[{name:"ADMIN",description:"Quản trị viên"},{name:"STAFF",description:"Nhân viên"},{name:"MEMBER",description:"Thành viên"}],[s,m]=await Promise.all([$.getUserByIdForAdmin(b,n),se.getAll()]);if(k(s),_(l),X(m||[]),i){const r={fullName:s.fullName||"",phone:s.phone||"",dateOfBirth:s.dateOfBirth||"",gender:s.gender||"",address:s.address||"",emergencyContact:s.emergencyContact||"",bloodTypeId:((o=s.bloodType)==null?void 0:o.id)||s.bloodTypeId||"",medicalConditions:s.medicalConditions||"",lastDonationDate:s.lastDonationDate||"",isReadyToDonate:s.isReadyToDonate!==null?s.isReadyToDonate:!0,roleName:s.role||s.roleName||"",status:s.status||"ACTIVE",emailVerified:s.emailVerified||!1,phoneVerified:s.phoneVerified||!1};I(r)}}catch(l){console.error("Failed to fetch user data:",l),f.error(`Failed to create user: ${l.message}`),A("/admin/users")}finally{L(!1)}},[b,A,i]);c.useEffect(()=>{S()},[S]);const y=n=>{const{name:o,value:l,type:s,checked:m}=n.target;I(r=>({...r,[o]:s==="checkbox"?m:l})),g[o]&&E(r=>({...r,[o]:null}))},J=()=>{const n={};return d.fullName.trim()||(n.fullName="Họ tên không được để trống."),E(n),Object.keys(n).length===0},W=async n=>{if(n.preventDefault(),!J()){f.error("Vui lòng kiểm tra lại các trường thông tin.");return}B(!0);const o=f.loading("Đang cập nhật người dùng..."),l={...d,bloodTypeId:d.bloodTypeId?parseInt(d.bloodTypeId,10):null};l.phone===""&&(l.phone=null),l.gender===""&&(l.gender=null),l.address===""&&(l.address=null),l.emergencyContact===""&&(l.emergencyContact=null),l.medicalConditions===""&&(l.medicalConditions=null),l.dateOfBirth||(l.dateOfBirth=null),l.lastDonationDate||(l.lastDonationDate=null);try{const s=await $.updateUserByAdmin(b,l);f.success("Cập nhật người dùng thành công!",{id:o}),k(null),await S(!0)}catch(s){console.error("Update user error:",s),f.error(`Cập nhật người dùng thất bại: ${s.message||"Vui lòng thử lại."}`,{id:o}),s.response&&s.response.data&&typeof s.response.data=="object"&&E(m=>({...m,...s.response.data}))}finally{B(!1)}},t=({icon:n,label:o,value:l,highlight:s=!1,isEditable:m=!1,fieldName:r="",fieldType:v="text",options:Z=[],rows:ee=1})=>e.jsxs("div",{className:"py-3 sm:grid sm:grid-cols-3 sm:gap-4",children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[e.jsx(n,{size:16,className:"mr-2 text-red-600"}),o,i&&m&&e.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),e.jsx("dd",{className:"mt-1 text-sm sm:mt-0 sm:col-span-2",children:i&&m?e.jsxs(e.Fragment,{children:[v==="select"?e.jsx("select",{name:r,value:d[r]||"",onChange:y,disabled:h,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${g[r]?"border-red-500":"border-gray-300"}`,children:Z.map(V=>e.jsx("option",{value:V.value,children:V.label},V.value))}):v==="textarea"?e.jsx("textarea",{name:r,value:d[r]||"",onChange:y,disabled:h,rows:ee,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${g[r]?"border-red-500":"border-gray-300"}`}):v==="checkbox"?e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{type:"checkbox",name:r,checked:d[r]||!1,onChange:y,disabled:h,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("span",{className:"ml-2 text-sm text-gray-900",children:d[r]?"Có":"Không"})]}):e.jsx("input",{type:v,name:r,value:d[r]||"",onChange:y,disabled:h,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${g[r]?"border-red-500":"border-gray-300"}`}),g[r]&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:g[r]})]}):e.jsx("span",{className:s?"font-semibold text-red-700":"text-gray-900",children:l!=null&&l!==""?l:e.jsx("span",{className:"italic text-gray-400",children:"Chưa có thông tin"})})})]});if(Y)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(M,{size:"12"})});if(!a)return e.jsx("div",{className:"text-center py-10",children:"Không tìm thấy người dùng."});const j=a.bloodTypeDescription||"Chưa cập nhật";return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs(N,{to:"/admin/users",className:"flex items-center text-red-600 hover:text-red-800 mb-4",children:[e.jsx(le,{size:20,className:"mr-2"}),"Quay lại danh sách"]}),e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-5 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[i?"Chỉnh sửa: ":"",a.fullName]}),e.jsxs("p",{className:"text-sm text-gray-500",children:["ID: ",a.id," - ",e.jsx("span",{className:"font-semibold",children:a.username||a.email})]})]}),e.jsxs("div",{className:"flex space-x-2",children:[q&&e.jsx(N,{to:`/admin/users/${b}/edit`,children:e.jsxs(D,{variant:"outline",children:[e.jsx(ie,{size:16,className:"mr-2"})," Chỉnh sửa"]})}),i&&e.jsx(N,{to:`/admin/users/${b}`,children:e.jsxs(D,{variant:"secondary",children:[e.jsx(te,{size:16,className:"mr-2"})," Xem chi tiết"]})})]})]})}),"        ",i?e.jsxs("form",{onSubmit:W,className:"px-6 py-5",children:[e.jsxs("dl",{className:"divide-y divide-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 my-3",children:"Thông tin liên hệ"}),e.jsx(t,{icon:O,label:"Email",value:a.email}),e.jsx(t,{icon:R,label:"Số điện thoại",value:a.phone,isEditable:i,fieldName:"phone",fieldType:"tel"}),e.jsx(t,{icon:F,label:"Địa chỉ",value:a.address,isEditable:i,fieldName:"address",fieldType:"textarea",rows:3}),e.jsx(t,{icon:p,label:"Liên hệ khẩn cấp",value:a.emergencyContact,isEditable:i,fieldName:"emergencyContact"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 pt-5 my-3",children:"Thông tin cá nhân & Y tế"}),e.jsx(t,{icon:p,label:"Họ và tên đầy đủ",value:a.fullName,isEditable:i,fieldName:"fullName",highlight:!0}),e.jsx(t,{icon:T,label:"Ngày sinh",value:a.dateOfBirth?new Date(a.dateOfBirth).toLocaleDateString():null,isEditable:i,fieldName:"dateOfBirth",fieldType:"date"}),e.jsx(t,{icon:p,label:"Giới tính",value:a.gender==="Male"?"Nam":a.gender==="Female"?"Nữ":a.gender==="Other"?"Khác":a.gender,isEditable:i,fieldName:"gender",fieldType:"select",options:[{value:"",label:"-- Chọn giới tính --"},{value:"Male",label:"Nam"},{value:"Female",label:"Nữ"},{value:"Other",label:"Khác"}]}),e.jsx(t,{icon:U,label:"Nhóm máu",value:j,highlight:j!=="Chưa cập nhật",isEditable:i,fieldName:"bloodTypeId",fieldType:"select",options:[{value:"",label:"-- Chọn nhóm máu --"},...Q.filter((n,o,l)=>o===l.findIndex(s=>s.bloodGroup===n.bloodGroup)).map(n=>({value:n.id,label:n.bloodGroup}))]}),e.jsx(t,{icon:H,label:"Tình trạng bệnh lý",value:a.medicalConditions,isEditable:i,fieldName:"medicalConditions",fieldType:"textarea",rows:3}),e.jsx(t,{icon:T,label:"Lần hiến máu cuối",value:a.lastDonationDate?new Date(a.lastDonationDate).toLocaleDateString():null,isEditable:i,fieldName:"lastDonationDate",fieldType:"date"}),e.jsx(t,{icon:a.isReadyToDonate?u:x,label:"Sẵn sàng hiến máu",value:a.isReadyToDonate?"Có":"Không",highlight:a.isReadyToDonate===!0,isEditable:i,fieldName:"isReadyToDonate",fieldType:"checkbox"}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 pt-5 my-3",children:"Thông tin tài khoản"}),e.jsx(t,{icon:P,label:"Vai trò",value:a.role,highlight:!0,isEditable:i,fieldName:"roleName",fieldType:"select",options:G.map(n=>({value:n.name,label:`${n.name} (${n.description})`}))}),e.jsx(t,{icon:a.status==="ACTIVE"?u:a.status==="SUSPENDED"?x:z,label:"Trạng thái",value:a.status==="ACTIVE"?"Hoạt động":a.status==="SUSPENDED"?"Tạm khóa":a.status==="DEACTIVATED"?"Vô hiệu hóa":a.status,highlight:a.status==="ACTIVE",isEditable:i,fieldName:"status",fieldType:"select",options:[{value:"ACTIVE",label:"Active (Hoạt động)"},{value:"SUSPENDED",label:"Suspended (Tạm khóa)"},{value:"DEACTIVATED",label:"Deactivated (Vô hiệu hóa)"}]}),e.jsx(t,{icon:a.emailVerified?u:x,label:"Email đã xác thực",value:a.emailVerified?"Đã xác thực":"Chưa xác thực",isEditable:i,fieldName:"emailVerified",fieldType:"checkbox"}),e.jsx(t,{icon:a.phoneVerified?u:x,label:"SĐT đã xác thực",value:a.phoneVerified?"Đã xác thực":"Chưa xác thực",isEditable:i,fieldName:"phoneVerified",fieldType:"checkbox"}),e.jsx(t,{icon:C,label:"Ngày tạo",value:a.createdAt?new Date(a.createdAt).toLocaleString():null}),e.jsx(t,{icon:C,label:"Cập nhật lần cuối",value:a.updatedAt?new Date(a.updatedAt).toLocaleString():null})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-6 mt-6 border-t border-gray-200",children:[e.jsx(N,{to:"/admin/users",children:e.jsx(D,{type:"button",variant:"secondary",disabled:h,children:"Quay lại danh sách"})}),e.jsxs(D,{type:"submit",variant:"primary",disabled:h,children:[h?e.jsx(M,{size:"5",color:"white",className:"mr-2"}):e.jsx(ne,{size:18,className:"mr-2"}),h?"Đang lưu...":"Lưu thay đổi"]})]})]}):e.jsx("div",{className:"px-6 py-5",children:e.jsxs("dl",{className:"divide-y divide-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 my-3",children:"Thông tin liên hệ"}),e.jsx(t,{icon:O,label:"Email",value:a.email}),e.jsx(t,{icon:R,label:"Số điện thoại",value:a.phone}),e.jsx(t,{icon:F,label:"Địa chỉ",value:a.address}),e.jsx(t,{icon:p,label:"Liên hệ khẩn cấp",value:a.emergencyContact}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 pt-5 my-3",children:"Thông tin cá nhân & Y tế"}),e.jsx(t,{icon:p,label:"Họ và tên đầy đủ",value:a.fullName,highlight:!0}),e.jsx(t,{icon:T,label:"Ngày sinh",value:a.dateOfBirth?new Date(a.dateOfBirth).toLocaleDateString():null}),e.jsx(t,{icon:p,label:"Giới tính",value:a.gender==="Male"?"Nam":a.gender==="Female"?"Nữ":a.gender==="Other"?"Khác":a.gender}),e.jsx(t,{icon:U,label:"Nhóm máu",value:j,highlight:j!=="Chưa cập nhật"}),e.jsx(t,{icon:H,label:"Tình trạng bệnh lý",value:a.medicalConditions}),e.jsx(t,{icon:T,label:"Lần hiến máu cuối",value:a.lastDonationDate?new Date(a.lastDonationDate).toLocaleDateString():null}),e.jsx(t,{icon:a.isReadyToDonate?u:x,label:"Sẵn sàng hiến máu",value:a.isReadyToDonate?"Có":"Không",highlight:a.isReadyToDonate===!0}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 pt-5 my-3",children:"Thông tin tài khoản"}),e.jsx(t,{icon:P,label:"Vai trò",value:a.role,highlight:!0}),e.jsx(t,{icon:a.status==="ACTIVE"?u:a.status==="SUSPENDED"?x:z,label:"Trạng thái",value:a.status==="ACTIVE"?"Hoạt động":a.status==="SUSPENDED"?"Tạm khóa":a.status==="DEACTIVATED"?"Vô hiệu hóa":a.status,highlight:a.status==="ACTIVE"}),e.jsx(t,{icon:a.emailVerified?u:x,label:"Email đã xác thực",value:a.emailVerified?"Đã xác thực":"Chưa xác thực"}),e.jsx(t,{icon:a.phoneVerified?u:x,label:"SĐT đã xác thực",value:a.phoneVerified?"Đã xác thực":"Chưa xác thực"}),e.jsx(t,{icon:C,label:"Ngày tạo",value:a.createdAt?new Date(a.createdAt).toLocaleString():null}),e.jsx(t,{icon:C,label:"Cập nhật lần cuối",value:a.updatedAt?new Date(a.updatedAt).toLocaleString():null})]})})]})]})};export{ye as A};
