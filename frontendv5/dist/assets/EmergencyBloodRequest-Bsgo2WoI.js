import{r as h,u as b,j as e,q as v,B as p,n as E,V as d,T as w,D as R,U as C,l as k,R as T,d as B}from"./index---XYpbwv.js";import{b as N}from"./bloodRequestService-CVCsh7P-.js";import{S as U}from"./StatusBadge-BNqIDkY6.js";import{C as y}from"./clock-DJtAe62-.js";import"./Badge-oS4_q8it.js";import"./constants-DGt18w7B.js";const A=({request:s,onPledgeSuccess:a})=>{var g,u;const[r,i]=h.useState(!1),{user:n,isAuthenticated:l}=b(),t=(g=s.pledges)==null?void 0:g.some(o=>{var x;return((x=o.donor)==null?void 0:x.id)===(n==null?void 0:n.id)}),m=async()=>{var o;if(!l){d.error("Vui lòng đăng nhập để đăng ký hiến máu.");return}if(t){d.error("Bạn đã đăng ký hiến máu cho yêu cầu này rồi.");return}i(!0);try{await N.pledgeForRequest(s.id),d.success("Đăng ký hiến máu thành công! Cảm ơn bạn đã tham gia cứu người."),a==null||a()}catch(x){((o=x.response)==null?void 0:o.status)===409?d.error("Bạn đã đăng ký hiến máu cho yêu cầu này rồi."):d.error("Không thể đăng ký hiến máu. Vui lòng thử lại.")}finally{i(!1)}},c=((u=s.pledges)==null?void 0:u.length)||0,j=s.priority==="URGENT",f=s.priority==="EMERGENCY";return e.jsxs("div",{className:"space-y-3",children:[e.jsxs("div",{className:"flex items-center justify-between text-sm",children:[e.jsxs("div",{className:"flex items-center text-gray-600",children:[e.jsx(v,{className:"w-4 h-4 mr-1"}),e.jsxs("span",{children:[c," người đã đăng ký hiến"]})]}),s.quantityNeeded&&e.jsxs("div",{className:"text-gray-500",children:["Cần: ",s.quantityNeeded," đơn vị"]})]}),e.jsxs(p,{onClick:m,disabled:r||t||!l,variant:t?"outline":f?"danger":j?"warning":"primary",className:"w-full flex items-center justify-center",children:[e.jsx(E,{className:`w-4 h-4 mr-2 ${t?"fill-current":""}`}),r?"Đang xử lý...":t?"Đã đăng ký hiến máu":"Đăng ký hiến máu"]}),!l&&e.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Vui lòng đăng nhập để đăng ký hiến máu"}),t&&e.jsx("p",{className:"text-xs text-green-600 text-center",children:"✓ Cảm ơn bạn đã đăng ký hiến máu cho yêu cầu này"})]})},G=({request:s,onPledgeSuccess:a,showPledgeButton:r=!0})=>{const i=c=>new Date(c).toLocaleDateString("vi-VN",{year:"numeric",month:"long",day:"numeric",hour:"2-digit",minute:"2-digit"}),n=c=>{switch(c){case"EMERGENCY":return"bg-red-100 text-red-800 border-red-200";case"URGENT":return"bg-orange-100 text-orange-800 border-orange-200";case"NORMAL":return"bg-blue-100 text-blue-800 border-blue-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},l=c=>{switch(c){case"EMERGENCY":return"Khẩn cấp";case"URGENT":return"Gấp";case"NORMAL":return"Bình thường";default:return c}},t=s.priority==="EMERGENCY",m=s.priority==="URGENT";return e.jsx("div",{className:`bg-white rounded-lg shadow-md overflow-hidden border-l-4 ${t?"border-red-500":m?"border-orange-500":"border-blue-500"} hover:shadow-lg transition-shadow`,children:e.jsxs("div",{className:"p-6",children:[e.jsx("div",{className:"flex justify-between items-start mb-4",children:e.jsxs("div",{className:"flex-1",children:[e.jsxs("div",{className:"flex items-center gap-2 mb-2",children:[e.jsxs("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium border ${n(s.priority)}`,children:[(t||m)&&e.jsx(w,{className:"w-3 h-3 mr-1"}),l(s.priority)]}),e.jsx(U,{status:s.status})]}),e.jsxs("h3",{className:"text-lg font-semibold text-gray-900 mb-1",children:["Cần nhóm máu: ",s.bloodTypeRequired]}),s.description&&e.jsx("p",{className:"text-gray-600 text-sm mb-3",children:s.description})]})}),e.jsxs("div",{className:"space-y-3 mb-4",children:[s.quantityNeeded&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(R,{className:"w-4 h-4 mr-2 text-red-500"}),e.jsxs("span",{children:["Số lượng cần: ",e.jsxs("strong",{children:[s.quantityNeeded," đơn vị"]})]})]}),s.requesterName&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(C,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:["Người yêu cầu: ",s.requesterName]})]}),s.location&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:["Địa điểm: ",s.location]})]}),s.neededBy&&e.jsxs("div",{className:"flex items-center text-sm text-gray-600",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:["Thời hạn: ",i(s.neededBy)]})]}),s.createdAt&&e.jsxs("div",{className:"flex items-center text-sm text-gray-500",children:[e.jsx(y,{className:"w-4 h-4 mr-2"}),e.jsxs("span",{children:["Đăng lúc: ",i(s.createdAt)]})]})]}),(s.contactPhone||s.contactEmail)&&e.jsxs("div",{className:"bg-gray-50 rounded-lg p-3 mb-4",children:[e.jsx("h4",{className:"text-sm font-medium text-gray-900 mb-2",children:"Thông tin liên hệ:"}),e.jsxs("div",{className:"space-y-1",children:[s.contactPhone&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Điện thoại:"," ",e.jsx("a",{href:`tel:${s.contactPhone}`,className:"text-blue-600 hover:underline",children:s.contactPhone})]}),s.contactEmail&&e.jsxs("p",{className:"text-sm text-gray-600",children:["Email:"," ",e.jsx("a",{href:`mailto:${s.contactEmail}`,className:"text-blue-600 hover:underline",children:s.contactEmail})]})]})]}),r&&s.status==="ACTIVE"&&e.jsx(A,{request:s,onPledgeSuccess:a})]})})},D=()=>{const[s,a]=h.useState([]),[r,i]=h.useState(!0),n=async()=>{i(!0);try{const t=await N.searchActiveRequests();a(t.data||[])}catch{d.error("Không thể tải danh sách yêu cầu máu."),a([])}finally{i(!1)}};h.useEffect(()=>{n()},[]);const l=()=>{n()};return e.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsxs("div",{className:"text-center mb-8",children:[e.jsx("h1",{className:"text-4xl font-bold text-gray-900",children:"Các Trường Hợp Cần Máu Khẩn Cấp"}),e.jsx("p",{className:"mt-4 text-lg text-gray-600",children:"Mỗi giọt máu cho đi, một cuộc đời ở lại. Hãy cùng chung tay giúp đỡ những bệnh nhân đang cần máu."}),e.jsx("div",{className:"mt-6",children:e.jsxs(p,{onClick:n,disabled:r,variant:"outline",className:"inline-flex items-center",children:[e.jsx(T,{className:`w-4 h-4 mr-2 ${r?"animate-spin":""}`}),"Làm mới"]})})]}),r?e.jsx("div",{className:"flex justify-center items-center py-12",children:e.jsx(B,{size:"12"})}):e.jsx("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:s.length>0?s.map(t=>e.jsx(G,{request:t,onPledgeSuccess:l},t.id)):e.jsxs("div",{className:"col-span-full text-center py-12",children:[e.jsx("p",{className:"text-gray-500 text-lg",children:"Hiện tại không có yêu cầu khẩn cấp nào."}),e.jsx("p",{className:"text-gray-400 text-sm mt-2",children:"Hãy quay lại sau để kiểm tra các yêu cầu mới."})]})})]})};export{D as default};
