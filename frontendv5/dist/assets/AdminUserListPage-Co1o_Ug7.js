import{g as A,a as w,r,h as z,j as e,L as k,B as y,c as M,X as U,u as I,V,R as $,d as R}from"./index---XYpbwv.js";import{u as E}from"./userService-BVSG9cXN.js";import{a as f,U as b}from"./constants-DGt18w7B.js";import{C as _}from"./circle-check-big-BhElR3sU.js";import{C as B}from"./circle-x-DZIV9wQ5.js";import{P as H}from"./pen-line-CKq3-XG4.js";import{T as X}from"./trash-2-2oCXCowO.js";import{P as F}from"./Pagination-Dpv6LZGB.js";import{C as q}from"./circle-plus-BMNAtK6a.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const G=[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]],C=A("arrow-down-up",G);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O=[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]],Q=A("search",O);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}],["path",{d:"M12 17h.01",key:"p32p05"}]],J=A("shield-question",W),K=(s="default")=>{const{setLoading:n,showNotification:i}=w(),u=r.useCallback(async(a,{successMessage:h,errorMessage:l,showSuccess:t=!1,showError:m=!0,onSuccess:p,onError:j,onFinally:N}={})=>{try{n(s,!0);const g=await a();return h&&t&&i(h,"success"),p&&p(g),g}catch(g){throw m&&z(g,i),j&&j(g),g}finally{n(s,!1),N&&N()}},[n,i,s]),c=w(a=>a.loading[s]||!1),d=w(a=>a.loading),o=w(a=>Object.values(a.loading).some(h=>h));return{executeApi:u,isLoading:c,loadingStates:d,isAnyLoading:o,setLoading:a=>n(s,a)}},Y=s=>window.confirm(s),Z=({users:s,onRefresh:n,onSort:i,renderSortIcon:u})=>{const{executeApi:c,isLoading:d}=K("userManagement"),o=r.useCallback(async(t,m,p)=>{if(p===f.ADMIN){c(()=>Promise.reject(new Error("Không thể vô hiệu hóa tài khoản Admin.")),{showError:!0});return}Y(`Bạn có chắc chắn muốn vô hiệu hóa người dùng "${m}" (ID: ${t}) không? Hành động này sẽ chuyển trạng thái của họ thành "Suspended".`)&&await c(()=>E.softDeleteUserByAdmin(t),{successMessage:`Người dùng ${m} đã được vô hiệu hóa.`,showSuccess:!0,onSuccess:()=>{n&&n()}})},[c,n]),a=r.useCallback(t=>{switch(t){case f.ADMIN:return"bg-red-100 text-red-800";case f.STAFF:return"bg-yellow-100 text-yellow-800";case f.MEMBER:return"bg-green-100 text-green-800";case f.GUEST:return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},[]),h=r.useCallback(t=>{switch(t){case b.ACTIVE:return"bg-green-100 text-green-800";case b.SUSPENDED:return"bg-red-100 text-red-800";case b.PENDING:return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},[]),l=({field:t,children:m})=>e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer group",onClick:()=>i&&i(t),children:e.jsxs("div",{className:"flex items-center",children:[m,u&&u(t)]})});return!s||s.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Không có dữ liệu người dùng."}):e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx(l,{field:"id",children:"ID"}),e.jsx(l,{field:"fullName",children:"Họ tên"}),e.jsx(l,{field:"email",children:"Email"}),e.jsx(l,{field:"role",children:"Vai trò"}),e.jsx(l,{field:"status",children:"Trạng thái"}),e.jsx(l,{field:"emailVerified",children:"Email X.Thực"}),e.jsx(l,{field:"createdAt",children:"Ngày tạo"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hành động"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:t.fullName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:t.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx("span",{className:`px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${a(t.role)}`,children:t.role})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-center",children:e.jsx("span",{className:`px-2.5 py-0.5 inline-flex text-xs leading-5 font-semibold rounded-full ${h(t.status)}`,children:t.status})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-center",children:t.emailVerified?e.jsx(_,{size:18,className:"text-green-500 inline"}):e.jsx(B,{size:18,className:"text-red-500 inline"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:t.createdAt?new Date(t.createdAt).toLocaleDateString("vi-VN"):"N/A"}),e.jsxs("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-center space-x-1",children:[e.jsx(k,{to:`/admin/users/view/${t.id}`,title:"Xem chi tiết",children:e.jsx(y,{variant:"icon",className:"text-blue-600 hover:text-blue-800",children:e.jsx(M,{size:18})})}),e.jsx(k,{to:`/admin/users/edit/${t.id}`,title:"Chỉnh sửa",children:e.jsx(y,{variant:"icon",className:"text-indigo-600 hover:text-indigo-800",children:e.jsx(H,{size:18})})}),t.role!==f.ADMIN&&t.status===b.ACTIVE&&e.jsx(y,{onClick:()=>o(t.id,t.fullName,t.role),variant:"icon",className:"text-red-600 hover:text-red-800",title:"Vô hiệu hóa",disabled:d,children:e.jsx(X,{size:18})}),t.role===f.ADMIN&&e.jsx(y,{variant:"icon",className:"text-gray-400 cursor-not-allowed",title:"Không thể vô hiệu hóa Admin",disabled:!0,children:e.jsx(J,{size:18})})]})]},t.id))})]})})},ee=({onSearch:s,debounceDelay:n=500,placeholder:i="Tìm kiếm...",className:u=""})=>{const[c,d]=r.useState(""),o=r.useRef(null);r.useEffect(()=>(o.current&&clearTimeout(o.current),o.current=setTimeout(()=>{s(c)},n),()=>{o.current&&clearTimeout(o.current)}),[c,n,s]);const a=l=>{d(l.target.value)},h=()=>{d(""),s("")};return e.jsxs("div",{className:`relative w-full max-w-sm ${u}`,children:[e.jsx("div",{className:"absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none",children:e.jsx(Q,{className:"h-5 w-5 text-gray-400"})}),e.jsx("input",{type:"text",value:c,onChange:a,placeholder:i,className:"block w-full pl-10 pr-10 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm"}),c&&e.jsx("div",{className:"absolute inset-y-0 right-0 pr-3 flex items-center",children:e.jsx("button",{onClick:h,className:"p-1 text-gray-400 hover:text-gray-600 focus:outline-none rounded-full hover:bg-gray-100","aria-label":"Clear search",children:e.jsx(U,{className:"h-4 w-4"})})})]})},de=()=>{const[s,n]=r.useState(null),[i,u]=r.useState(!1),[c,d]=r.useState(0),[o]=r.useState(10),[a,h]=r.useState(["id","asc"]),[l,t]=r.useState(""),{user:m}=I(),p=r.useCallback(async(x,v,L,D)=>{u(!0);try{const S=await E.getAllUsers(x,v,L,D);n(S)}catch(S){V.error(`Lỗi khi tải danh sách người dùng: ${S.message}`),n(null)}finally{u(!1)}},[]);r.useEffect(()=>{p(c,o,a,l)},[c,o,a,l,p]);const j=()=>{d(0),t(""),h(["id","asc"])},N=x=>{d(x)},g=x=>{t(x),d(0)},T=x=>{const v=a[0]===x&&a[1]==="asc"?"desc":"asc";h([x,v]),d(0)},P=x=>a[0]===x?a[1]==="asc"?e.jsx(C,{size:14,className:"ml-1 rotate-180"}):e.jsx(C,{size:14,className:"ml-1"}):e.jsx(C,{size:14,className:"ml-1 text-gray-300 group-hover:text-gray-400"});return e.jsxs("div",{className:"p-6",children:[e.jsxs("div",{className:"flex justify-between items-center mb-6 gap-4 flex-wrap",children:[e.jsx("h1",{className:"text-2xl font-bold text-gray-800",children:"Quản lý Người dùng"}),e.jsxs("div",{className:"flex items-center space-x-2",children:[e.jsx(y,{onClick:j,variant:"secondary",className:"p-2",title:"Làm mới",disabled:i,children:e.jsx($,{size:18,className:i?"animate-spin":""})}),(m==null?void 0:m.role)==="Admin"&&e.jsx(k,{to:"/admin/users/new",children:e.jsxs(y,{variant:"primary",disabled:i,children:[e.jsx(q,{size:20,className:"mr-2"})," Thêm người dùng"]})})]})]}),e.jsx("div",{className:"mb-4",children:e.jsx(ee,{onSearch:g,placeholder:"Tìm kiếm theo ID, họ tên hoặc email..."})}),i&&!s?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx(R,{size:"12"})}):s&&s.content?e.jsxs(e.Fragment,{children:[e.jsx(Z,{users:s.content,onRefresh:j,onSort:T,currentSortField:a[0],currentSortDirection:a[1],renderSortIcon:P}),s.totalPages>1&&e.jsxs("div",{className:"mt-6 flex flex-col sm:flex-row justify-between items-center gap-4",children:[e.jsxs("div",{className:"text-sm text-gray-700",children:["Trang"," ",e.jsx("span",{className:"font-medium",children:s.number+1})," /"," ",e.jsx("span",{className:"font-medium",children:s.totalPages})," (",s.totalElements," kết quả)"]}),e.jsx(F,{currentPage:c,totalPages:s.totalPages,onPageChange:N,isLoading:i})]})]}):e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Không có người dùng nào phù hợp."})]})};export{de as default};
