import{p as S,b as P,u as U,r as h,V as o,j as e,l as B,B as j}from"./index-CLUoxoAg.js";import{b as u}from"./blogPostService-DPIuS0Jv.js";import{I as x}from"./InputField-CdPCaxRY.js";import{A as k}from"./arrow-left-EWlVf4Oe.js";import{S as E}from"./save-Bf1JiKSE.js";const V=()=>{const{id:c}=S(),i=P(),{isAuthenticated:p}=U(),n=!!c,[t,b]=h.useState({title:"",content:"",imageUrl:"",tags:""}),[N,f]=h.useState(!1),[a,v]=h.useState(!1);h.useEffect(()=>{p||(o.error("Bạn cần đăng nhập để viết bài."),i("/login"))},[p,i]),h.useEffect(()=>{n&&c&&(async()=>{f(!0);try{const s=await u.getPostById(c);b({title:s.title||"",content:s.content||"",imageUrl:s.imageUrl||"",tags:s.tags?s.tags.join(", "):""})}catch{o.error("Không thể tải thông tin bài viết."),i("/blog")}finally{f(!1)}})()},[n,c,i]);const d=r=>{const{name:s,value:g}=r.target;b(l=>({...l,[s]:g}))},w=async r=>{var s,g;if(r.preventDefault(),!t.title.trim()||!t.content.trim()){o.error("Vui lòng nhập tiêu đề và nội dung bài viết.");return}v(!0);try{const l={title:t.title.trim(),content:t.content.trim(),imageUrl:t.imageUrl.trim()||null,tags:t.tags?t.tags.split(",").map(C=>C.trim()).filter(Boolean):[]};let m;n?(m=await u.updatePost(c,l),o.success("Cập nhật bài viết thành công!")):(m=await u.createPost(l),o.success("Tạo bài viết thành công!")),i(`/blog/${m.id}`)}catch(l){const m=((g=(s=l.response)==null?void 0:s.data)==null?void 0:g.message)||(n?"Không thể cập nhật bài viết.":"Không thể tạo bài viết.");o.error(m)}finally{v(!1)}},y=()=>{i(-1)};return N?e.jsx("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx(B,{size:"12"})})}):e.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[e.jsx("div",{className:"flex items-center justify-between mb-8",children:e.jsxs("div",{children:[e.jsxs("button",{onClick:y,className:"inline-flex items-center text-gray-600 hover:text-gray-900 mb-4",children:[e.jsx(k,{className:"w-4 h-4 mr-2"}),"Quay lại"]}),e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:n?"Chỉnh sửa bài viết":"Viết bài mới"})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow-lg",children:e.jsxs("form",{onSubmit:w,className:"p-8 space-y-6",children:[e.jsx(x,{label:"Tiêu đề bài viết",name:"title",value:t.title,onChange:d,placeholder:"Nhập tiêu đề hấp dẫn...",required:!0,disabled:a}),e.jsx(x,{label:"URL hình ảnh (tùy chọn)",name:"imageUrl",value:t.imageUrl,onChange:d,placeholder:"https://example.com/image.jpg",disabled:a}),t.imageUrl&&e.jsx("div",{className:"mt-2",children:e.jsx("img",{src:t.imageUrl,alt:"Preview",className:"w-full h-48 object-cover rounded-lg",onError:r=>{r.target.style.display="none"}})}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"content",className:"block text-sm font-medium text-gray-700 mb-2",children:"Nội dung bài viết *"}),e.jsx("textarea",{id:"content",name:"content",rows:15,value:t.content,onChange:d,placeholder:"Chia sẻ câu chuyện, kinh nghiệm hoặc kiến thức của bạn về hiến máu...",className:"w-full px-4 py-3 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500 resize-vertical",required:!0,disabled:a})]}),e.jsx(x,{label:"Thẻ tag (tùy chọn)",name:"tags",value:t.tags,onChange:d,placeholder:"hiến máu, sức khỏe, tình nguyện (phân cách bằng dấu phẩy)",disabled:a,helpText:"Phân cách các tag bằng dấu phẩy"}),e.jsxs("div",{className:"flex items-center justify-end space-x-4 pt-6 border-t border-gray-200",children:[e.jsx(j,{type:"button",variant:"outline",onClick:y,disabled:a,children:"Hủy"}),e.jsxs(j,{type:"submit",variant:"primary",disabled:a||!t.title.trim()||!t.content.trim(),isLoading:a,children:[e.jsx(E,{className:"w-4 h-4 mr-2"}),n?"Cập nhật":"Đăng bài"]})]})]})})]})};export{V as default};
