import{r as t,u as D,V as n,j as e,o as u,l as L,p as P,q as A,t as R,v as M,C as k,d as H}from"./index-1dtSQISR.js";import{S as T}from"./StatusBadge-D5kv7rFB.js";import{D as x}from"./DateTimeDisplay-BybaiEr8.js";import{E as q}from"./EmptyState-CqnLvH6d.js";import{a as g}from"./appointmentService-grpWjNFB.js";import{P as I}from"./Pagination-DEb_1VK8.js";import{M as B}from"./Modal-C4xFU6ku.js";import{C as G}from"./clock-BK2pyYK-.js";import"./Badge-DVxHSo1W.js";import"./constants-QRcisZg4.js";import"./circle-check-big-CJhYsvhV.js";import"./plus-C4tZkhei.js";import"./chevron-left-ByYWtYPx.js";import"./chevron-right-B4c0w1B6.js";const U=5,te=()=>{const[i,p]=t.useState([]),[j,o]=t.useState(!0),{isAuthenticated:d,user:V}=D(),[r,f]=t.useState(1),[y,N]=t.useState(1),[b,c]=t.useState(!1),[l,h]=t.useState(""),[C,v]=t.useState(null);t.useEffect(()=>{d&&m(r)},[d,r]);const m=async(s=1)=>{try{o(!0);const a=await g.getMyAppointments({page:s,size:U});p(a.content||a),N(a.totalPages||1)}catch(a){n.error("Không thể tải danh sách lịch hẹn"),console.error("Error fetching appointments:",a)}finally{o(!1)}},w=s=>{switch(s){case"SCHEDULED":return"bg-blue-100 text-blue-800";case"COMPLETED":return"bg-green-100 text-green-800";case"CANCELLED":return"bg-red-100 text-red-800";case"RESCHEDULED":return"bg-yellow-100 text-yellow-800";default:return"bg-gray-100 text-gray-800"}},E=s=>{v(s),h(""),c(!0)},S=async()=>{if(!l.trim()){n.error("Vui lòng nhập lý do đổi lịch");return}if(window.confirm("Bạn chắc chắn muốn yêu cầu đổi lịch này?"))try{await g.requestReschedule(C,{reason:l}),n.success("Yêu cầu đổi lịch đã được gửi!"),c(!1),m(r)}catch{n.error("Gửi yêu cầu đổi lịch thất bại")}};return j?e.jsx(u,{children:e.jsx(L,{message:"Đang tải lịch hẹn..."})}):e.jsx(u,{children:e.jsxs("div",{className:"container mx-auto px-4 py-8",children:[e.jsxs("div",{className:"mb-8",children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:"Lịch hẹn của tôi"}),e.jsx("p",{className:"text-gray-600",children:"Xem và quản lý các lịch hẹn hiến máu của bạn"})]}),i.length===0?e.jsx(q,{title:"Chưa có lịch hẹn nào",description:"Bạn chưa có lịch hẹn hiến máu nào. Hãy đăng ký hiến máu để tạo lịch hẹn.",action:{label:"Đăng ký hiến máu",href:"/request-donation"}}):e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"grid gap-6",children:i.map(s=>e.jsxs(P,{className:"hover:shadow-lg transition-shadow",children:[e.jsx(A,{children:e.jsxs("div",{className:"flex justify-between items-start",children:[e.jsxs(R,{className:"text-xl",children:["Lịch hẹn hiến máu #",s.id]}),e.jsx(T,{status:s.status,className:w(s.status)})]})}),e.jsxs(M,{className:"space-y-4",children:[e.jsxs("div",{className:"grid md:grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(k,{className:"w-5 h-5 text-blue-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Ngày giờ hẹn"}),e.jsx(x,{date:s.appointmentDateTime,format:"full"})]})]}),e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(H,{className:"w-5 h-5 text-green-500"}),e.jsxs("div",{children:[e.jsx("p",{className:"font-medium",children:"Địa điểm"}),e.jsx("p",{className:"text-gray-600",children:s.location})]})]})]}),s.notes&&e.jsxs("div",{className:"bg-gray-50 p-3 rounded-lg",children:[e.jsx("p",{className:"font-medium text-gray-700 mb-1",children:"Ghi chú:"}),e.jsx("p",{className:"text-gray-600",children:s.notes})]}),e.jsxs("div",{className:"flex items-center justify-between pt-4 border-t",children:[e.jsxs("div",{className:"flex items-center space-x-2 text-sm text-gray-500",children:[e.jsx(G,{className:"w-4 h-4"}),e.jsx("span",{children:"Tạo lúc: "}),e.jsx(x,{date:s.createdAt,format:"short"})]}),s.status==="SCHEDULED"&&e.jsx("button",{onClick:()=>E(s.id),className:"text-blue-600 hover:text-blue-800 font-medium",children:"Yêu cầu đổi lịch"})]})]})]},s.id))}),e.jsx("div",{className:"mt-8 flex justify-center",children:e.jsx(I,{currentPage:r-1,totalPages:y,onPageChange:s=>f(s+1)})}),e.jsx(B,{open:b,onClose:()=>c(!1),children:e.jsxs("div",{className:"p-4",children:[e.jsx("h2",{className:"text-lg font-bold mb-2",children:"Yêu cầu đổi lịch"}),e.jsx("textarea",{className:"w-full border rounded p-2 mb-4",rows:3,placeholder:"Nhập lý do đổi lịch...",value:l,onChange:s=>h(s.target.value)}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx("button",{className:"px-4 py-2 bg-gray-200 rounded",onClick:()=>c(!1),children:"Hủy"}),e.jsx("button",{className:"px-4 py-2 bg-blue-600 text-white rounded",onClick:S,children:"Xác nhận"})]})]})})]})]})})};export{te as default};
