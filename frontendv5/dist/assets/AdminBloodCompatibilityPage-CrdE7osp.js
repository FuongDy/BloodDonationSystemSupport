import{r as d,u as A,V as c,j as e,l as F,B as v,R as $}from"./index-1dtSQISR.js";import{b as k}from"./bloodCompatibilityService-D4xpLLa7.js";import{M as E}from"./Modal-C4xFU6ku.js";import{I as M}from"./InputField-1_bs09Nb.js";import{b as R}from"./bloodTypeService-CnW7m_57.js";import{C as z}from"./circle-check-big-CJhYsvhV.js";import{C as P}from"./circle-x-BJDfqqYQ.js";import{P as G}from"./pen-line-CmPajvV1.js";import{T as V}from"./trash-2-BbyR4m6B.js";import{A as O}from"./AdminPageLayout-DhKAkubx.js";import{A as X}from"./AdminContentWrapper-BZBpLfvq.js";import{C as H}from"./circle-plus-DEzM_GbY.js";import"./PageHeader-W4hk3_1v.js";import"./Pagination-DEb_1VK8.js";import"./chevron-left-ByYWtYPx.js";import"./chevron-right-B4c0w1B6.js";const Q=({isOpen:a,onClose:j,onSaveSuccess:m,rule:s})=>{const[n,i]=d.useState({donorBloodTypeId:"",recipientBloodTypeId:"",isCompatible:!0,notes:""}),[y,I]=d.useState([]),[h,w]=d.useState(!1),[C,r]=d.useState(!1),[l,T]=d.useState({}),{user:x}=A(),B=d.useCallback(async()=>{r(!0);try{const t=await R.getAll();I(t||[])}catch(t){c.error(`Lỗi khi tải dữ liệu: ${t.message}`)}finally{r(!1)}},[]);d.useEffect(()=>{a&&B()},[a,B]),d.useEffect(()=>{var t,o;i(s?{donorBloodTypeId:((t=s.donorBloodType)==null?void 0:t.id)||"",recipientBloodTypeId:((o=s.recipientBloodType)==null?void 0:o.id)||"",isCompatible:s.isCompatible,notes:s.notes||""}:{donorBloodTypeId:"",recipientBloodTypeId:"",isCompatible:!0,notes:""}),T({})},[s,a]);const f=t=>{const{name:o,value:g,type:u,checked:N}=t.target;i(p=>({...p,[o]:u==="checkbox"?N:g})),l[o]&&T(p=>({...p,[o]:null}))},L=()=>{const t={};return n.donorBloodTypeId||(t.donorBloodTypeId="Vui lòng chọn loại máu người cho."),n.recipientBloodTypeId||(t.recipientBloodTypeId="Vui lòng chọn loại máu người nhận."),T(t),Object.keys(t).length===0},S=async t=>{var u,N;if(t.preventDefault(),(x==null?void 0:x.role)!=="Admin"){c.error("Bạn không có quyền thực hiện thao tác này.");return}if(!L()){c.error("Vui lòng kiểm tra lại các trường thông tin.");return}w(!0);const o=c.loading(s?"Đang cập nhật...":"Đang tạo..."),g={donorBloodTypeId:parseInt(n.donorBloodTypeId),recipientBloodTypeId:parseInt(n.recipientBloodTypeId),isCompatible:n.isCompatible,notes:n.notes.trim()===""?null:n.notes.trim()};try{s!=null&&s.id?await k.update(s.id,g):await k.create(g),c.success(s?"Cập nhật thành công!":"Tạo thành công!",{id:o}),m&&typeof m=="function"&&m()}catch(p){console.error("Blood compatibility operation error:",p);const D=((N=(u=p==null?void 0:p.response)==null?void 0:u.data)==null?void 0:N.message)||(p==null?void 0:p.message)||"Đã có lỗi xảy ra";c.error(`Lỗi: ${D}`,{id:o})}finally{w(!1)}},b=(x==null?void 0:x.role)!=="Admin",q=e.jsxs(e.Fragment,{children:[e.jsx(v,{variant:"secondary",onClick:j,disabled:h||C,children:"Hủy"}),e.jsx(v,{variant:"primary",type:"submit",form:"bloodCompatibilityForm",disabled:h||C||b,isLoading:h,children:s?"Lưu thay đổi":"Tạo mới"})]});return e.jsx(E,{isOpen:a,onClose:j,title:s?"Chỉnh sửa quy tắc":"Thêm quy tắc tương thích",footerContent:q,size:"lg",children:C?e.jsx("div",{className:"flex justify-center items-center p-8",children:e.jsx(F,{})}):e.jsxs("form",{id:"bloodCompatibilityForm",onSubmit:S,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"donorBloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:["Loại máu người cho ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"donorBloodTypeId",id:"donorBloodTypeId",value:n.donorBloodTypeId,onChange:f,disabled:h||b,required:!0,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${l.donorBloodTypeId?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Chọn loại máu --"}),y.map(t=>e.jsx("option",{value:t.id,children:`${t.bloodGroup} (${t.componentType})`},t.id))]}),l.donorBloodTypeId&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:l.donorBloodTypeId})]}),e.jsxs("div",{children:[e.jsxs("label",{htmlFor:"recipientBloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:["Loại máu người nhận ",e.jsx("span",{className:"text-red-500",children:"*"})]}),e.jsxs("select",{name:"recipientBloodTypeId",id:"recipientBloodTypeId",value:n.recipientBloodTypeId,onChange:f,disabled:h||b,required:!0,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${l.recipientBloodTypeId?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Chọn loại máu --"}),y.map(t=>e.jsx("option",{value:t.id,children:`${t.bloodGroup} (${t.componentType})`},t.id))]}),l.recipientBloodTypeId&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:l.recipientBloodTypeId})]})]}),"          ",e.jsx("div",{className:"flex items-center space-x-8 pt-2",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"isCompatible",name:"isCompatible",type:"checkbox",checked:n.isCompatible,onChange:f,disabled:h||b,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"isCompatible",className:"ml-2 block text-sm text-gray-900",children:"Tương thích"})]})}),e.jsx(M,{label:"Ghi chú (Tùy chọn)",name:"notes",as:"textarea",rows:2,value:n.notes,onChange:f,disabled:h||b,error:l.notes})]})})},W=({rules:a,onEdit:j,onDelete:m,formatBloodTypeDisplay:s,user:n})=>e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsx("tr",{children:["ID","Loại máu cho","Loại máu nhận","Tương thích","Ghi chú","Hành động"].map(i=>e.jsx("th",{scope:"col",className:"px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:i},i))})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:a.map(i=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-gray-900",children:i.id}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-700",children:s(i.donorBloodType)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium text-gray-700",children:s(i.recipientBloodType)}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm text-center",children:i.isCompatible?e.jsx(z,{className:"text-green-500 mx-auto",size:20}):e.jsx(P,{className:"text-red-500 mx-auto",size:20})}),e.jsx("td",{className:"px-4 py-4 text-sm text-gray-500 max-w-xs truncate",children:i.notes||"-"}),e.jsx("td",{className:"px-4 py-4 whitespace-nowrap text-sm font-medium space-x-2",children:(n==null?void 0:n.role)==="Admin"&&e.jsxs(e.Fragment,{children:[e.jsxs(v,{onClick:()=>j(i),variant:"outline",size:"sm",children:[e.jsx(G,{size:16,className:"mr-1"}),"Sửa"]}),e.jsxs(v,{onClick:()=>m(i.id),variant:"danger",size:"sm",children:[e.jsx(V,{size:16,className:"mr-1"}),"Xóa"]})]})})]},i.id))})]})}),ce=()=>{var t;const[a,j]=d.useState(null),[m,s]=d.useState(!1),[n,i]=d.useState(0),[y]=d.useState(10),[I,h]=d.useState(!1),[w,C]=d.useState(null),{user:r}=A(),l=d.useCallback(async(o=n,g=y)=>{s(!0);try{const u=await k.getAll(o,g);j(u)}catch(u){c.error(`Lỗi khi tải dữ liệu: ${u.message}`)}finally{s(!1)}},[n,y]);d.useEffect(()=>{l()},[l]);const T=o=>{i(o)},x=()=>{l(n,y)},B=(o=null)=>{if((r==null?void 0:r.role)!=="Admin"&&o){c.error("Bạn không có quyền chỉnh sửa quy tắc tương thích.");return}if((r==null?void 0:r.role)!=="Admin"&&!o){c.error("Bạn không có quyền thêm quy tắc tương thích.");return}C(o),h(!0)},f=()=>{h(!1),C(null)},L=()=>{l(n,y),f()},S=async o=>{if((r==null?void 0:r.role)!=="Admin"){c.error("Bạn không có quyền xóa quy tắc tương thích.");return}if(window.confirm("Bạn có chắc chắn muốn xóa quy tắc này không?"))try{await k.delete(o),c.success("Xóa quy tắc thành công!"),l(n,y)}catch(g){c.error(`Lỗi khi xóa quy tắc: ${g.message}`)}},b=o=>o?`${o.bloodGroup} (${o.componentType})`:"N/A",q=[{label:"Làm mới",icon:$,variant:"secondary",onClick:x,disabled:m,className:m?"animate-spin":""},...(r==null?void 0:r.role)==="Admin"?[{label:"Thêm quy tắc",icon:H,variant:"primary",onClick:()=>B(),disabled:m}]:[]];return e.jsxs(O,{title:"Quản lý Tương thích máu",headerActions:q,children:[e.jsxs(X,{isLoading:m,hasData:((t=a==null?void 0:a.content)==null?void 0:t.length)>0,loadingMessage:"Đang tải quy tắc tương thích...",emptyMessage:"Chưa có quy tắc tương thích nào.",showPagination:!0,currentPage:n,totalPages:(a==null?void 0:a.totalPages)||0,totalElements:(a==null?void 0:a.totalElements)||0,onPageChange:T,paginationLoading:m,children:["        ",e.jsx(W,{rules:(a==null?void 0:a.content)||[],onEdit:B,onDelete:S,formatBloodTypeDisplay:b,user:r})]}),I&&e.jsx(Q,{isOpen:I,onClose:f,onSaveSuccess:L,rule:w})]})};export{ce as default};
