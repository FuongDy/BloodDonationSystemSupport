import{i as O,g as q,u as G,j as e,S as _,k as Y,N as K,b as Q,r as m,V as b,l as R,B as g,e as W,M as J,P as Z,d as ee,H as te,m as ae,n as x}from"./index-0uBgUJAH.js";import{C as f,a as k}from"./circle-user-CY9jjH_T.js";import{u as $}from"./userService-BNMUZcKQ.js";import{b as se}from"./bloodTypeService-DnR_6EM4.js";import{I as y}from"./InputField-Yb_kCCm4.js";import{D as F}from"./DatePicker-D2StFVid.js";import{M as ne}from"./Modal-DyBqspH3.js";import{P as le}from"./pen-line-Ca_-Skb_.js";import{C as T}from"./circle-check-big-DH52TbDi.js";import{C as ie}from"./circle-x-Ynt68wb8.js";import{C as oe}from"./clock-DvSylXuB.js";import{S as re}from"./save-MirIYU5C.js";import"./chevron-right-C8WomcHX.js";import"./chevron-left-xbWY0yrx.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],ce=O("bell",de);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],me=O("settings",he),xe=()=>{const p=q(),{user:c}=G(),l=[{path:"/profile",icon:f,label:"Thông tin cá nhân"},{path:"/profile/security",icon:_,label:"Bảo mật & Đăng nhập"},{path:"/profile/donation-schedule",icon:k,label:"Lịch hiến máu"},{path:"/profile/donation-history",icon:Y,label:"Lịch sử hiến máu"},{path:"/profile/notifications",icon:ce,label:"Thông báo"},{path:"/profile/settings",icon:me,label:"Cài đặt tài khoản"}],j=n=>n==="/profile"?p.pathname==="/profile":p.pathname.startsWith(n);return e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6 pb-4 border-b border-gray-200",children:[e.jsx(f,{size:40,className:"text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:(c==null?void 0:c.fullName)||"Người dùng"}),e.jsx("p",{className:"text-sm text-gray-600",children:(c==null?void 0:c.email)||""})]})]}),e.jsx("nav",{children:e.jsx("ul",{className:"space-y-2",children:l.map(n=>e.jsx("li",{children:e.jsxs(K,{to:n.path,end:n.path==="/profile",className:({isActive:v})=>`flex items-center space-x-3 py-2.5 px-3 rounded-lg transition duration-200 ${v?"bg-red-50 text-red-700 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"}`,children:[e.jsx(n.icon,{size:18,className:j(n.path)?"text-red-600":"text-gray-500"}),e.jsx("span",{children:n.label})]})},n.path))})})]})},z=({mode:p="view"})=>{const c=Q(),[l,j]=m.useState(null),[n,v]=m.useState({fullName:"",phone:"",dateOfBirth:"",gender:"",address:"",emergencyContact:"",bloodTypeId:"",medicalConditions:"",lastDonationDate:"",isReadyToDonate:!0}),[P,E]=m.useState([]),[H,I]=m.useState(!0),[i,L]=m.useState(!1),[o,C]=m.useState({}),[V,N]=m.useState(!1),u=p==="edit",B=p==="view",D=m.useCallback(async(s=!1)=>{var a;I(!0);try{const[t,d]=await Promise.all([$.getProfile(s),se.getAll()]);if(j(t),E(d||[]),u){const w={fullName:t.fullName||"",phone:t.phone||"",dateOfBirth:t.dateOfBirth||"",gender:t.gender||"",address:t.address||"",emergencyContact:t.emergencyContact||"",bloodTypeId:((a=t.bloodType)==null?void 0:a.id)||t.bloodTypeId||"",medicalConditions:t.medicalConditions||"",lastDonationDate:t.lastDonationDate||"",isReadyToDonate:t.isReadyToDonate!==null?t.isReadyToDonate:!0};v(w)}}catch(t){console.error(t),b.error(`Cập nhật thất bại: ${t.message}`),console.error("Profile update error:",t)}finally{I(!1)}},[u]);m.useEffect(()=>{D()},[D]);const h=m.useCallback(s=>{const{name:a,value:t,type:d,checked:w}=s.target;v(S=>({...S,[a]:d==="checkbox"?w:t})),o[a]&&C(S=>({...S,[a]:null}))},[o]),A=()=>{const s={};return n.fullName.trim()||(s.fullName="Họ tên không được để trống."),C(s),Object.keys(s).length===0},U=async s=>{if(s.preventDefault(),!A()){b.error("Vui lòng kiểm tra lại các trường thông tin.");return}N(!0)},X=async()=>{N(!1),L(!0);const s=b.loading("Đang cập nhật thông tin..."),a={...n,bloodTypeId:n.bloodTypeId?parseInt(n.bloodTypeId,10):null};a.phone===""&&(a.phone=null),a.gender===""&&(a.gender=null),a.address===""&&(a.address=null),a.emergencyContact===""&&(a.emergencyContact=null),a.medicalConditions===""&&(a.medicalConditions=null),a.dateOfBirth||(a.dateOfBirth=null),a.lastDonationDate||(a.lastDonationDate=null);try{const t=await $.updateProfile(a);b.success("Cập nhật thông tin thành công!",{id:s}),j(null),await D(!0),c("/profile")}catch(t){b.error(`Cập nhật thất bại: ${t.message||"Vui lòng thử lại."}`,{id:s}),t.response&&t.response.data&&typeof t.response.data=="object"&&C(d=>({...d,...t.response.data}))}finally{L(!1)}},r=({icon:s,label:a,value:t,highlight:d=!1})=>e.jsxs("div",{className:"py-3 sm:grid sm:grid-cols-3 sm:gap-4",children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[e.jsx(s,{size:16,className:"mr-2 text-red-600"}),a]}),e.jsx("dd",{className:`mt-1 text-sm ${d?"font-semibold text-red-700":"text-gray-900"} sm:mt-0 sm:col-span-2`,children:t!=null&&t!==""?t:e.jsx("span",{className:"italic text-gray-400",children:"Chưa có thông tin"})})]});if(H)return e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(R,{size:"12"})});if(!l)return e.jsx("div",{className:"text-center py-10",children:"Không thể tải thông tin người dùng."});const M=l.bloodTypeDescription||"Chưa cập nhật";return e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs("div",{className:"bg-white shadow-xl rounded-lg overflow-hidden",children:[e.jsx("div",{className:"bg-gray-50 px-6 py-5 border-b border-gray-200",children:e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsxs("div",{children:[e.jsxs("h1",{className:"text-2xl font-bold text-gray-800",children:[u?"Chỉnh sửa hồ sơ: ":"Hồ sơ cá nhân: ",l.fullName]}),e.jsx("p",{className:"text-sm text-gray-500",children:e.jsx("span",{className:"font-semibold",children:l.email})})]}),e.jsxs("div",{className:"flex space-x-2",children:[B&&e.jsxs(g,{onClick:()=>c("/profile/edit"),variant:"outline",children:[e.jsx(le,{size:16,className:"mr-2"})," Chỉnh sửa"]}),u&&e.jsxs(g,{onClick:()=>c("/profile"),variant:"secondary",children:[e.jsx(W,{size:16,className:"mr-2"})," Xem hồ sơ"]})]})]})}),B&&e.jsx("div",{className:"px-6 py-5",children:e.jsxs("dl",{className:"divide-y divide-gray-200",children:[e.jsx("h3",{className:"text-lg font-semibold text-gray-700 my-3",children:"Thông tin liên hệ"}),e.jsx(r,{icon:J,label:"Email",value:l.email}),e.jsx(r,{icon:Z,label:"Số điện thoại",value:l.phone}),e.jsx(r,{icon:ee,label:"Địa chỉ",value:l.address}),e.jsx(r,{icon:f,label:"Liên hệ khẩn cấp",value:l.emergencyContact}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 pt-5 my-3",children:"Thông tin cá nhân & Y tế"}),e.jsx(r,{icon:k,label:"Ngày sinh",value:l.dateOfBirth?new Date(l.dateOfBirth).toLocaleDateString():null}),e.jsx(r,{icon:f,label:"Giới tính",value:l.gender}),e.jsx(r,{icon:te,label:"Nhóm máu",value:M,highlight:M!=="Chưa cập nhật"}),e.jsx(r,{icon:f,label:"Tình trạng bệnh lý",value:l.medicalConditions}),e.jsx(r,{icon:k,label:"Lần hiến máu cuối",value:l.lastDonationDate?new Date(l.lastDonationDate).toLocaleDateString():null}),e.jsx(r,{icon:l.isReadyToDonate?T:ie,label:"Sẵn sàng hiến máu",value:l.isReadyToDonate?"Có":"Không",highlight:l.isReadyToDonate===!0}),e.jsx("h3",{className:"text-lg font-semibold text-gray-700 pt-5 my-3",children:"Thông tin tài khoản"}),e.jsx(r,{icon:T,label:"Email đã xác thực",value:l.emailVerified?"Đã xác thực":"Chưa xác thực"}),e.jsx(r,{icon:T,label:"SĐT đã xác thực",value:l.phoneVerified?"Đã xác thực":"Chưa xác thực"}),e.jsx(r,{icon:oe,label:"Ngày tạo tài khoản",value:l.createdAt?new Date(l.createdAt).toLocaleString():null})]})}),u&&e.jsxs("form",{onSubmit:U,className:"p-6 space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 border-b pb-2 mb-4",children:"Thông tin cá nhân"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(y,{label:"Họ và tên đầy đủ",id:"fullName",name:"fullName",value:n.fullName,onChange:h,required:!0,error:o.fullName,disabled:i}),e.jsx(y,{label:"Số điện thoại",id:"phone",name:"phone",type:"tel",value:n.phone,onChange:h,error:o.phone,disabled:i})]}),"            ",e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:["              ",e.jsx(F,{label:"Ngày sinh",name:"dateOfBirth",value:n.dateOfBirth,onChange:h,maxDate:(()=>{const s=new Date,a=String(s.getDate()).padStart(2,"0"),t=String(s.getMonth()+1).padStart(2,"0"),d=s.getFullYear();return`${a}-${t}-${d}`})(),placeholder:"Chọn ngày sinh",disabled:i}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 mb-1",children:"Giới tính"}),e.jsxs("select",{id:"gender",name:"gender",value:n.gender,onChange:h,disabled:i,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${o.gender?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Chọn giới tính --"}),e.jsx("option",{value:"Male",children:"Nam"}),e.jsx("option",{value:"Female",children:"Nữ"}),e.jsx("option",{value:"Other",children:"Khác"})]}),o.gender&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:o.gender})]})]}),e.jsx(y,{label:"Địa chỉ",id:"address",name:"address",type:"textarea",value:n.address,onChange:h,error:o.address,disabled:i,rows:3}),e.jsx(y,{label:"Liên hệ khẩn cấp",id:"emergencyContact",name:"emergencyContact",value:n.emergencyContact,onChange:h,error:o.emergencyContact,disabled:i}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 border-b pb-2 mb-4 pt-4",children:"Thông tin Y tế & Hiến máu"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nhóm máu"}),e.jsxs("select",{id:"bloodTypeId",name:"bloodTypeId",value:n.bloodTypeId,onChange:h,disabled:i||P.length===0,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${o.bloodTypeId?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Chọn nhóm máu --"}),P.filter((s,a,t)=>a===t.findIndex(d=>d.bloodGroup===s.bloodGroup)).map(s=>e.jsx("option",{value:s.id,children:s.bloodGroup},s.id))]}),o.bloodTypeId&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:o.bloodTypeId})]}),e.jsx(y,{label:"Tình trạng bệnh lý (nếu có)",id:"medicalConditions",name:"medicalConditions",type:"textarea",value:n.medicalConditions,onChange:h,error:o.medicalConditions,disabled:i,rows:3}),"            ",e.jsx(F,{label:"Ngày hiến máu gần nhất",name:"lastDonationDate",value:n.lastDonationDate,onChange:h,maxDate:(()=>{const s=new Date,a=String(s.getDate()).padStart(2,"0"),t=String(s.getMonth()+1).padStart(2,"0"),d=s.getFullYear();return`${a}-${t}-${d}`})(),placeholder:"Chọn ngày hiến máu gần nhất",disabled:i}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"isReadyToDonate",name:"isReadyToDonate",type:"checkbox",checked:n.isReadyToDonate,onChange:h,disabled:i,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"isReadyToDonate",className:"ml-2 block text-sm text-gray-900",children:"Sẵn sàng hiến máu"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(g,{type:"button",variant:"secondary",disabled:i,onClick:()=>c("/profile"),children:"Hủy bỏ"}),e.jsxs(g,{type:"submit",variant:"primary",disabled:i,children:[i?e.jsx(R,{size:"5",color:"white",className:"mr-2"}):e.jsx(re,{size:18,className:"mr-2"}),i?"Đang lưu...":"Lưu thay đổi"]})]})]})]}),e.jsx(ne,{isOpen:V,onClose:()=>N(!1),title:"Xác nhận lưu thay đổi",footerContent:e.jsxs(e.Fragment,{children:[e.jsx(g,{variant:"outline",onClick:()=>N(!1),children:"Hủy"}),e.jsx(g,{variant:"primary",onClick:X,loading:i,children:"Xác nhận"})]}),children:e.jsx("div",{children:"Bạn có chắc chắn muốn lưu thay đổi thông tin hồ sơ?"})})]})},ge=()=>e.jsx(z,{mode:"view"}),pe=()=>e.jsx(z,{mode:"edit"}),ue=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Bảo mật & Đăng nhập"}),e.jsx("p",{className:"text-gray-600",children:"Quản lý mật khẩu và cài đặt bảo mật tài khoản..."})]}),be=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Lịch hiến máu"}),e.jsx("p",{className:"text-gray-600",children:"Xem và quản lý lịch hẹn hiến máu của bạn..."})]}),ye=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Lịch sử hiến máu"}),e.jsx("p",{className:"text-gray-600",children:"Xem lịch sử các lần hiến máu đã thực hiện..."})]}),fe=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Cài đặt thông báo"}),e.jsx("p",{className:"text-gray-600",children:"Quản lý các thông báo và cảnh báo..."})]}),je=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{className:"text-2xl font-bold text-gray-800 mb-4",children:"Cài đặt tài khoản"}),e.jsx("p",{className:"text-gray-600",children:"Cài đặt tổng quát cho tài khoản..."})]}),$e=()=>e.jsx("div",{className:"bg-gray-50 min-h-screen",children:e.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-4 gap-8",children:[e.jsx("div",{className:"lg:col-span-1",children:e.jsx(xe,{})}),e.jsx("div",{className:"lg:col-span-3",children:e.jsxs(ae,{children:[e.jsx(x,{path:"/",element:e.jsx(ge,{})}),e.jsx(x,{path:"/edit",element:e.jsx(pe,{})}),e.jsx(x,{path:"/security",element:e.jsx(ue,{})}),e.jsx(x,{path:"/schedule",element:e.jsx(be,{})}),e.jsx(x,{path:"/history",element:e.jsx(ye,{})}),e.jsx(x,{path:"/notifications",element:e.jsx(fe,{})}),e.jsx(x,{path:"/settings",element:e.jsx(je,{})})]})})]})})});export{$e as default};
