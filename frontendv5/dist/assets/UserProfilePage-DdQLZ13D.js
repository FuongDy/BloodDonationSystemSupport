import{g as z,f as q,u as R,j as e,S as W,H as X,N as Y,r as d,V as N,d as A,T as G,B as p,L as P,i as J,k as y,I as u,M as Q,P as Z,U as ee,l as se,D as le,m as ne}from"./index---XYpbwv.js";import{u as O}from"./userService-BVSG9cXN.js";import{b as ae}from"./bloodTypeService-DVaU63AT.js";import{C as w,a as F}from"./circle-user-CqQw59HW.js";import{P as te}from"./pen-line-CKq3-XG4.js";import{S as ie}from"./save-Ktx4IY9M.js";import{C as re}from"./circle-check-big-BhElR3sU.js";import{C as oe}from"./circle-x-DZIV9wQ5.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M10.268 21a2 2 0 0 0 3.464 0",key:"vwvbt9"}],["path",{d:"M3.262 15.326A1 1 0 0 0 4 17h16a1 1 0 0 0 .74-1.673C19.41 13.956 18 12.499 18 8A6 6 0 0 0 6 8c0 4.499-1.411 5.956-2.738 7.326",key:"11g9vi"}]],ce=z("bell",de);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],xe=z("settings",he),v=()=>{const l=q(),{user:n}=R(),a=[{path:"/profile",icon:w,label:"Thông tin cá nhân"},{path:"/profile/security",icon:W,label:"Bảo mật & Đăng nhập"},{path:"/profile/donation-schedule",icon:F,label:"Lịch hiến máu"},{path:"/profile/donation-history",icon:X,label:"Lịch sử hiến máu"},{path:"/profile/notifications",icon:ce,label:"Thông báo"},{path:"/profile/settings",icon:xe,label:"Cài đặt tài khoản"}],h=t=>t==="/profile"?l.pathname==="/profile":l.pathname.startsWith(t);return e.jsxs("div",{className:"bg-white shadow-lg rounded-lg p-6",children:[e.jsxs("div",{className:"flex items-center space-x-3 mb-6 pb-4 border-b border-gray-200",children:[e.jsx(w,{size:40,className:"text-red-600"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-medium text-gray-800",children:(n==null?void 0:n.fullName)||"Người dùng"}),e.jsx("p",{className:"text-sm text-gray-600",children:(n==null?void 0:n.email)||""})]})]}),e.jsx("nav",{children:e.jsx("ul",{className:"space-y-2",children:a.map(t=>e.jsx("li",{children:e.jsxs(Y,{to:t.path,end:t.path==="/profile",className:({isActive:o})=>`flex items-center space-x-3 py-2.5 px-3 rounded-lg transition duration-200 ${o?"bg-red-50 text-red-700 font-medium":"text-gray-600 hover:bg-gray-100 hover:text-gray-900"}`,children:[e.jsx(t.icon,{size:18,className:h(t.path)?"text-red-600":"text-gray-500"}),e.jsx("span",{children:t.label})]})},t.path))})})]})},me=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{children:"Bảo mật & Đăng nhập"}),e.jsx("p",{children:"Nội dung trang bảo mật..."})]}),ge=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{children:"Lịch hiến máu"}),e.jsx("p",{children:"Nội dung trang lịch hiến máu..."})]}),ue=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{children:"Lịch sử hiến máu"}),e.jsx("p",{children:"Nội dung trang lịch sử hiến máu..."})]}),pe=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{children:"Cài đặt thông báo"}),e.jsx("p",{children:"Nội dung trang cài đặt thông báo..."})]}),je=()=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsx("h2",{children:"Cài đặt tài khoản"}),e.jsx("p",{children:"Nội dung trang cài đặt tài khoản..."})]}),fe=({profileData:l,formData:n,handleInputChange:a,handleSubmit:h,isEditing:t,setIsEditing:o,isSubmitting:r,errors:i,bloodTypes:j,fetchProfile:C})=>e.jsxs("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center mb-6",children:[e.jsxs("div",{className:"flex items-center mb-4 sm:mb-0",children:[e.jsx(w,{size:48,className:"text-red-600 mr-4"}),e.jsxs("div",{children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-gray-800",children:l.fullName}),e.jsx("p",{className:"text-gray-600",children:l.email})]})]}),!t&&e.jsxs(p,{onClick:()=>o(!0),variant:"outline",children:[e.jsx(te,{size:16,className:"mr-2"})," Chỉnh sửa hồ sơ"]})]}),t?e.jsxs("form",{onSubmit:h,className:"space-y-6",children:[e.jsx(u,{label:"Họ và tên đầy đủ",name:"fullName",value:n.fullName,onChange:a,required:!0,disabled:r,error:i.fullName}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(u,{label:"Số điện thoại",name:"phone",type:"tel",value:n.phone,onChange:a,disabled:r,error:i.phone}),e.jsx(u,{label:"Ngày sinh",name:"dateOfBirth",type:"date",value:n.dateOfBirth,onChange:a,disabled:r,error:i.dateOfBirth})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 mb-1",children:"Giới tính"}),e.jsxs("select",{name:"gender",value:n.gender,onChange:a,disabled:r,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${i.gender?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Chọn giới tính --"}),e.jsx("option",{value:"Male",children:"Nam"}),e.jsx("option",{value:"Female",children:"Nữ"}),e.jsx("option",{value:"Other",children:"Khác"})]}),i.gender&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.gender})]}),e.jsx(u,{label:"Địa chỉ",name:"address",type:"textarea",value:n.address,onChange:a,disabled:r,error:i.address,rows:2}),e.jsx(u,{label:"Liên hệ khẩn cấp",name:"emergencyContact",value:n.emergencyContact,onChange:a,disabled:r,error:i.emergencyContact}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nhóm máu"}),e.jsxs("select",{name:"bloodTypeId",value:n.bloodTypeId,onChange:a,disabled:r||j.length===0,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${i.bloodTypeId?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Chọn nhóm máu --"}),j.map(x=>e.jsxs("option",{value:x.id,children:[x.bloodGroup,x.rhFactor," (",x.description,")"]},x.id))]}),i.bloodTypeId&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:i.bloodTypeId})]}),e.jsx(u,{label:"Tình trạng bệnh lý (nếu có)",name:"medicalConditions",type:"textarea",value:n.medicalConditions,onChange:a,disabled:r,error:i.medicalConditions,rows:2}),e.jsx(u,{label:"Ngày hiến máu gần nhất",name:"lastDonationDate",type:"date",value:n.lastDonationDate,onChange:a,disabled:r,error:i.lastDonationDate}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{name:"isReadyToDonate",type:"checkbox",checked:n.isReadyToDonate,onChange:a,disabled:r,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"isReadyToDonate",className:"ml-2 block text-sm text-gray-900",children:"Tôi sẵn sàng hiến máu"})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(p,{type:"button",variant:"secondary",onClick:()=>{o(!1),C()},disabled:r,children:"Hủy"}),e.jsxs(p,{type:"submit",variant:"primary",isLoading:r,disabled:r,children:[e.jsx(ie,{size:16,className:"mr-2"})," Lưu thay đổi"]})]})]}):e.jsxs("div",{className:"space-y-4 mt-6",children:[e.jsx(c,{icon:Q,label:"Email",value:l.email}),e.jsx(c,{icon:Z,label:"Điện thoại",value:l.phone||"Chưa cập nhật"}),e.jsx(c,{icon:F,label:"Ngày sinh",value:l.dateOfBirth?new Date(l.dateOfBirth).toLocaleDateString("vi-VN"):"Chưa cập nhật"}),e.jsx(c,{icon:ee,label:"Giới tính",value:l.gender||"Chưa cập nhật"}),e.jsx(c,{icon:se,label:"Địa chỉ",value:l.address||"Chưa cập nhật"}),e.jsx(c,{icon:G,label:"Liên hệ khẩn cấp",value:l.emergencyContact||"Chưa cập nhật"}),e.jsx(c,{icon:le,label:"Nhóm máu",value:l.bloodTypeDescription||"Chưa cập nhật"}),e.jsx(c,{icon:ne,label:"Bệnh lý",value:l.medicalConditions||"Không có"}),e.jsx(c,{icon:F,label:"Hiến máu lần cuối",value:l.lastDonationDate?new Date(l.lastDonationDate).toLocaleDateString("vi-VN"):"Chưa có"}),e.jsx(c,{icon:l.isReadyToDonate?re:oe,label:"Sẵn sàng hiến máu",value:l.isReadyToDonate?"Có":"Không",valueColor:l.isReadyToDonate?"text-green-600":"text-red-600"})]})]}),Be=()=>{const{user:l,loading:n,isAuthenticated:a,logout:h}=R(),[t,o]=d.useState(null),[r,i]=d.useState(!1),[j,C]=d.useState({fullName:"",phone:"",dateOfBirth:"",gender:"",address:"",emergencyContact:"",bloodTypeId:"",medicalConditions:"",lastDonationDate:"",isReadyToDonate:!1}),[x,T]=d.useState({}),[V,L]=d.useState(!1),[K,f]=d.useState(!0),[k,m]=d.useState(null),[I,D]=d.useState([]),b=d.useCallback(async()=>{if(!l){m("Thông tin xác thực người dùng không hợp lệ để tải hồ sơ."),f(!1),o(null);return}f(!0),m(null);try{const s=await O.getCurrentUserProfile();s?(o(s),C({fullName:s.fullName||"",phone:s.phone||"",dateOfBirth:s.dateOfBirth?s.dateOfBirth.split("T")[0]:"",gender:s.gender||"",address:s.address||"",emergencyContact:s.emergencyContact||"",bloodTypeId:s.bloodTypeId||"",medicalConditions:s.medicalConditions||"",lastDonationDate:s.lastDonationDate?s.lastDonationDate.split("T")[0]:"",isReadyToDonate:s.isReadyToDonate||!1})):(o(null),m("Không tìm thấy dữ liệu hồ sơ người dùng.")),T({})}catch(s){console.error("Failed to fetch profile:",s),m(s.message||"Không thể tải thông tin hồ sơ. Vui lòng thử lại."),o(null),N.error(s.message||"Không thể tải thông tin hồ sơ.")}finally{f(!1)}},[l]),S=d.useCallback(async()=>{try{const s=await ae.getAll();D(s)}catch(s){console.error("Failed to fetch blood types:",s),N.error("Không thể tải danh sách nhóm máu."),D([{id:1,bloodGroup:"A",rhFactor:"+",description:"A dương"},{id:2,bloodGroup:"A",rhFactor:"-",description:"A âm"},{id:3,bloodGroup:"B",rhFactor:"+",description:"B dương"},{id:4,bloodGroup:"B",rhFactor:"-",description:"B âm"},{id:5,bloodGroup:"AB",rhFactor:"+",description:"AB dương"},{id:6,bloodGroup:"AB",rhFactor:"-",description:"AB âm"},{id:7,bloodGroup:"O",rhFactor:"+",description:"O dương"},{id:8,bloodGroup:"O",rhFactor:"-",description:"O âm"}])}},[]);d.useEffect(()=>{if(n){f(!0);return}a&&l?(b(),S()):a&&!l?(m("Đã xác thực nhưng thông tin người dùng không đầy đủ hoặc bị lỗi. Vui lòng thử đăng nhập lại."),f(!1),o(null)):(m("Vui lòng đăng nhập để xem hồ sơ của bạn."),f(!1),o(null))},[a,l,n,b,S]);const E=s=>{const{name:g,value:U,type:$,checked:_}=s.target;C(B=>({...B,[g]:$==="checkbox"?_:U})),x[g]&&T(B=>({...B,[g]:null}))},H=()=>{const s={};return j.fullName.trim()||(s.fullName="Họ và tên không được để trống."),T(s),Object.keys(s).length===0},M=async s=>{if(s.preventDefault(),!H()){N.error("Vui lòng kiểm tra lại thông tin đã nhập.");return}L(!0);try{await O.updateUserProfile(j),N.success("Cập nhật hồ sơ thành công!"),i(!1),b()}catch(g){console.error("Failed to update profile:",g),m(g.message||"Cập nhật hồ sơ thất bại."),N.error(g.message||"Cập nhật hồ sơ thất bại.")}finally{L(!1)}};return n?e.jsx("div",{className:"flex flex-col min-h-screen bg-gray-50",children:e.jsx("main",{className:"flex-grow container mx-auto px-4 py-8 flex justify-center items-center",children:e.jsx(A,{size:"lg"})})}):K?e.jsx("div",{className:"flex flex-col min-h-screen bg-gray-50",children:e.jsx("main",{className:"flex-grow container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"lg:w-80 flex-shrink-0 order-2 lg:order-1",children:e.jsx(v,{})}),e.jsx("div",{className:"flex-1 min-w-0 order-1 lg:order-2",children:e.jsx(A,{size:"lg"})})]})})}):k?e.jsx("div",{className:"flex flex-col min-h-screen bg-gray-50",children:e.jsx("main",{className:"flex-grow container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"lg:w-80 flex-shrink-0 order-2 lg:order-1",children:e.jsx(v,{})}),e.jsx("div",{className:"flex-1 min-w-0 order-1 lg:order-2",children:e.jsx("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8 flex flex-col justify-center items-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(G,{size:48,className:"text-red-500 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-red-700 mb-2",children:"Đã xảy ra lỗi"}),e.jsx("p",{className:"text-gray-600 mb-4",children:k}),a&&l&&!k.includes("thông tin người dùng không đầy đủ")&&e.jsx(p,{onClick:b,variant:"primary",children:"Thử lại"}),a&&!l&&e.jsx(P,{to:"/login",onClick:()=>{h&&h()},children:e.jsx(p,{variant:"primary",children:"Đăng nhập lại"})}),!a&&!k.includes("thông tin người dùng không đầy đủ")&&e.jsx(P,{to:"/login",children:e.jsx(p,{variant:"primary",children:"Đăng nhập"})})]})})})]})})}):!t&&!a?e.jsx("div",{className:"flex flex-col min-h-screen bg-gray-50",children:e.jsx("main",{className:"flex-grow container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"lg:w-80 flex-shrink-0 order-2 lg:order-1",children:e.jsx(v,{})}),e.jsx("div",{className:"flex-1 min-w-0 order-1 lg:order-2",children:e.jsx("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8 flex flex-col justify-center items-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{size:48,className:"text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Yêu cầu đăng nhập"}),e.jsx("p",{className:"text-gray-600 mb-4",children:"Bạn cần đăng nhập để xem thông tin hồ sơ."}),e.jsx(P,{to:"/login",children:e.jsx(p,{variant:"primary",children:"Đến trang đăng nhập"})})]})})})]})})}):!t&&a?e.jsx("div",{className:"flex flex-col min-h-screen bg-gray-50",children:e.jsx("main",{className:"flex-grow container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"lg:w-80 flex-shrink-0 order-2 lg:order-1",children:e.jsx(v,{})}),e.jsx("div",{className:"flex-1 min-w-0 order-1 lg:order-2",children:e.jsx("div",{className:"bg-white shadow-xl rounded-lg p-6 md:p-8 flex flex-col justify-center items-center min-h-96",children:e.jsxs("div",{className:"text-center",children:[e.jsx(w,{size:48,className:"text-gray-400 mx-auto mb-4"}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 mb-2",children:"Không có dữ liệu hồ sơ"}),e.jsx("p",{className:"text-gray-600",children:"Không tìm thấy thông tin hồ sơ cho tài khoản này."})]})})})]})})}):e.jsx("div",{className:"flex flex-col min-h-screen bg-gray-50",children:e.jsx("main",{className:"flex-grow container mx-auto px-4 py-8",children:e.jsxs("div",{className:"flex flex-col lg:flex-row gap-6 max-w-7xl mx-auto",children:[e.jsx("div",{className:"lg:w-80 flex-shrink-0 order-2 lg:order-1",children:e.jsx(v,{})}),e.jsx("div",{className:"flex-1 min-w-0 order-1 lg:order-2",children:e.jsxs(J,{children:[e.jsx(y,{index:!0,element:e.jsx(fe,{profileData:t,formData:j,handleInputChange:E,handleSubmit:M,isEditing:r,setIsEditing:i,isSubmitting:V,errors:x,bloodTypes:I,fetchProfile:b})}),e.jsx(y,{path:"security",element:e.jsx(me,{})}),e.jsx(y,{path:"donation-schedule",element:e.jsx(ge,{})}),e.jsx(y,{path:"donation-history",element:e.jsx(ue,{})}),e.jsx(y,{path:"notifications",element:e.jsx(pe,{})}),e.jsx(y,{path:"settings",element:e.jsx(je,{})})]})})]})})})},c=({icon:l,label:n,value:a,valueColor:h="text-gray-700"})=>e.jsxs("div",{className:"py-3 sm:grid sm:grid-cols-3 sm:gap-4 border-b border-gray-200 last:border-b-0",children:[e.jsxs("dt",{className:"text-sm font-medium text-gray-500 flex items-center",children:[e.jsx(l,{size:16,className:"mr-2 text-red-500"}),n]}),e.jsx("dd",{className:`mt-1 text-sm ${h} sm:mt-0 sm:col-span-2`,children:a})]});export{Be as default};
