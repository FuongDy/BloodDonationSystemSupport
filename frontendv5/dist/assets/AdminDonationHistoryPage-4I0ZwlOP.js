import{r as c,V as r,j as e,l as D,t as f,v as m,w as h,U as v,C as T,x as y,y as L,B as n}from"./index-CLUoxoAg.js";import{d as j}from"./donationService-D-AAkThF.js";import{B as S}from"./Badge-CK4vI7BX.js";import{P}from"./PageHeader-HTJD6SXh.js";import{C as A}from"./clock-DHp9DAYO.js";import"./arrow-left-EWlVf4Oe.js";const k=()=>{var u,N;const[E,p]=c.useState([]),[g,d]=c.useState(!0),[s,C]=c.useState(null);c.useEffect(()=>{o()},[]);const o=async()=>{try{d(!0);const t=await j.getAllDonationRequests();p(t.data)}catch{r.error("Lỗi khi tải đơn yêu cầu hiến máu")}finally{d(!1)}},x=t=>{const i={PENDING_APPROVAL:{variant:"warning",label:"Chờ duyệt"},REJECTED:{variant:"error",label:"Từ chối"},APPOINTMENT_PENDING:{variant:"info",label:"Chờ lịch hẹn"},APPOINTMENT_SCHEDULED:{variant:"info",label:"Đã lên lịch"},HEALTH_CHECK_PASSED:{variant:"success",label:"Khám đạt"},HEALTH_CHECK_FAILED:{variant:"error",label:"Khám không đạt"},BLOOD_COLLECTED:{variant:"success",label:"Đã lấy máu"},TESTING_PASSED:{variant:"success",label:"Xét nghiệm đạt"},TESTING_FAILED:{variant:"error",label:"Xét nghiệm không đạt"},COMPLETED:{variant:"success",label:"Hoàn thành"},CANCELLED:{variant:"error",label:"Đã hủy"}}[t]||{variant:"default",label:t};return e.jsx(S,{variant:i.variant,children:i.label})},a=async(t,l)=>{try{await j.updateDonationStatus(t,{newStatus:l}),r.success("Cập nhật trạng thái thành công"),o()}catch{r.error("Lỗi khi cập nhật trạng thái")}};return g?e.jsx("div",{className:"flex justify-center items-center min-h-screen",children:e.jsx(D,{size:"12"})}):e.jsxs(f,{children:[e.jsx(P,{title:"Quản lý đơn yêu cầu hiến máu",subtitle:"Theo dõi và quản lý tất cả các quy trình hiến máu"}),e.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[e.jsx("div",{className:"lg:col-span-2 space-y-4",children:E.map(t=>{var l,i;return e.jsx(m,{hover:!0,className:"cursor-pointer",onClick:()=>C(t),children:e.jsxs(h,{className:"p-6",children:[e.jsxs("div",{className:"flex items-center justify-between mb-4",children:[e.jsxs("div",{className:"flex items-center space-x-3",children:[e.jsx(v,{className:"h-5 w-5 text-gray-500"}),e.jsxs("div",{children:[e.jsx("h3",{className:"font-semibold",children:(l=t.donor)==null?void 0:l.fullName}),e.jsx("p",{className:"text-sm text-gray-500",children:(i=t.donor)==null?void 0:i.email})]})]}),x(t.status)]}),e.jsxs("div",{className:"flex items-center justify-between text-sm text-gray-500",children:[e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(T,{className:"h-4 w-4"}),e.jsx("span",{children:new Date(t.createdAt).toLocaleDateString("vi-VN")})]}),t.appointment&&e.jsxs("div",{className:"flex items-center space-x-1",children:[e.jsx(A,{className:"h-4 w-4"}),e.jsx("span",{children:new Date(t.appointment.appointmentDateTime).toLocaleDateString("vi-VN")})]})]}),t.note&&e.jsx("p",{className:"mt-2 text-sm text-gray-600",children:t.note})]})},t.id)})}),e.jsx("div",{className:"lg:col-span-1",children:s?e.jsxs(m,{children:[e.jsx(y,{children:e.jsx(L,{children:"Chi tiết hiến máu"})}),e.jsxs(h,{className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Người hiến máu"}),e.jsx("p",{className:"text-sm text-gray-600",children:(u=s.donor)==null?void 0:u.fullName}),e.jsx("p",{className:"text-sm text-gray-600",children:(N=s.donor)==null?void 0:N.email})]}),e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Trạng thái"}),x(s.status)]}),s.appointment&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Lịch hẹn"}),e.jsx("p",{className:"text-sm text-gray-600",children:new Date(s.appointment.appointmentDateTime).toLocaleString("vi-VN")}),e.jsx("p",{className:"text-sm text-gray-600",children:s.appointment.location})]}),s.note&&e.jsxs("div",{children:[e.jsx("h4",{className:"font-medium",children:"Ghi chú"}),e.jsx("p",{className:"text-sm text-gray-600",children:s.note})]}),e.jsxs("div",{className:"space-y-2",children:[e.jsx("h4",{className:"font-medium",children:"Cập nhật trạng thái"}),s.status==="PENDING_APPROVAL"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{size:"sm",className:"w-full",onClick:()=>a(s.id,"APPOINTMENT_PENDING"),children:"Duyệt đơn"}),e.jsx(n,{variant:"outline",size:"sm",className:"w-full",onClick:()=>a(s.id,"REJECTED"),children:"Từ chối"})]}),s.status==="APPOINTMENT_SCHEDULED"&&e.jsx(n,{size:"sm",className:"w-full",onClick:()=>a(s.id,"HEALTH_CHECK_PASSED"),children:"Khám sàng lọc đạt"}),s.status==="HEALTH_CHECK_PASSED"&&e.jsx(n,{size:"sm",className:"w-full",onClick:()=>a(s.id,"BLOOD_COLLECTED"),children:"Đã lấy máu"}),s.status==="BLOOD_COLLECTED"&&e.jsxs("div",{className:"space-y-2",children:[e.jsx(n,{size:"sm",className:"w-full",onClick:()=>a(s.id,"TESTING_PASSED"),children:"Xét nghiệm đạt"}),e.jsx(n,{variant:"outline",size:"sm",className:"w-full",onClick:()=>a(s.id,"TESTING_FAILED"),children:"Xét nghiệm không đạt"})]}),s.status==="TESTING_PASSED"&&e.jsx(n,{size:"sm",className:"w-full",onClick:()=>a(s.id,"COMPLETED"),children:"Hoàn thành"})]})]})]}):e.jsx(m,{children:e.jsx(h,{className:"p-6 text-center text-gray-500",children:"Chọn một quy trình hiến máu để xem chi tiết"})})})]})]})};export{k as default};
