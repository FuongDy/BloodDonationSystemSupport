import{p as O,b as R,r as o,V as m,j as e,d as T,L as k,I as c,B as I}from"./index---XYpbwv.js";import{u}from"./userService-BVSG9cXN.js";import{A}from"./arrow-left-CYlgApu7.js";import{S as E}from"./save-Ktx4IY9M.js";const G=()=>{const{userId:h}=O(),x=R(),[g,w]=o.useState(null),[r,y]=o.useState({fullName:"",phone:"",dateOfBirth:"",gender:"",address:"",emergencyContact:"",bloodTypeId:"",medicalConditions:"",lastDonationDate:"",isReadyToDonate:!0,roleName:"",status:"",emailVerified:!1,phoneVerified:!1}),[j,S]=o.useState([]),[N,V]=o.useState([]),[B,v]=o.useState(!0),[d,C]=o.useState(!1),[n,p]=o.useState({}),D=o.useCallback(async()=>{var a;v(!0);try{const[s,t,i]=await Promise.all([u.getUserByIdForAdmin(h),u.getRoles(),u.getBloodTypes()]);w(s),S(t||[]),V(i||[]),y({fullName:s.fullName||"",phone:s.phone||"",dateOfBirth:s.dateOfBirth||"",gender:s.gender||"",address:s.address||"",emergencyContact:s.emergencyContact||"",bloodTypeId:((a=s.bloodType)==null?void 0:a.id)||s.bloodTypeId||"",medicalConditions:s.medicalConditions||"",lastDonationDate:s.lastDonationDate||"",isReadyToDonate:s.isReadyToDonate!==null?s.isReadyToDonate:!0,roleName:s.role||"",status:s.status||"Active",emailVerified:s.emailVerified||!1,phoneVerified:s.phoneVerified||!1})}catch(s){m.error(`Lỗi khi tải dữ liệu người dùng: ${s.message}`),x("/admin/users")}finally{v(!1)}},[h,x]);o.useEffect(()=>{D()},[D]);const l=a=>{const{name:s,value:t,type:i,checked:b}=a.target;y(f=>({...f,[s]:i==="checkbox"?b:t})),n[s]&&p(f=>({...f,[s]:null}))},F=()=>{const a={};return r.fullName.trim()||(a.fullName="Họ tên không được để trống."),p(a),Object.keys(a).length===0},L=async a=>{if(a.preventDefault(),!F()){m.error("Vui lòng kiểm tra lại các trường thông tin.");return}C(!0);const s=m.loading("Đang cập nhật người dùng..."),t={...r,bloodTypeId:r.bloodTypeId?parseInt(r.bloodTypeId,10):null};t.phone===""&&(t.phone=null),t.gender===""&&(t.gender=null),t.address===""&&(t.address=null),t.emergencyContact===""&&(t.emergencyContact=null),t.medicalConditions===""&&(t.medicalConditions=null),t.dateOfBirth||(t.dateOfBirth=null),t.lastDonationDate||(t.lastDonationDate=null);try{await u.updateUserByAdmin(h,t),m.success("Cập nhật người dùng thành công!",{id:s}),x("/admin/users")}catch(i){m.error(`Lỗi khi cập nhật: ${i.message||"Vui lòng thử lại."}`,{id:s}),i.response&&i.response.data&&typeof i.response.data=="object"&&p(b=>({...b,...i.response.data}))}finally{C(!1)}};return B?e.jsx("div",{className:"flex justify-center items-center h-screen",children:e.jsx(T,{size:"12"})}):g?e.jsxs("div",{className:"p-6 max-w-4xl mx-auto",children:[e.jsxs(k,{to:"/admin/users",className:"flex items-center text-red-600 hover:text-red-800 mb-4",children:[e.jsx(A,{size:20,className:"mr-2"}),"Quay lại danh sách"]}),e.jsxs("h1",{className:"text-2xl font-bold text-gray-800 mb-2",children:["Chỉnh sửa Người dùng:"," ",e.jsx("span",{className:"text-red-600",children:g.username||g.email})]}),e.jsxs("p",{className:"text-sm text-gray-500 mb-6",children:["ID: ",h]}),e.jsxs("form",{onSubmit:L,className:"bg-white p-8 rounded-lg shadow-md space-y-6",children:[e.jsx("h2",{className:"text-xl font-semibold text-gray-700 border-b pb-2 mb-4",children:"Thông tin cá nhân"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Họ và tên đầy đủ",id:"fullName",name:"fullName",value:r.fullName,onChange:l,required:!0,error:n.fullName,disabled:d}),e.jsx(c,{label:"Số điện thoại",id:"phone",name:"phone",type:"tel",value:r.phone,onChange:l,error:n.phone,disabled:d})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsx(c,{label:"Ngày sinh",id:"dateOfBirth",name:"dateOfBirth",type:"date",value:r.dateOfBirth,onChange:l,error:n.dateOfBirth,disabled:d,InputLabelProps:{shrink:!0}}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"gender",className:"block text-sm font-medium text-gray-700 mb-1",children:"Giới tính"}),e.jsxs("select",{id:"gender",name:"gender",value:r.gender,onChange:l,disabled:d,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${n.gender?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Chọn giới tính --"}),e.jsx("option",{value:"Male",children:"Nam"}),e.jsx("option",{value:"Female",children:"Nữ"}),e.jsx("option",{value:"Other",children:"Khác"})]}),n.gender&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:n.gender})]})]}),e.jsx(c,{label:"Địa chỉ",id:"address",name:"address",type:"textarea",value:r.address,onChange:l,error:n.address,disabled:d,rows:3}),e.jsx(c,{label:"Liên hệ khẩn cấp",id:"emergencyContact",name:"emergencyContact",value:r.emergencyContact,onChange:l,error:n.emergencyContact,disabled:d}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 border-b pb-2 mb-4 pt-4",children:"Thông tin Y tế & Hiến máu"}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nhóm máu"}),e.jsxs("select",{id:"bloodTypeId",name:"bloodTypeId",value:r.bloodTypeId,onChange:l,disabled:d||N.length===0,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${n.bloodTypeId?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"",children:"-- Chọn nhóm máu --"}),N.filter((a,s,t)=>s===t.findIndex(i=>i.bloodGroup===a.bloodGroup)).map(a=>e.jsx("option",{value:a.id,children:a.bloodGroup},a.id))]}),n.bloodTypeId&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:n.bloodTypeId})]}),e.jsx(c,{label:"Tình trạng bệnh lý (nếu có)",id:"medicalConditions",name:"medicalConditions",type:"textarea",value:r.medicalConditions,onChange:l,error:n.medicalConditions,disabled:d,rows:3}),e.jsx(c,{label:"Ngày hiến máu gần nhất",id:"lastDonationDate",name:"lastDonationDate",type:"date",value:r.lastDonationDate,onChange:l,error:n.lastDonationDate,disabled:d,InputLabelProps:{shrink:!0}}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"isReadyToDonate",name:"isReadyToDonate",type:"checkbox",checked:r.isReadyToDonate,onChange:l,disabled:d,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"isReadyToDonate",className:"ml-2 block text-sm text-gray-900",children:"Sẵn sàng hiến máu"})]}),e.jsx("h2",{className:"text-xl font-semibold text-gray-700 border-b pb-2 mb-4 pt-4",children:"Thông tin Tài khoản"}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"roleName",className:"block text-sm font-medium text-gray-700 mb-1",children:"Vai trò"}),e.jsx("select",{id:"roleName",name:"roleName",value:r.roleName,onChange:l,disabled:d||j.length===0,required:!0,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${n.roleName?"border-red-500":"border-gray-300"}`,children:j.map(a=>e.jsxs("option",{value:a.name,children:[a.name," (",a.description,")"]},a.name))}),n.roleName&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:n.roleName})]}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"status",className:"block text-sm font-medium text-gray-700 mb-1",children:"Trạng thái"}),e.jsxs("select",{id:"status",name:"status",value:r.status,onChange:l,disabled:d,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${n.status?"border-red-500":"border-gray-300"}`,children:[e.jsx("option",{value:"Active",children:"Active"}),e.jsx("option",{value:"Suspended",children:"Suspended"}),e.jsx("option",{value:"Pending",children:"Pending"})]}),n.status&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:n.status})]})]}),e.jsxs("div",{className:"flex items-center space-x-8",children:[e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"emailVerified",name:"emailVerified",type:"checkbox",checked:r.emailVerified,onChange:l,disabled:d,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"emailVerified",className:"ml-2 block text-sm text-gray-900",children:"Email đã xác thực"})]}),e.jsxs("div",{className:"flex items-center",children:[e.jsx("input",{id:"phoneVerified",name:"phoneVerified",type:"checkbox",checked:r.phoneVerified,onChange:l,disabled:d,className:"h-4 w-4 text-red-600 focus:ring-red-500 border-gray-300 rounded"}),e.jsx("label",{htmlFor:"phoneVerified",className:"ml-2 block text-sm text-gray-900",children:"SĐT đã xác thực"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(k,{to:"/admin/users",children:e.jsx(I,{type:"button",variant:"secondary",disabled:d,children:"Hủy"})}),e.jsxs(I,{type:"submit",variant:"primary",disabled:d,children:[d?e.jsx(T,{size:"5",color:"white",className:"mr-2"}):e.jsx(E,{size:18,className:"mr-2"}),d?"Đang lưu...":"Lưu thay đổi"]})]})]})]}):e.jsx("div",{className:"text-center py-10",children:"Không tìm thấy người dùng."})};export{G as default};
