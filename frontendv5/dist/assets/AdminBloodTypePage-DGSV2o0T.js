import{r as a,u as M,j as e,B as T,V as h,l as F}from"./index-265Lkhjq.js";import{b as y}from"./bloodTypeService-BdQ8LDYK.js";import{M as O}from"./Modal-BkrSRTrd.js";import{I as G}from"./InputField-DaRo0h-I.js";import{C as A}from"./circle-plus-y9cgvwk6.js";import{P as I}from"./pen-line-CDYeDFnM.js";import{T as $}from"./trash-2-CdJf02lJ.js";const z=["Whole Blood","Plasma","Red Blood Cells","Platelets","White Blood Cells"],D=({isOpen:f,onClose:k,onSaveSuccess:S,bloodType:t})=>{const[r,g]=a.useState({bloodGroup:"",componentType:"Whole Blood",description:""}),[p,v]=a.useState(!1),[o,C]=a.useState({}),{user:l}=M();a.useEffect(()=>{g(t?{bloodGroup:t.bloodGroup||"",componentType:t.componentType||"Whole Blood",description:t.description||""}:{bloodGroup:"",componentType:"",description:""}),C({})},[t,f]);const i=n=>{const{name:u,value:m}=n.target;g(d=>({...d,[u]:m})),o[u]&&C(d=>({...d,[u]:null}))},N=()=>{const n={};return r.bloodGroup.trim()||(n.bloodGroup="Nhóm máu không được trống."),r.componentType||(n.componentType="Thành phần máu không được trống."),C(n),Object.keys(n).length===0},j=async n=>{if(n.preventDefault(),(l==null?void 0:l.role)!=="Admin"){h.error("Bạn không có quyền thực hiện thao tác này.");return}if(t!=null&&t.id?await y.update(t.id,m):await y.create(m),!N()){h.error("Vui lòng kiểm tra lại thông tin.");return}v(!0);const u=h.loading(t?"Đang cập nhật...":"Đang tạo..."),m={...r,description:r.description.trim()===""?null:r.description.trim()};try{if(t!=null&&t.id){const d={description:m.description};await y.update(t.id,d)}else await y.create(m);h.success(t?"Cập nhật thành công!":"Tạo thành công!",{id:u}),S()}catch(d){h.error(`Lỗi: ${d.message||"Đã có lỗi xảy ra."}`,{id:u})}finally{v(!1)}},c=(l==null?void 0:l.role)!=="Admin",b=!!t,B=e.jsxs(e.Fragment,{children:[e.jsx(T,{variant:"secondary",onClick:k,disabled:p,children:"Hủy"}),e.jsx(T,{variant:"primary",type:"submit",form:"bloodTypeForm",disabled:p||c,isLoading:p,children:t?"Lưu thay đổi":"Tạo mới"})]});return e.jsx(O,{isOpen:f,onClose:k,title:b?"Chỉnh sửa loại máu":"Thêm loại máu mới",footerContent:B,size:"lg",children:e.jsxs("form",{id:"bloodTypeForm",onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Nhóm máu (A+, O-, ..)",name:"bloodGroup",value:r.bloodGroup,onChange:i,required:!0,disabled:p||b||c,error:o.bloodGroup}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"componentType",className:"block text-sm font-medium text-gray-700 mb-1",children:"Thành phần máu"}),e.jsx("select",{id:"componentType",name:"componentType",value:r.componentType,onChange:i,disabled:p||b||c,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${o.componentType?"border-red-500":"border-gray-300"}`,children:z.map(n=>e.jsx("option",{value:n,children:n},n))}),o.componentType&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:o.componentType})]})]}),e.jsx(G,{label:"Mô tả (Tùy chọn)",name:"description",value:r.description,onChange:i,disabled:p||c,error:o.description})]})})},H=()=>{var d;const[f,k]=a.useState([]),[S,t]=a.useState(!1),[r,g]=a.useState(!1),[p,v]=a.useState(null),[o,C]=a.useState(""),{user:l}=M(),[i,N]=a.useState(null),j=a.useCallback(async s=>{t(!0);try{const x=await y.getAll(s);k(x||[])}catch(x){h.error(`Lỗi khi tải danh sách: ${x.message}`)}finally{t(!1)}},[]);a.useEffect(()=>{j(o)},[o,j]);const c=a.useMemo(()=>f?f.reduce((s,x)=>{const w=x.bloodGroup;return s[w]||(s[w]=[]),s[w].push(x),s},{}):{},[f]);a.useEffect(()=>{const s=Object.keys(c).sort();s.length>0?s.includes(i)||N(s[0]):N(null)},[c,i]);const b=(s=null)=>{v(s),g(!0)},B=()=>{g(!1),v(null)},n=()=>{j(o),B()},u=async(s,x)=>{const w=x||`ID: ${s}`;if(window.confirm(`Bạn có chắc chắn muốn xóa loại máu "${w}" không?`)){const L=h.loading("Đang xóa...");try{await y.delete(s),h.success("Xóa thành công!",{id:L}),j(o)}catch(E){h.error(`Lỗi khi xóa: ${E.message}`,{id:L})}}},m=(d=l==null?void 0:l.roles)==null?void 0:d.includes("ROLE_ADMIN");return e.jsxs("div",{className:"p-4 md:p-6 lg:p-8 bg-slate-50 min-h-screen",children:[e.jsxs("div",{className:"max-w-7xl mx-auto",children:[e.jsx("header",{className:"bg-white shadow-sm rounded-lg p-4 md:p-6 mb-6",children:e.jsxs("div",{className:"flex flex-col md:flex-row justify-between items-center",children:[e.jsx("h1",{className:"text-2xl md:text-3xl font-bold text-slate-800 mb-4 md:mb-0",children:"Quản lý Loại máu"}),e.jsx("div",{className:"flex items-center space-x-2 w-full md:w-auto",children:m&&e.jsxs(T,{onClick:()=>b(),variant:"primary",disabled:S,className:"flex-shrink-0",children:[e.jsx(A,{size:20,className:"mr-2"})," Thêm mới"]})})]})}),e.jsx("main",{children:S?e.jsx("div",{className:"flex justify-center items-center py-10",children:e.jsx(F,{size:"12"})}):e.jsxs("div",{className:"bg-white shadow-lg rounded-xl overflow-hidden border border-slate-200",children:[e.jsx("div",{className:"border-b border-slate-200",children:e.jsx("nav",{className:"-mb-px flex space-x-56 overflow-x-auto px-4","aria-label":"Tabs",children:Object.keys(c).sort().map(s=>e.jsx("button",{onClick:()=>N(s),className:`whitespace-nowrap py-4 px-3 border-b-2 font-semibold text-sm transition-colors
                                                ${i===s?"border-red-600 text-red-700":"border-transparent text-slate-500 hover:text-slate-700 hover:border-slate-300"}`,children:s},s))})}),e.jsx("div",{className:"p-2 md:p-4",children:i&&c[i]?e.jsx("div",{className:"divide-y divide-slate-100",children:c[i].map(s=>e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between p-3 gap-4 hover:bg-slate-50/50 rounded-lg",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"text-base font-semibold text-slate-900",children:s.componentType}),e.jsx("p",{className:"text-sm text-slate-600 italic mt-1",children:s.description||"Không có mô tả."})]}),e.jsx("div",{className:"flex items-center space-x-3 flex-shrink-0 self-end md:self-center",children:m?e.jsxs(e.Fragment,{children:[e.jsxs(T,{onClick:()=>b(s),variant:"outline",size:"sm",children:[e.jsx(I,{size:16,className:"mr-2"})," Sửa"]}),e.jsxs(T,{onClick:()=>u(s.id,`${s.bloodGroup} - ${s.componentType}`),variant:"danger-outline",size:"sm",children:[e.jsx($,{size:16,className:"mr-2"})," Xóa"]})]}):e.jsx("span",{className:"text-sm text-slate-500",children:"Không có quyền"})})]},s.id))}):e.jsxs("div",{className:"text-center p-12",children:[e.jsx("h3",{className:"text-lg font-semibold text-slate-700",children:"Không có dữ liệu"}),e.jsx("p",{className:"text-slate-500 mt-2",children:"Không có loại máu nào phù hợp với tìm kiếm của bạn."})]})})]})})]}),e.jsx(D,{isOpen:r,onClose:B,onSaveSuccess:n,bloodType:p})]})};export{H as default};
