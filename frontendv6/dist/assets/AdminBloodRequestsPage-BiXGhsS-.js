import{j as e,B as c,r,V as x,e as te}from"./index-1dtSQISR.js";import{b as C}from"./bloodRequestService-DoX1abWj.js";import{b as se}from"./bloodTypeService-CnW7m_57.js";import{b as U,R as P,S as ae}from"./constants-QRcisZg4.js";import{A as ne,S as re}from"./AdminPageLayout-DhKAkubx.js";import{A as le}from"./AdminContentWrapper-BZBpLfvq.js";import{D as oe}from"./DataTable-CTx3YzN_.js";import{M as ie}from"./Modal-C4xFU6ku.js";import{I as k}from"./InputField-1_bs09Nb.js";import{P as ce}from"./plus-C4tZkhei.js";import{S as de}from"./square-pen-7fhtdvvE.js";import"./PageHeader-W4hk3_1v.js";import"./Pagination-DEb_1VK8.js";import"./chevron-left-ByYWtYPx.js";import"./chevron-right-B4c0w1B6.js";import"./EmptyState-CqnLvH6d.js";import"./circle-check-big-CJhYsvhV.js";const ue=({formData:o,bloodTypes:d,onInputChange:i,onSubmit:y,onCancel:u,isLoading:n=!1})=>e.jsxs("form",{onSubmit:y,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(k,{label:"Tên bệnh nhân",name:"patientName",value:o.patientName,onChange:i,required:!0,disabled:n}),e.jsx(k,{label:"Bệnh viện",name:"hospital",value:o.hospital,onChange:i,required:!0,disabled:n})]}),e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{htmlFor:"bloodTypeId",className:"block text-sm font-medium text-gray-700 mb-1",children:"Nhóm máu"}),e.jsxs("select",{id:"bloodTypeId",name:"bloodTypeId",value:o.bloodTypeId,onChange:i,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm",required:!0,disabled:n,children:[e.jsx("option",{value:"",children:"-- Chọn nhóm máu --"}),d.filter((l,m,s)=>m===s.findIndex(h=>h.bloodGroup===l.bloodGroup)).map(l=>e.jsx("option",{value:l.id,children:l.bloodGroup},l.id))]})]}),e.jsx(k,{label:"Số lượng (đơn vị)",name:"quantityInUnits",type:"number",value:o.quantityInUnits,onChange:i,required:!0,disabled:n})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-1",children:"Mức độ khẩn cấp"}),"        ",e.jsxs("select",{name:"urgency",value:o.urgency,onChange:i,className:"block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500",disabled:n,children:[e.jsx("option",{value:"CRITICAL",children:"Cực kỳ khẩn cấp"}),e.jsx("option",{value:"URGENT",children:"Khẩn cấp"}),e.jsx("option",{value:"NORMAL",children:"Bình thường"})]})]}),e.jsxs("div",{className:"flex justify-end space-x-3 pt-4",children:[e.jsx(c,{type:"button",variant:"outline",onClick:u,disabled:n,children:"Hủy"}),e.jsx(c,{type:"submit",disabled:n,isLoading:n,children:"Tạo yêu cầu"})]})]}),Le=()=>{var I;const[o,d]=r.useState([]),[i,y]=r.useState(!0),[u,n]=r.useState(!1),[l,m]=r.useState("create"),[s,h]=r.useState(null),[R,w]=r.useState([]),[D,E]=r.useState(!1),[b,F]=r.useState(""),[j,G]=r.useState("ALL"),[f,M]=r.useState("ALL"),[N,q]=r.useState(0),[B,O]=r.useState(0),[V,z]=r.useState(0),H=10;r.useEffect(()=>{v(),K()},[N]);const v=async()=>{try{y(!0);const a=(await C.getAllRequests({page:N,size:H})).data;a.content?(d(a.content),O(a.totalPages),z(a.totalElements)):d(a||[])}catch(t){console.error("Error fetching blood requests:",t),x.error("Lỗi khi tải danh sách yêu cầu máu"),d([])}finally{y(!1)}},K=async()=>{try{const t=await se.getAll();w(t||[])}catch(t){console.error("Error fetching blood types:",t)}},_=()=>{m("create"),h(null),n(!0)},J=t=>{m("view"),h(t),n(!0)},Q=t=>{m("edit"),h(t),n(!0)},$=async(t,a)=>{try{await C.updateStatus(t,a),x.success("Cập nhật trạng thái thành công"),v()}catch(p){console.error("Error updating status:",p),x.error("Lỗi khi cập nhật trạng thái")}},W=async t=>{try{E(!0),l==="create"&&(await C.createRequest(t),x.success("Tạo yêu cầu máu thành công")),n(!1),v()}catch(a){console.error("Error submitting form:",a),x.error(l==="create"?"Lỗi khi tạo yêu cầu":"Lỗi khi cập nhật yêu cầu")}finally{E(!1)}},Y=t=>{const{name:a,value:p}=t.target;T(S=>({...S,[a]:p}))},X=t=>{t.preventDefault(),W({...g,quantityInUnits:parseInt(g.quantityInUnits),bloodTypeId:parseInt(g.bloodTypeId)})},[g,T]=r.useState({patientName:"",hospital:"",bloodTypeId:"",quantityInUnits:"",urgency:"URGENT"});r.useEffect(()=>{var t;u&&(l==="create"?T({patientName:"",hospital:"",bloodTypeId:"",quantityInUnits:"",urgency:"URGENT"}):s&&T({patientName:s.patientName||"",hospital:s.hospital||"",bloodTypeId:((t=s.bloodType)==null?void 0:t.id)||"",quantityInUnits:s.quantityInUnits||"",urgency:s.urgency||"URGENT"}))},[u,l,s]);const Z=o.filter(t=>{var L,A;const a=((L=t.patientName)==null?void 0:L.toLowerCase().includes(b.toLowerCase()))||((A=t.hospital)==null?void 0:A.toLowerCase().includes(b.toLowerCase())),p=j==="ALL"||t.status===j,S=f==="ALL"||t.urgency===f;return a&&p&&S}),ee=[{key:"id",title:"ID",sortable:!0},{key:"patientName",title:"Tên bệnh nhân",sortable:!0},{key:"hospital",title:"Bệnh viện",sortable:!0},{key:"bloodType",title:"Nhóm máu",render:t=>{var a;return((a=t.bloodType)==null?void 0:a.name)||"N/A"}},{key:"quantityInUnits",title:"Số lượng (đơn vị)",sortable:!0},{key:"urgency",title:"Mức độ khẩn cấp",render:t=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${t.urgency==="CRITICAL"?"bg-red-100 text-red-800":t.urgency==="URGENT"?"bg-orange-100 text-orange-800":"bg-yellow-100 text-yellow-800"}`,children:U[t.urgency]||t.urgency})},{key:"status",title:"Trạng thái",render:t=>e.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${ae[t.status]||"bg-gray-100 text-gray-800"}`,children:P[t.status]||t.status})},{key:"createdAt",title:"Ngày tạo",render:t=>t.createdAt?new Date(t.createdAt).toLocaleDateString("vi-VN"):"N/A",sortable:!0},{key:"actions",title:"Thao tác",render:t=>e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(c,{variant:"outline",size:"sm",onClick:()=>J(t),className:"p-1",children:e.jsx(te,{className:"h-4 w-4"})}),e.jsx(c,{variant:"outline",size:"sm",onClick:()=>Q(t),className:"p-1",children:e.jsx(de,{className:"h-4 w-4"})}),t.status==="PENDING"&&e.jsxs("select",{className:"text-xs border rounded px-1 py-1",value:t.status,onChange:a=>$(t.id,a.target.value),children:[e.jsx("option",{value:"PENDING",children:"Chờ xử lý"}),e.jsx("option",{value:"APPROVED",children:"Chấp thuận"}),e.jsx("option",{value:"REJECTED",children:"Từ chối"}),e.jsx("option",{value:"FULFILLED",children:"Hoàn thành"})]})]})}];return e.jsxs(ne,{children:["      ",e.jsxs(le,{title:"Quản lý yêu cầu máu",subtitle:"Tạo và quản lý yêu cầu máu khẩn cấp. Các yêu cầu PENDING sẽ hiển thị công khai cho người dùng đăng ký hiến máu.",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row justify-between items-start sm:items-center gap-4 mb-6",children:[e.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 flex-1",children:[e.jsxs("div",{className:"relative",children:[e.jsx(re,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),e.jsx("input",{type:"text",placeholder:"Tìm kiếm bệnh nhân, bệnh viện...",value:b,onChange:t=>F(t.target.value),className:"pl-10 pr-4 py-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500"})]}),e.jsxs("select",{value:j,onChange:t=>G(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"ALL",children:"Tất cả trạng thái"}),e.jsx("option",{value:"PENDING",children:"Chờ xử lý"}),e.jsx("option",{value:"APPROVED",children:"Chấp thuận"}),e.jsx("option",{value:"REJECTED",children:"Từ chối"}),e.jsx("option",{value:"FULFILLED",children:"Hoàn thành"})]}),e.jsxs("select",{value:f,onChange:t=>M(t.target.value),className:"px-3 py-2 border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"ALL",children:"Tất cả mức độ"}),e.jsx("option",{value:"CRITICAL",children:"Rất khẩn cấp"}),e.jsx("option",{value:"URGENT",children:"Khẩn cấp"}),e.jsx("option",{value:"NORMAL",children:"Bình thường"})]})]}),e.jsxs(c,{onClick:_,className:"bg-red-600 hover:bg-red-700",children:[e.jsx(ce,{className:"h-4 w-4 mr-2"}),"Tạo yêu cầu mới"]})]}),e.jsx(oe,{data:Z,columns:ee,isLoading:i,currentPage:N,totalPages:B,totalElements:V,onPageChange:q,emptyMessage:"Không có yêu cầu máu nào"}),"        ",e.jsx(ie,{isOpen:u,onClose:()=>n(!1),title:l==="create"?"Tạo yêu cầu máu mới":l==="edit"?"Chỉnh sửa yêu cầu máu":"Chi tiết yêu cầu máu",size:"lg",children:l==="view"?e.jsxs("div",{className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Tên bệnh nhân"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:s==null?void 0:s.patientName})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Bệnh viện"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:s==null?void 0:s.hospital})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Nhóm máu"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:(I=s==null?void 0:s.bloodType)==null?void 0:I.name})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Số lượng"}),e.jsxs("p",{className:"mt-1 text-sm text-gray-900",children:[s==null?void 0:s.quantityInUnits," đơn vị"]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Mức độ khẩn cấp"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:U[s==null?void 0:s.urgency]})]}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Trạng thái"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:P[s==null?void 0:s.status]})]}),e.jsxs("div",{className:"col-span-2",children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700",children:"Ngày tạo"}),e.jsx("p",{className:"mt-1 text-sm text-gray-900",children:s!=null&&s.createdAt?new Date(s.createdAt).toLocaleString("vi-VN"):"N/A"})]})]}),e.jsx("div",{className:"flex justify-end pt-4 border-t",children:e.jsx(c,{variant:"outline",onClick:()=>n(!1),children:"Đóng"})})]}):e.jsx(ue,{formData:g,bloodTypes:R,onInputChange:Y,onSubmit:X,onCancel:()=>n(!1),isLoading:D})})]})]})};export{Le as default};
