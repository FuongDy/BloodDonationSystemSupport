import{i as L,a as N,r as l,h as P,j as e,f as C,e as V,u as I,V as z,R}from"./index-0uBgUJAH.js";import{u as D}from"./userService-BNMUZcKQ.js";import{S as E}from"./StatusBadge-BlA2KO3p.js";import{D as _}from"./DateTimeDisplay-C7GFcxup.js";import{A as $}from"./ActionButtonGroup-I2VNa9sb.js";import{U as v,a as B}from"./constants-QRcisZg4.js";import{g as H,a as X}from"./formatters-VVyg-bDD.js";import{P as O}from"./pen-line-Ca_-Skb_.js";import{C as Q}from"./circle-check-big-DH52TbDi.js";import{C as W}from"./circle-x-Ynt68wb8.js";import{T as q}from"./trash-2-CeUyZ5JQ.js";import{A as G}from"./AdminPageLayout-DdqsJ0r9.js";import{A as J}from"./AdminContentWrapper-D75idiX7.js";import{C as K}from"./circle-plus-Dml-AeJc.js";import"./Badge-4CUZIaa-.js";import"./PageHeader-DZCCvaaU.js";import"./Pagination-CR7EbBZ1.js";import"./chevron-left-xbWY0yrx.js";import"./chevron-right-C8WomcHX.js";/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Y=[["path",{d:"m3 16 4 4 4-4",key:"1co6wj"}],["path",{d:"M7 20V4",key:"1yoxec"}],["path",{d:"m21 8-4-4-4 4",key:"1c9v7m"}],["path",{d:"M17 4v16",key:"7dpous"}]],b=L("arrow-down-up",Y);/**
 * @license lucide-react v0.511.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z=[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"M9.1 9a3 3 0 0 1 5.82 1c0 2-3 3-3 3",key:"mhlwft"}],["path",{d:"M12 17h.01",key:"p32p05"}]],F=L("shield-question",Z),ee=(s="default")=>{const{setLoading:c,showNotification:o}=N(),h=l.useCallback(async(a,{successMessage:t,errorMessage:n,showSuccess:x=!1,showError:g=!0,onSuccess:u,onError:f,onFinally:y}={})=>{var w,j;try{c(s,!0);const i=await a();return t&&x&&o(t,"success"),u&&typeof u=="function"&&u(i),i}catch(i){throw g&&((j=(w=i==null?void 0:i.response)==null?void 0:w.data)!=null&&j.message||i!=null&&i.message,P(i,o)),f&&typeof f=="function"&&f(i),i}finally{c(s,!1),y&&typeof y=="function"&&y()}},[c,o,s]),d=N(a=>a.loading[s]||!1),m=N(a=>a.loading),p=N(a=>Object.values(a.loading).some(t=>t));return{executeApi:h,isLoading:d,loadingStates:m,isAnyLoading:p,setLoading:a=>c(s,a)}},te=({users:s,onRefresh:c,onSort:o,renderSortIcon:h})=>{const{executeApi:d,isLoading:m}=ee("userManagement"),p=l.useCallback(async(t,n,x)=>{if(x===v.ADMIN){d(()=>Promise.reject(new Error("Không thể vô hiệu hóa tài khoản Admin.")),{showError:!0});return}window.confirm(`Bạn có chắc chắn muốn vô hiệu hóa người dùng "${n}" (ID: ${t}) không? Hành động này sẽ chuyển trạng thái của họ thành "Suspended".`)&&await d(()=>D.softDeleteUserByAdmin(t),{successMessage:`Người dùng ${n} đã được vô hiệu hóa.`,showSuccess:!0,onSuccess:()=>{c&&c()}})},[d,c]),a=({field:t,children:n})=>e.jsx("th",{scope:"col",className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider cursor-pointer group",onClick:()=>o&&o(t),children:e.jsxs("div",{className:"flex items-center",children:[n,h&&h(t)]})});return!s||s.length===0?e.jsx("p",{className:"text-center text-gray-500 py-8",children:"Không có dữ liệu người dùng."}):e.jsx("div",{className:"bg-white shadow-md rounded-lg overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx(a,{field:"id",children:"ID"}),e.jsx(a,{field:"fullName",children:"Họ tên"}),e.jsx(a,{field:"email",children:"Email"}),e.jsx(a,{field:"role",children:"Vai trò"}),e.jsx(a,{field:"status",children:"Trạng thái"}),e.jsx(a,{field:"emailVerified",children:"Email X.Thực"}),e.jsx(a,{field:"createdAt",children:"Ngày tạo"}),e.jsx("th",{scope:"col",className:"px-6 py-3 text-center text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Hành động            "})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:s.map(t=>{const n=[{label:"Xem chi tiết",icon:V,variant:"icon",className:"text-blue-600 hover:text-blue-800",component:C,to:`/admin/users/${t.id}`},{label:"Chỉnh sửa",icon:O,variant:"icon",className:"text-indigo-600 hover:text-indigo-800",component:C,to:`/admin/users/${t.id}/edit`}];return t.role!==v.ADMIN&&t.status===B.ACTIVE?n.push({label:"Vô hiệu hóa",icon:q,variant:"icon",className:"text-red-600 hover:text-red-800",onClick:()=>p(t.id,t.fullName,t.role),disabled:m}):t.role===v.ADMIN&&n.push({label:"Không thể vô hiệu hóa Admin",icon:F,variant:"icon",className:"text-gray-400 cursor-not-allowed",disabled:!0}),e.jsxs("tr",{className:"hover:bg-gray-50 transition-colors",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-900",children:t.id}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:t.fullName}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-700",children:t.email}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.jsx(E,{status:t.role,text:t.role,className:H(t.role)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-center",children:e.jsx(E,{status:t.status,text:t.status,className:X(t.status)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-center",children:t.emailVerified?e.jsx(Q,{size:18,className:"text-green-500 inline"}):e.jsx(W,{size:18,className:"text-red-500 inline"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsx(_,{date:t.createdAt})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium text-center",children:e.jsx($,{actions:n})})]},t.id)})})]})})},Ne=()=>{var k;const[s,c]=l.useState({content:[],totalPages:0,totalElements:0}),[o,h]=l.useState(!1),[d,m]=l.useState(0),[p]=l.useState(10),[a,t]=l.useState(["id","asc"]),[n,x]=l.useState(""),{user:g}=I(),u=l.useCallback(async(r,S,M,U)=>{h(!0);try{const A=await D.getAllUsers({page:r,size:S,sort:M,keyword:U});c(A)}catch(A){z.error(`Lỗi khi tải dữ liệu: ${A.message}`),c({content:[],totalPages:0,totalElements:0})}finally{h(!1)}},[]);l.useEffect(()=>{u(d,p,a,n)},[d,p,a,n,u]);const f=()=>{m(0),x(""),t(["id","asc"])},y=r=>{m(r)},w=r=>{x(r),m(0)},j=r=>{const S=a[0]===r&&a[1]==="asc"?"desc":"asc";t([r,S]),m(0)},i=r=>a[0]===r?a[1]==="asc"?e.jsx(b,{size:14,className:"ml-1 rotate-180"}):e.jsx(b,{size:14,className:"ml-1"}):e.jsx(b,{size:14,className:"ml-1 text-gray-300 group-hover:text-gray-400"}),T=[{label:"Làm mới",icon:R,variant:"secondary",onClick:f,disabled:o,className:o?"animate-spin":""},...(g==null?void 0:g.role)==="Admin"?[{label:"Thêm người dùng",icon:K,variant:"primary",component:C,to:"/admin/users/new",disabled:o}]:[]];return e.jsxs(G,{title:"Quản lý Người dùng",headerActions:T,showSearch:!0,onSearch:w,searchPlaceholder:"Tìm kiếm theo ID, họ tên hoặc email...",children:["      ",e.jsxs(J,{isLoading:o,hasData:((k=s==null?void 0:s.content)==null?void 0:k.length)>0,loadingMessage:"Đang tải danh sách người dùng...",emptyMessage:"Không có người dùng nào phù hợp.",showPagination:!0,currentPage:d,totalPages:(s==null?void 0:s.totalPages)||0,totalElements:(s==null?void 0:s.totalElements)||0,onPageChange:y,paginationLoading:o,children:["        ",e.jsx(te,{users:(s==null?void 0:s.content)||[],onRefresh:f,onSort:j,currentSortField:a[0],currentSortDirection:a[1],renderSortIcon:i})]})]})};export{Ne as default};
