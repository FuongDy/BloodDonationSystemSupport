import{r as c,V as i,j as e,l as E,B as o,T as C,U as k}from"./index-1dtSQISR.js";import{A as y,S as A}from"./AdminPageLayout-DhKAkubx.js";import{I as D}from"./InputField-1_bs09Nb.js";import{b as j}from"./bloodRequestService-DoX1abWj.js";import{P}from"./plus-C4tZkhei.js";import{C as S}from"./clock-BK2pyYK-.js";import"./PageHeader-W4hk3_1v.js";const B=()=>{const[N,m]=c.useState([]),[f,u]=c.useState(!0),[l,w]=c.useState(""),[h,v]=c.useState("all");c.useEffect(()=>{p()},[]);const p=async()=>{var t,a,r,n;try{u(!0);const s=await j.getEmergencyRequests();m(s.data||s||[])}catch(s){if(console.error(s),((t=s.response)==null?void 0:t.status)===401)i.error("Bạn cần đăng nhập để xem danh sách yêu cầu khẩn cấp");else if(((a=s.response)==null?void 0:a.status)===0||s.code==="ECONNABORTED")i.error("Không thể kết nối đến máy chủ. Vui lòng kiểm tra kết nối mạng.");else{const d=((n=(r=s.response)==null?void 0:r.data)==null?void 0:n.message)||"Không thể tải danh sách yêu cầu khẩn cấp";i.error(d)}m([])}finally{u(!1)}},x=async(t,a)=>{try{await j.updateRequestStatus(t,a),i.success("Cập nhật trạng thái thành công"),p()}catch(r){console.error("Error updating request status:",r),i.error("Không thể cập nhật trạng thái")}},g=N.filter(t=>{var n,s,d;const a=((n=t.patientName)==null?void 0:n.toLowerCase().includes(l.toLowerCase()))||((s=t.bloodType)==null?void 0:s.toLowerCase().includes(l.toLowerCase()))||((d=t.hospital)==null?void 0:d.toLowerCase().includes(l.toLowerCase())),r=h==="all"||t.status===h;return a&&r}),b=t=>{switch(t){case"PENDING":return"bg-yellow-100 text-yellow-800";case"APPROVED":return"bg-green-100 text-green-800";case"FULFILLED":return"bg-blue-100 text-blue-800";case"CANCELLED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}},L=t=>{switch(t){case"PENDING":return"Chờ xử lý";case"APPROVED":return"Đã duyệt";case"FULFILLED":return"Đã hoàn thành";case"CANCELLED":return"Đã hủy";default:return t}};return f?e.jsx(y,{children:e.jsx("div",{className:"flex justify-center items-center py-20",children:e.jsx(E,{size:"12"})})}):e.jsx(y,{children:e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{children:[e.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Yêu cầu khẩn cấp"}),e.jsx("p",{className:"text-gray-600 mt-1",children:"Quản lý các yêu cầu hiến máu khẩn cấp"})]}),e.jsxs(o,{variant:"primary",children:[e.jsx(P,{className:"w-4 h-4 mr-2"}),"Tạo yêu cầu mới"]})]}),e.jsx("div",{className:"bg-white rounded-lg shadow p-6",children:e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[e.jsx("div",{children:e.jsx(D,{label:"Tìm kiếm",placeholder:"Tên bệnh nhân, nhóm máu, bệnh viện...",value:l,onChange:t=>w(t.target.value),icon:e.jsx(A,{className:"w-4 h-4"})})}),e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2",children:"Trạng thái"}),e.jsxs("select",{value:h,onChange:t=>v(t.target.value),className:"w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-red-500 focus:border-red-500",children:[e.jsx("option",{value:"all",children:"Tất cả"}),e.jsx("option",{value:"PENDING",children:"Chờ xử lý"}),e.jsx("option",{value:"APPROVED",children:"Đã duyệt"}),e.jsx("option",{value:"FULFILLED",children:"Đã hoàn thành"}),e.jsx("option",{value:"CANCELLED",children:"Đã hủy"})]})]})]})}),e.jsx("div",{className:"bg-white rounded-lg shadow overflow-hidden",children:g.length===0?e.jsxs("div",{className:"text-center py-12",children:[e.jsx(C,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),e.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"Không có yêu cầu khẩn cấp"}),e.jsx("p",{className:"text-gray-600",children:"Chưa có yêu cầu hiến máu khẩn cấp nào được tạo."})]}):e.jsx("div",{className:"overflow-x-auto",children:e.jsxs("table",{className:"min-w-full divide-y divide-gray-200",children:[e.jsx("thead",{className:"bg-gray-50",children:e.jsxs("tr",{children:[e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Bệnh nhân"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Nhóm máu"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Bệnh viện"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Trạng thái"}),e.jsx("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Ngày tạo"}),e.jsx("th",{className:"px-6 py-3 text-right text-xs font-medium text-gray-500 uppercase tracking-wider",children:"Thao tác"})]})}),e.jsx("tbody",{className:"bg-white divide-y divide-gray-200",children:g.map(t=>e.jsxs("tr",{className:"hover:bg-gray-50",children:[e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(k,{className:"w-4 h-4 text-gray-400 mr-2"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-sm font-medium text-gray-900",children:t.patientName||"N/A"}),e.jsx("div",{className:"text-sm text-gray-500",children:t.contactPhone||"N/A"})]})]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:"inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-red-100 text-red-800",children:t.bloodType||"N/A"})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-900",children:t.hospital||"N/A"}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap",children:e.jsx("span",{className:`inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${b(t.status)}`,children:L(t.status)})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-sm text-gray-500",children:e.jsxs("div",{className:"flex items-center",children:[e.jsx(S,{className:"w-4 h-4 mr-1"}),t.createdAt?new Date(t.createdAt).toLocaleDateString("vi-VN"):"N/A"]})}),e.jsx("td",{className:"px-6 py-4 whitespace-nowrap text-right text-sm font-medium",children:e.jsxs("div",{className:"flex items-center justify-end space-x-2",children:[t.status==="PENDING"&&e.jsxs(e.Fragment,{children:[e.jsx(o,{variant:"outline",size:"sm",onClick:()=>x(t.id,"APPROVED"),children:"Duyệt"}),e.jsx(o,{variant:"outline",size:"sm",onClick:()=>x(t.id,"CANCELLED"),children:"Từ chối"})]}),t.status==="APPROVED"&&e.jsx(o,{variant:"outline",size:"sm",onClick:()=>x(t.id,"FULFILLED"),children:"Hoàn thành"})]})})]},t.id))})]})})})]})})};export{B as default};
