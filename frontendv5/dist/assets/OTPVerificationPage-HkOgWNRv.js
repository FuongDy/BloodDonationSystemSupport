import{r as i,u as K,b as V,g as A,V as l,j as e,S as B,B as E,R as I}from"./index-CLUoxoAg.js";import{A as L}from"./arrow-left-EWlVf4Oe.js";const X=()=>{var j;const[c,d]=i.useState(["","","","","",""]),[g,f]=i.useState(!1),[h,p]=i.useState(60),{verifyAndRegister:v,requestRegistration:O,isLoading:x}=K(),o=V(),k=A(),a=i.useRef([]),r=(j=k.state)==null?void 0:j.registrationData,y=r==null?void 0:r.email;i.useEffect(()=>{if(!r){l.error("Không tìm thấy thông tin đăng ký. Vui lòng đăng ký lại."),o("/register");return}const n=setInterval(()=>{p(t=>t>0?t-1:0)},1e3);return()=>clearInterval(n)},[r,o]),i.useEffect(()=>{a.current[0]&&a.current[0].focus()},[]);const R=(n,t)=>{var m;if(!/^[0-9]*$/.test(t))return;const s=[...c];s[n]=t.slice(-1),d(s),t&&n<5&&((m=a.current[n+1])==null||m.focus())},C=(n,t)=>{var s;t.key==="Backspace"&&!c[n]&&n>0&&((s=a.current[n-1])==null||s.focus()),t.key==="v"&&(t.ctrlKey||t.metaKey)&&(t.preventDefault(),navigator.clipboard.readText().then(m=>{var N;const b=m.replace(/\D/g,"").slice(0,6),w=[...c];for(let u=0;u<6;u++)w[u]=b[u]||"";d(w);const D=Math.min(b.length,5);(N=a.current[D])==null||N.focus()}))},P=async n=>{var s;n.preventDefault();const t=c.join("");if(t.length!==6){l.error("Vui lòng nhập đủ 6 chữ số mã OTP.");return}try{await v({email:y,otp:t}),l.success("Xác thực thành công! Chào mừng bạn đến với hệ thống."),o("/login")}catch{l.error("Mã OTP không đúng hoặc đã hết hạn."),d(["","","","","",""]),(s=a.current[0])==null||s.focus()}},T=async()=>{if(!(h>0)){f(!0);try{await O(r),p(60),l.success("Mã OTP mới đã được gửi đến email của bạn.")}catch{l.error("Không thể gửi lại mã OTP. Vui lòng thử lại.")}finally{f(!1)}}},S=()=>{o("/register",{state:{formData:r}})};return e.jsxs("div",{className:"min-h-screen bg-gray-50 flex flex-col justify-center py-12 sm:px-6 lg:px-8",children:[e.jsxs("div",{className:"sm:mx-auto sm:w-full sm:max-w-md",children:[e.jsx("div",{className:"flex justify-center",children:e.jsx(B,{className:"h-12 w-12 text-red-600"})}),e.jsx("h2",{className:"mt-6 text-center text-3xl font-extrabold text-gray-900",children:"Xác thực OTP"}),e.jsxs("p",{className:"mt-2 text-center text-sm text-gray-600",children:["Chúng tôi đã gửi mã gồm 6 chữ số đến",e.jsx("br",{}),e.jsx("span",{className:"font-medium text-red-600",children:y})]})]}),e.jsx("div",{className:"mt-8 sm:mx-auto sm:w-full sm:max-w-md",children:e.jsx("div",{className:"bg-white py-8 px-4 shadow sm:rounded-lg sm:px-10",children:e.jsxs("form",{onSubmit:P,className:"space-y-6",children:[e.jsxs("div",{children:[e.jsx("label",{className:"block text-sm font-medium text-gray-700 mb-2 text-center",children:"Nhập mã OTP"}),e.jsx("div",{className:"flex justify-center space-x-2",children:c.map((n,t)=>e.jsx("input",{ref:s=>a.current[t]=s,type:"text",inputMode:"numeric",maxLength:1,value:n,onChange:s=>R(t,s.target.value),onKeyDown:s=>C(t,s),className:"w-12 h-12 text-center text-xl font-semibold border border-gray-300 rounded-md focus:ring-red-500 focus:border-red-500",disabled:x},t))})]}),e.jsx(E,{type:"submit",className:"w-full",disabled:x||c.join("").length!==6,isLoading:x,variant:"primary",size:"lg",children:"Xác thực"}),e.jsx("div",{className:"text-center",children:h>0?e.jsxs("p",{className:"text-sm text-gray-500",children:["Gửi lại mã sau ",h,"s"]}):e.jsx("button",{type:"button",onClick:T,disabled:g,className:"text-sm text-red-600 hover:text-red-500 font-medium disabled:opacity-50",children:g?e.jsxs(e.Fragment,{children:[e.jsx(I,{className:"w-4 h-4 animate-spin inline mr-1"}),"Đang gửi..."]}):"Gửi lại mã OTP"})}),e.jsxs("button",{type:"button",onClick:S,className:"w-full flex items-center justify-center text-sm text-gray-600 hover:text-gray-500",children:[e.jsx(L,{className:"w-4 h-4 mr-1"}),"Quay lại trang đăng ký"]})]})})})]})};export{X as default};
