import{r as o,u as M,j as e,B as E,V as f}from"./index-1dtSQISR.js";import{b as T}from"./bloodTypeService-CnW7m_57.js";import{M as F}from"./Modal-C4xFU6ku.js";import{I as G}from"./InputField-1_bs09Nb.js";import{A as I}from"./ActionButtonGroup-CM-IdPWM.js";import{P as $}from"./pen-line-CmPajvV1.js";import{T as P}from"./trash-2-BbyR4m6B.js";import{T as K}from"./TabNavigation-DCjSNLIa.js";import{A as R}from"./AdminPageLayout-DhKAkubx.js";import{a as L,A as W}from"./AdminContentWrapper-BZBpLfvq.js";import{C as q}from"./circle-plus-DEzM_GbY.js";import"./PageHeader-W4hk3_1v.js";import"./Pagination-DEb_1VK8.js";import"./chevron-left-ByYWtYPx.js";import"./chevron-right-B4c0w1B6.js";const z=["Whole Blood","Plasma","Red Blood Cells","Platelets","White Blood Cells"],V=({isOpen:i,onClose:y,onSaveSuccess:b,bloodType:t})=>{const[a,u]=o.useState({bloodGroup:"",componentType:"Whole Blood",description:""}),[l,k]=o.useState(!1),[r,N]=o.useState({}),{user:c}=M();o.useEffect(()=>{u(t?{bloodGroup:t.bloodGroup||"",componentType:t.componentType||"Whole Blood",description:t.description||""}:{bloodGroup:"",componentType:"",description:""}),N({})},[t,i]);const d=n=>{const{name:g,value:h}=n.target;u(p=>({...p,[g]:h})),r[g]&&N(p=>({...p,[g]:null}))},C=()=>{const n={};return a.bloodGroup.trim()||(n.bloodGroup="Nhóm máu không được trống."),a.componentType||(n.componentType="Thành phần máu không được trống."),N(n),Object.keys(n).length===0},j=async n=>{if(n.preventDefault(),(c==null?void 0:c.role)!=="Admin"){f.error("Bạn không có quyền thực hiện thao tác này.");return}if(t!=null&&t.id?await T.update(t.id,h):await T.create(h),!C()){f.error("Vui lòng kiểm tra lại thông tin.");return}k(!0);const g=f.loading(t?"Đang cập nhật...":"Đang tạo..."),h={...a,description:a.description.trim()===""?null:a.description.trim()};try{if(t!=null&&t.id){const p={description:h.description};await T.update(t.id,p)}else await T.create(h);f.success(t?"Cập nhật thành công!":"Tạo thành công!",{id:g}),b()}catch(p){f.error(`Lỗi: ${p.message||"Đã có lỗi xảy ra."}`,{id:g})}finally{k(!1)}},m=(c==null?void 0:c.role)!=="Admin",v=!!t,B=e.jsxs(e.Fragment,{children:[e.jsx(E,{variant:"secondary",onClick:y,disabled:l,children:"Hủy"}),e.jsx(E,{variant:"primary",type:"submit",form:"bloodTypeForm",disabled:l||m,isLoading:l,children:t?"Lưu thay đổi":"Tạo mới"})]});return e.jsx(F,{isOpen:i,onClose:y,title:v?"Chỉnh sửa loại máu":"Thêm loại máu mới",footerContent:B,size:"lg",children:e.jsxs("form",{id:"bloodTypeForm",onSubmit:j,className:"space-y-4",children:[e.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[e.jsx(G,{label:"Nhóm máu (A+, O-, ..)",name:"bloodGroup",value:a.bloodGroup,onChange:d,required:!0,disabled:l||v||m,error:r.bloodGroup}),e.jsxs("div",{children:[e.jsx("label",{htmlFor:"componentType",className:"block text-sm font-medium text-gray-700 mb-1",children:"Thành phần máu"}),e.jsx("select",{id:"componentType",name:"componentType",value:a.componentType,onChange:d,disabled:l||v||m,className:`block w-full px-3 py-2 border rounded-md shadow-sm focus:outline-none focus:ring-red-500 focus:border-red-500 sm:text-sm ${r.componentType?"border-red-500":"border-gray-300"}`,children:z.map(n=>e.jsx("option",{value:n,children:n},n))}),r.componentType&&e.jsx("p",{className:"mt-1 text-xs text-red-600",children:r.componentType})]})]}),e.jsx(G,{label:"Mô tả (Tùy chọn)",name:"description",value:a.description,onChange:d,disabled:l||m,error:r.description})]})})},X=({bloodType:i,onEdit:y,onDelete:b,canEdit:t=!1})=>{const a=()=>{const l=`${i.bloodGroup} - ${i.componentType}`;b(i.id,l)},u=[];return t&&u.push({label:"Sửa",icon:$,variant:"outline",size:"sm",onClick:()=>y(i)},{label:"Xóa",icon:P,variant:"danger-outline",size:"sm",onClick:a}),e.jsxs("div",{className:"flex flex-col md:flex-row items-start md:items-center justify-between p-3 gap-4 hover:bg-slate-50/50 rounded-lg border-b border-slate-100 last:border-b-0",children:[e.jsxs("div",{className:"flex-grow",children:[e.jsx("p",{className:"text-base font-semibold text-slate-900",children:i.componentType}),e.jsx("p",{className:"text-sm text-slate-600 italic mt-1",children:i.description||"Không có mô tả."})]}),e.jsx("div",{className:"flex items-center space-x-3 flex-shrink-0 self-end md:self-center",children:t?e.jsx(I,{actions:u}):e.jsx("span",{className:"text-sm text-slate-500",children:"Không có quyền"})})]})},ce=()=>{var w;const[i,y]=o.useState([]),[b,t]=o.useState(!1),[a,u]=o.useState(!1),[l,k]=o.useState(null),[r,N]=o.useState(""),{user:c}=M(),[d,C]=o.useState(null),j=o.useCallback(async s=>{t(!0);try{const x=await T.getAll(s);y(x||[])}catch(x){f.error(`Lỗi khi tải dữ liệu: ${x.message}`)}finally{t(!1)}},[]);o.useEffect(()=>{j(r)},[r,j]);const m=o.useMemo(()=>i?i.reduce((s,x)=>{const S=x.bloodGroup;return s[S]||(s[S]=[]),s[S].push(x),s},{}):{},[i]);o.useEffect(()=>{const s=Object.keys(m).sort();s.length>0?s.includes(d)||C(s[0]):C(null)},[m,d]);const v=(s=null)=>{k(s),u(!0)},B=()=>{u(!1),k(null)},n=()=>{j(r),B()},g=async(s,x)=>{const S=x||`ID: ${s}`;if(window.confirm(`Bạn có chắc chắn muốn xóa loại máu "${S}" không?`)){const A=f.loading("Đang xóa...");try{await T.delete(s),f.success("Xóa thành công!",{id:A}),j(r)}catch(D){f.error(`Lỗi khi xóa: ${D.message}`,{id:A})}}},h=(w=c==null?void 0:c.roles)==null?void 0:w.includes("ROLE_ADMIN"),p=Object.keys(m).sort().map(s=>({key:s,label:s,icon:null})),O=[...h?[{label:"Thêm mới",icon:q,variant:"primary",onClick:()=>v(),disabled:b}]:[]];return e.jsxs(R,{title:"Quản lý Loại máu",actions:O,children:[p.length>0?e.jsxs("div",{className:"bg-white shadow-lg rounded-xl overflow-hidden border border-slate-200",children:[e.jsx(K,{tabs:p,activeTab:d,onTabChange:C,variant:"underline"}),e.jsx("div",{className:"p-2 md:p-4",children:d&&m[d]?e.jsx("div",{className:"divide-y divide-slate-100",children:m[d].map(s=>e.jsx(X,{bloodType:s,onEdit:v,onDelete:g,canEdit:h},s.id))}):e.jsx(L,{title:"Không có dữ liệu",description:"Không có loại máu nào phù hợp với tìm kiếm của bạn."})})]}):e.jsx(W,{isLoading:b,isEmpty:!0,emptyStateComponent:e.jsx(L,{title:"Không có dữ liệu",description:"Không có loại máu nào phù hợp với tìm kiếm của bạn."})}),e.jsx(V,{isOpen:a,onClose:B,onSaveSuccess:n,bloodType:l})]})};export{ce as default};
